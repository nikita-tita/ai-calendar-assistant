# üî¨ –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –ê–†–•–ò–¢–ï–ö–¢–£–†–´

**–î–∞—Ç–∞:** 24 –Ω–æ—è–±—Ä—è 2025, 23:50 MSK

---

## üìã –ß–¢–û –ü–†–û–ê–ù–ê–õ–ò–ó–ò–†–û–í–ê–ù–û:

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚úÖ
### 2. Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚úÖ
### 3. –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞ ‚úÖ
### 4. –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã ‚úÖ
### 5. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è ‚úÖ

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø:

###  main.py (FastAPI):

```python
# app/main.py —Å—Ç—Ä–æ–∫–∏ 120-137
@app.get("/")
async def root():
    """Root endpoint - serves web application."""
    static_path = Path(__file__).parent / "static" / "index.html"
    if static_path.exists():
        return FileResponse(
            static_path,
            headers={
                "Cache-Control": "no-cache, no-store, must-revalidate",
                "Pragma": "no-cache",
                "Expires": "0"
            }
        )
```

**–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É:** `/app/app/static/index.html` (–≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)

---

## üê≥ DOCKER –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø:

### Dockerfile (—Å—Ç—Ä–æ–∫–∞ 32):
```dockerfile
COPY app ./app
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ!** –§–∞–π–ª—ã –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –°–ë–û–†–ö–ï –æ–±—Ä–∞–∑–∞!

### Dockerfile (—Å—Ç—Ä–æ–∫–∞ 46):
```dockerfile
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

**–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:** FastAPI –Ω–∞ –ø–æ—Ä—Ç—É 8000

### docker-compose.yml (—Å—Ç—Ä–æ–∫–∏ 53-71):
```yaml
calendar-assistant:
  build:
    context: .
    dockerfile: Dockerfile
  container_name: ai-calendar-assistant
  ports:
    - "8000:8000"
  volumes:
    - ./credentials:/app/credentials
    - ./logs:/app/logs
    - calendar_bot_data:/var/lib/calendar-bot
```

**–ù–ï–¢ volume –¥–ª—è app/static!**

---

## üîç –ù–ê–ô–î–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´:

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –§–∞–π–ª—ã –≤ Docker –æ–±—Ä–∞–∑–µ

```
Docker build ‚Üí COPY app ./app ‚Üí –û–±—Ä–∞–∑ —Å –°–¢–ê–†–´–ú index.html
     ‚Üì
–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–∞–π–ª—ã –ò–ó –æ–±—Ä–∞–∑–∞
     ‚Üì
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ ‚Üí –ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä!
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–µ—Ç –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∞—Ç–∏–∫–∏

```yaml
# docker-compose.yml
volumes:
  - ./credentials:/app/credentials  ‚úÖ
  - ./logs:/app/logs  ‚úÖ
  # –ù–ï–¢: - ./app/static:/app/app/static  ‚ùå
```

---

## üéØ –í–û–ó–ú–û–ñ–ù–´–ï –°–¶–ï–ù–ê–†–ò–ò:

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–¥–∏–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (ai-calendar-assistant)

```
Request ‚Üí Nginx (443) ‚Üí Proxy ‚Üí ai-calendar-assistant:8000
                                         ‚Üì
                                   FastAPI app.main
                                         ‚Üì
                                   /app/app/static/index.html
                                         ‚Üì
                                   –§–∞–π–ª –ò–ó Docker –æ–±—Ä–∞–∑–∞
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –î–≤–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```
–í–æ–∑–º–æ–∂–Ω–æ –µ—Å—Ç—å: telegram-bot-polling + ai-calendar-assistant

telegram-bot-polling:
  - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞
  - –ù–ï –æ—Ç–¥–∞—ë—Ç —Å—Ç–∞—Ç–∏–∫—É

ai-calendar-assistant:
  - FastAPI –Ω–∞ 8000
  - –û—Ç–¥–∞—ë—Ç —Å—Ç–∞—Ç–∏–∫—É
```

---

## üîß –ß–¢–û –ù–£–ñ–ù–û –ü–†–û–í–ï–†–ò–¢–¨ –ù–ê PRODUCTION:

### 1. –ö–∞–∫–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã?
```bash
docker ps
```

**–û–∂–∏–¥–∞–µ–º —É–≤–∏–¥–µ—Ç—å:**
- `ai-calendar-assistant` (FastAPI)
- –í–æ–∑–º–æ–∂–Ω–æ `telegram-bot-polling` (–±–æ—Ç)

### 2. –ö–∞–∫–æ–π —Ñ–∞–π–ª –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞?
```bash
docker exec ai-calendar-assistant cat /app/app/static/index.html | wc -c
docker exec ai-calendar-assistant grep "new Date()" /app/app/static/index.html
```

### 3. –ö–∞–∫ Nginx –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç?
```bash
cat /etc/nginx/sites-enabled/calendar.housler.ru
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```nginx
location / {
    proxy_pass http://localhost:8000;
}
```

### 4. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ?
```bash
docker exec ai-calendar-assistant env | grep WEBAPP_URL
```

---

## üìä –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê:

–ó–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
./diagnose_production.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- ‚úÖ –ö–∞–∫–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã
- ‚úÖ –ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è index.html
- ‚úÖ Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ –ü–æ—Ä—Ç—ã –∏ –ø—Ä–æ—Ü–µ—Å—Å—ã
- ‚úÖ –§–∞–π–ª—ã –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ Docker –æ–±—Ä–∞–∑—ã
- ‚úÖ –õ–æ–≥–∏

---

## üéØ –†–ï–®–ï–ù–ò–Ø (–í –ó–ê–í–ò–°–ò–ú–û–°–¢–ò –û–¢ –†–ï–ó–£–õ–¨–¢–ê–¢–ê):

### –†–µ—à–µ–Ω–∏–µ A: –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Docker –æ–±—Ä–∞–∑

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–±—Ä–∞–∑ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∞—Ä—ã–π index.html

**–†–µ—à–µ–Ω–∏–µ:**
```bash
./rebuild_docker.sh
```

–≠—Ç–æ:
1. –°–∫–æ–ø–∏—Ä—É–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—É—é –ø–∞–ø–∫—É app/
2. –ü–µ—Ä–µ—Å–æ–±–µ—Ä—ë—Ç –æ–±—Ä–∞–∑
3. –ó–∞–ø—É—Å—Ç–∏—Ç –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

### –†–µ—à–µ–Ω–∏–µ B: –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è volumes

**–ü—Ä–æ–±–ª–µ–º–∞:** Volume –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –≤ docker-compose.yml:
```yaml
volumes:
  - ./app/static:/app/app/static
```

–ó–∞—Ç–µ–º:
```bash
docker-compose restart
```

### –†–µ—à–µ–Ω–∏–µ C: –ï—Å–ª–∏ Nginx –æ—Ç–¥–∞—ë—Ç –Ω–∞–ø—Ä—è–º—É—é

**–ü—Ä–æ–±–ª–µ–º–∞:** Nginx –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Å—Ç–∞—Ä—É—é –ø–∞–ø–∫—É

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Nginx –∫–æ–Ω—Ñ–∏–≥ –∏ –∏–∑–º–µ–Ω–∏—Ç—å –ø—É—Ç—å

---

## üî¨ –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ö–û–î–ê:

### app/main.py:

**–°—Ç—Ä–æ–∫–∞ 74-76:**
```python
static_path = Path(__file__).parent / "static"
if static_path.exists():
    app.mount("/static", StaticFiles(directory=str(static_path)), name="static")
```

–ú–æ–Ω—Ç–∏—Ä—É–µ—Ç `/static/*` –¥–ª—è CSS/JS

**–°—Ç—Ä–æ–∫–∞ 123:**
```python
static_path = Path(__file__).parent / "static" / "index.html"
```

–û—Ç–¥–∞—ë—Ç `index.html` –Ω–∞ `/`

### app/services/telegram_handler.py:

**–°—Ç—Ä–æ–∫–∞ 232:**
```python
webapp_url = settings.telegram_webapp_url
```

–ë–µ—Ä—ë—Ç URL –∏–∑ config

### app/config.py:

**–°—Ç—Ä–æ–∫–∞ 30:**
```python
telegram_webapp_url: Optional[str] = None
```

–ë–µ—Ä—ë—Ç –∏–∑ `.env`

### .env (–ª–æ–∫–∞–ª—å–Ω—ã–π):

**–°—Ç—Ä–æ–∫–∞ 9:**
```env
TELEGRAM_WEBAPP_URL=https://calendar.housler.ru
```

‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ

**–ù–û!** –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `.env` –Ω–∞ production!

---

## üß™ –¢–ï–°–¢–´:

### –¢–µ—Å—Ç 1: –õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª
```bash
wc -c app/static/index.html
grep "new Date()" app/static/index.html
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 31,934 bytes, —Å–æ–¥–µ—Ä–∂–∏—Ç `new Date()` ‚úÖ

### –¢–µ—Å—Ç 2: –°–µ—Ä–≤–µ—Ä –æ—Ç–¥–∞—ë—Ç
```bash
curl -s https://calendar.housler.ru/ | wc -c
curl -s https://calendar.housler.ru/ | grep "new Date()"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 31,934 bytes, —Å–æ–¥–µ—Ä–∂–∏—Ç `new Date()` ‚úÖ

### –¢–µ—Å—Ç 3: Cache headers
```bash
curl -I https://calendar.housler.ru/ | grep -i cache
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `no-cache, no-store` ‚úÖ

### –¢–µ—Å—Ç 4: Telegram Menu Button
```bash
curl https://api.telegram.org/bot.../getChatMenuButton
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `https://calendar.housler.ru/?v=...` ‚úÖ

---

## ‚ùì –ù–ï–†–ï–®–Å–ù–ù–´–ô –í–û–ü–†–û–°:

**–ï—Å–ª–∏ –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –ø–æ—á–µ–º—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 30 –æ–∫—Ç—è–±—Ä—è?**

### –ì–∏–ø–æ—Ç–µ–∑—ã:

1. **–§–∞–π–ª –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å—Ç–∞—Ä—ã–π**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `docker exec ... cat index.html`

2. **–ï—Å—Ç—å –≤—Ç–æ—Ä–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–¥–∞—ë—Ç —Å—Ç–∞—Ä–æ–µ**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `docker ps`

3. **Nginx –∫–µ—à–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –∫–æ–Ω—Ñ–∏–≥ Nginx

4. **Telegram –∫–µ—à–∏—Ä—É–µ—Ç –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ**
   - –†–µ—à–µ–Ω–∏–µ: –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ URL

5. **–§–∞–π–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –Ω–æ –°–û–î–ï–†–ñ–ò–ú–û–ï –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ**
   - –†–∞–∑–º–µ—Ä —Å–æ–≤–ø–∞–¥–∞–µ—Ç, –Ω–æ –¢–ï–ö–°–¢ —Å—Ç–∞—Ä—ã–π
   - –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ–±–∞–π—Ç–æ–≤–æ

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
```bash
./diagnose_production.sh > diagnosis.txt
```

### –®–∞–≥ 2: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–°–º–æ—Ç—Ä–∏—Ç–µ:
- –ö–∞–∫–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã?
- –ì–¥–µ index.html?
- –ß—Ç–æ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞?

### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ

–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:
- –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å volumes
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å Nginx
- –û–±–Ω–æ–≤–∏—Ç—å .env

---

## üìÅ –°–û–ó–î–ê–ù–ù–´–ï –§–ê–ô–õ–´:

1. **diagnose_production.sh** - –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
2. **rebuild_docker.sh** - –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
3. **COMPLETE_ARCHITECTURE_ANALYSIS.md** - –≠—Ç–æ—Ç —Ñ–∞–π–ª

---

## üéØ –ò–¢–û–ì:

**–ü—Ä–æ–≤–µ–¥—ë–Ω –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑:**
- ‚úÖ –ö–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞
- ‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–ù–∞–π–¥–µ–Ω–æ:**
- Docker –æ–±—Ä–∞–∑ –∫–æ–ø–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã –ø—Ä–∏ —Å–±–æ—Ä–∫–µ
- –ù–µ—Ç volume –¥–ª—è app/static
- –õ–æ–∫–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

**–†–µ—à–µ–Ω–∏–µ:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
2. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ —Å –Ω–æ–≤—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏

---

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã!**

```bash
./diagnose_production.sh
```
