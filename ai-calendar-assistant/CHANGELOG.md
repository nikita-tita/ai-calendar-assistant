# Changelog

–í—Å–µ –≤–∞–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É—é—Ç—Å—è –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ.

–§–æ—Ä–º–∞—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/).

---

## [2026-01-10] - SQL Injection Fix & Documentation Sync

### Fixed

**SQL Injection (SEC-002):**
- `app/services/analytics_service.py:436-462` ‚Äî –≤—Å–µ f-string SQL –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- `event_types` –∏ `msg_types` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç `?` placeholders
- –ó–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `execute()`

### Changed

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã (INFRA-001):**
- Cron: `0 3 * * *` ‚Äî –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 3:00 MSK
- –ë—ç–∫–∞–ø—è—Ç—Å—è: Radicale, SQLite (analytics, reminders), todos, encryption key, .env
- –†–æ—Ç–∞—Ü–∏—è: 30 –¥–Ω–µ–π
- –ü—É—Ç—å: `/root/backups/calendar/`

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞:**
- `BACKLOG.md` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å—Ç–∞—Ç—É—Å—ã SEC-002, SEC-006, INFRA-001, —Å–≤–æ–¥–∫–∞ (Done: 10)
- `RISKS_AND_BLOCKERS.md` ‚Äî –∑–∞–∫—Ä—ã—Ç—ã BLK-002, RSK-001, RSK-002, RSK-006
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è "–ó–∞–∫—Ä—ã—Ç—ã–µ —Ä–∏—Å–∫–∏/–±–ª–æ–∫–µ—Ä—ã"

### Summary

| –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å |
|--------|-----------|--------|
| SEC-002: SQL Injection | Blocker | ‚úÖ Done |
| SEC-006: Rate limiting bypass | Medium | ‚úÖ Done (–±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ —Ä–∞–Ω–µ–µ) |
| INFRA-001: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã | Blocker | ‚úÖ Done |
| –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ | ‚Äî | ‚úÖ Done |

**–§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ:** 4 (analytics_service.py, BACKLOG.md, RISKS_AND_BLOCKERS.md, CHANGELOG.md)

---

## [2026-01-09] - Security & Stability Sprint

### Added

**Security Middleware:**
- `app/middleware/security_headers.py` ‚Äî SecurityHeadersMiddleware (SEC-005)
  - X-Content-Type-Options: nosniff
  - X-Frame-Options: SAMEORIGIN
  - X-XSS-Protection: 1; mode=block
  - Referrer-Policy: strict-origin-when-cross-origin
  - Permissions-Policy (camera, microphone, etc)
  - Strict-Transport-Security (production only)

- `app/middleware/csrf_protection.py` ‚Äî CSRFProtectionMiddleware (SEC-004)
  - Origin header validation –¥–ª—è /api/admin/* endpoints
  - SameSite=Strict –Ω–∞ admin cookies

**XSS Protection (SEC-003):**
- `safeId()` —Ñ—É–Ω–∫—Ü–∏—è –≤ index.html ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ escape ID –≤ onclick handlers
- WebApp version: v984

**Token Limit (BIZ-002):**
- MAX_INPUT_CHARS=4000 –≤ llm_agent_yandex.py
- Input truncation —Å warning log

### Fixed

**Race Condition (BIZ-001):**
- `asyncio.Lock()` ‚Üí `threading.Lock()` –≤ calendar_radicale.py
- Lock –¥–æ–±–∞–≤–ª–µ–Ω –≤ `_get_user_calendar`, `_cache_calendar`, `invalidate_cache`

**Cache Invalidation (BIZ-003):**
- `invalidate_cache(user_id)` –ø–æ—Å–ª–µ create_event()
- `invalidate_cache(user_id)` –ø–æ—Å–ª–µ update_event()
- `invalidate_cache(user_id)` –ø–æ—Å–ª–µ delete_event()

### Summary

| –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å |
|--------|-----------|--------|
| SEC-003: XSS –≤ onclick | Blocker | ‚úÖ Done |
| SEC-004: CSRF –∑–∞—â–∏—Ç–∞ | Blocker | ‚úÖ Done |
| SEC-005: Security headers | Blocker | ‚úÖ Done |
| BIZ-001: Race condition | Blocker | ‚úÖ Done |
| BIZ-002: Token limit | Blocker | ‚úÖ Done |
| BIZ-003: Cache invalidation | High | ‚úÖ Done |

**–§–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ:** 2
**–§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ:** 6

---

## [2025-12-30] - Code Review Cleanup (Final)

### Removed

**–ú—ë—Ä—Ç–≤—ã–π –∫–æ–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (470 —Å—Ç—Ä–æ–∫):**
- `app/services/admin_auth.py` ‚Äî —É—Å—Ç–∞—Ä–µ–≤—à–∏–π —Å–µ—Ä–≤–∏—Å —Å SHA-256 —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- `app/services/admin_auth_jwt.py` ‚Äî —É—Å—Ç–∞—Ä–µ–≤—à–∏–π JWT —Å–µ—Ä–≤–∏—Å —Å SHA-256

–≠—Ç–∏ —Ñ–∞–π–ª—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –≤ production ‚Äî –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ `admin.py` –∏ `admin_auth_service.py` —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç bcrypt.

### Fixed

**Bare except –±–ª–æ–∫–∏ –≤ `llm_agent_yandex.py` (7 –º–µ—Å—Ç):**

| –°—Ç—Ä–æ–∫–∞ | –ö–æ–Ω—Ç–µ–∫—Å—Ç | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ |
|--------|----------|-------------|
| 1160 | `datetime.fromisoformat()` | `except (ValueError, TypeError)` |
| 1183 | `datetime.fromisoformat()` | `except (ValueError, TypeError)` |
| 1309 | date formatting | `except (ValueError, TypeError, AttributeError)` |
| 1317 | date formatting | `except (ValueError, TypeError, AttributeError)` |
| 1376 | batch event parsing | `except (ValueError, TypeError, AttributeError)` |
| 1410 | batch event parsing | `except (ValueError, TypeError, AttributeError)` |
| 1454 | `_parse_optional_datetime()` | `except (ValueError, TypeError)` |

### Summary

**–í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –∏–∑ Code Review PR#1 –∑–∞–∫—Ä—ã—Ç—ã:**

| –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å | –ö–æ–≥–¥–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
|----------|--------|------------------|
| SHA-256 —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚úÖ | –†–∞–Ω–µ–µ (bcrypt –≤ admin.py) |
| Rate limiter –≤ –ø–∞–º—è—Ç–∏ | ‚úÖ | –†–∞–Ω–µ–µ (Redis –≤ main.py) |
| Race condition conversation_history | ‚úÖ | –†–∞–Ω–µ–µ (LRUDict) |
| `_handle_text` 869 —Å—Ç—Ä–æ–∫ | ‚úÖ | –†–∞–Ω–µ–µ (~243 —Å—Ç—Ä–æ–∫–∏) |
| Bare except –±–ª–æ–∫–∏ | ‚úÖ | –≠—Ç–æ—Ç –∫–æ–º–º–∏—Ç |
| –ú—ë—Ä—Ç–≤—ã–π –∫–æ–¥ | ‚úÖ | –≠—Ç–æ—Ç –∫–æ–º–º–∏—Ç |

### Technical
- **–ö–æ–º–º–∏—Ç:** `cc96307`
- **–§–∞–π–ª–æ–≤ —É–¥–∞–ª–µ–Ω–æ:** 2
- **–°—Ç—Ä–æ–∫ —É–¥–∞–ª–µ–Ω–æ:** 470
- **–°—Ç—Ä–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–æ:** 7 (bare except ‚Üí specific exceptions)

---

## [2025-12-30] - SQLite Backup Infrastructure

### Added

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø SQLite –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö:**

- –ù–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `scripts/backup-sqlite.sh`
- –ë—ç–∫–∞–ø–∏—Ç 3 –±–∞–∑—ã: `analytics.db`, `admin_auth.db`, `reminders.db`
- Cron: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 3:10 (–ø–æ—Å–ª–µ todos backup)
- –•—Ä–∞–Ω–µ–Ω–∏–µ: 30 –¥–Ω–µ–π –≤ `/root/backups/sqlite/`
- –§–æ—Ä–º–∞—Ç: `sqlite_YYYYMMDD_HHMMSS.tar.gz` (~93KB)

**–ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –±—ç–∫–∞–ø–æ–≤:**
| –î–∞–Ω–Ω—ã–µ | –í—Ä–µ–º—è | –°–∫—Ä–∏–ø—Ç |
|--------|-------|--------|
| Radicale (–∫–∞–ª–µ–Ω–¥–∞—Ä—å) | 3:00 | `backup-radicale.sh` |
| Todos (–∑–∞–¥–∞—á–∏) | 3:05 | `backup-todos.sh` |
| SQLite (–ë–î) | 3:10 | `backup-sqlite.sh` |

### Technical
- **–ö–æ–º–º–∏—Ç—ã:** `d613317`, `fc4a436`, `142c1a1`, `753b95b`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `docker cp` –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –±—ç–∫–∞–ø–æ–≤ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π

---

## [2025-12-30] - Human-Readable Smoke Test Report

### Changed

**–ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç—á—ë—Ç–∞ smoke_test.sh:**

–ë—ã–ª–æ (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π):
```
PASS Health endpoint HTTP 200
FAIL Todo service FAIL:create
```

–°—Ç–∞–ª–æ (–ø–æ–Ω—è—Ç–Ω—ã–π):
```
üü¢ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ

üì± –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
‚Ä¢ –ó–∞–¥–∞—á–∏ ‚úì ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚Ä¢ –ö–∞–ª–µ–Ω–¥–∞—Ä—å ‚úì ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
‚Ä¢ –ì–æ–ª–æ—Å ‚úì ‚Äî —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚Ä¢ AI ‚úì ‚Äî –ø–æ–Ω–∏–º–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã

üåê –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
‚Ä¢ API ‚úì ‚Äî —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç
‚Ä¢ –°–∞–π—Ç ‚úì ‚Äî calendar.housler.ru –¥–æ—Å—Ç—É–ø–µ–Ω
‚Ä¢ SSL ‚úì ‚Äî –µ—â—ë 54 –¥–Ω–µ–π
‚Ä¢ –°–µ—Ä–≤–µ—Ä ‚úì ‚Äî –≤—Å–µ 3 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞—é—Ç

‚ö°Ô∏è –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è:
‚Ä¢ –õ–æ–≥–∏ ‚ö† ‚Äî 4 –æ—à–∏–±–æ–∫ –∑–∞ 6—á (–µ–¥–∏–Ω–∏—á–Ω—ã–µ —Å–±–æ–∏)
```

**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–µ—Å—Ç–æ–≤:**
- `functions` ‚Äî –ó–∞–¥–∞—á–∏, –ö–∞–ª–µ–Ω–¥–∞—Ä—å, –ì–æ–ª–æ—Å, AI
- `infra` ‚Äî API, –°–∞–π—Ç, WebApp, SSL, –°–µ—Ä–≤–µ—Ä, –°–∫–æ—Ä–æ—Å—Ç—å, –ó–∞—â–∏—Ç–∞
- `attention` ‚Äî –õ–æ–≥–∏, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

**–ü—Ä–∏ —Å–±–æ—è—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- –ß—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å –∏ –∫–∞–∫ —ç—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°–µ–∫—Ü–∏—è "–ß—Ç–æ –¥–µ–ª–∞—Ç—å" —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### Technical
- **–ö–æ–º–º–∏—Ç:** `8d0e534`
- **–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:** `scripts/monitoring/smoke_test.sh` (+145 -94 —Å—Ç—Ä–æ–∫)
- **–§—É–Ω–∫—Ü–∏–∏:** `format_category_results()`, `build_human_report()`

---

## [2025-12-30] - E2E Functional Tests in Smoke Test

### Added

**E2E —Ç–µ—Å—Ç—ã –≤ smoke_test.sh** ‚Äî —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤:
- `test_todo_service` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ/–ø—Ä–æ–≤–µ—Ä–∫–∞/—É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ todos_service
- `test_calendar_service` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ calendar_radicale
- `test_stt_service` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Yandex SpeechKit
- `test_llm_parsing` ‚Äî —Ç–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–Ω—Ç–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ Yandex GPT

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
- –¢–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `docker exec` + Python one-liners
- –õ–æ–≥–∏ –ø–æ–¥–∞–≤–ª—è—é—Ç—Å—è –¥–ª—è —á–∏—Å—Ç–æ–≥–æ –≤—ã–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
- –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, —Ç–∞–∫ –∏ —É–¥–∞–ª—ë–Ω–Ω–æ —á–µ—Ä–µ–∑ SSH

### Technical
- **–ö–æ–º–º–∏—Ç:** `2604b62`
- **–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:** `scripts/monitoring/smoke_test.sh` (+171 —Å—Ç—Ä–æ–∫)
- **–¢–µ—Å—Ç–æ–≤ –≤ –æ—Ç—á—ë—Ç–µ:** 14 (–±—ã–ª–æ 10)
- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** cron 10:00 –∏ 17:00 MSK

---

## [2025-12-29] - Todos Data Recovery & Backup Infrastructure

### Fixed

**batch_confirm handler** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ todos –≤ batch_confirm:
- Handler `_handle_batch_confirm` —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `intent="todo"`
- –†–∞–Ω–µ–µ todos –∏–∑ batch_actions –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è)
- –ö–æ–º–º–∏—Ç: `40b78a3`

**Encryption key migration** ‚Äî –º–∏–≥—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è todos:
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ 3 —Ä–∞–∑–Ω—ã—Ö –∫–ª—é—á–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (ENV, todos_file, main_file)
- 17 –∏–∑ 20 —Ñ–∞–π–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—ã–ª–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã —Å—Ç–∞—Ä—ã–º –∫–ª—é—á–æ–º
- –í—Å–µ —Ñ–∞–π–ª—ã –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –µ–¥–∏–Ω—ã–π –∫–ª—é—á –∏–∑ ENV
- –°–æ–∑–¥–∞–Ω backup –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π

### Added

**Todos backup script** (`scripts/backup-todos.sh`):
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø todos –∏–∑ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `/root/backups/todos/` —Å timestamp
- Retention: 30 –¥–Ω–µ–π
- –î–æ–±–∞–≤–ª–µ–Ω –≤ crontab: `5 3 * * *` (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 03:05)
- –ö–æ–º–º–∏—Ç: `be8d087`

**Reminder content logging** ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π:
- –ù–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ `message_content TEXT` –≤ —Ç–∞–±–ª–∏—Ü–µ `sent_daily_reminders`
- –í—Å–µ —Ç–∏–ø—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π (morning, motivation, evening) —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã –ë–î –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ø–∏—Å–æ–∫ todos) –∏–∑ –ª–æ–≥–æ–≤
- –ö–æ–º–º–∏—Ç: `f617ba6`

### Data Recovery

**–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 2296243**:
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (–±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏)
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 7 todos –∏–∑ backup –æ—Ç Dec 4
- –î–æ–±–∞–≤–ª–µ–Ω–æ 4 todos –∏–∑ –≤–µ—á–µ—Ä–Ω–µ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è Dec 24
- –ò—Ç–æ–≥–æ: 13 todos (–±—ã–ª–æ 2)

### Technical
- **–ö–æ–º–º–∏—Ç–æ–≤:** 3
- **–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:** `scripts/backup-todos.sh`
- **–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:** `telegram_handler.py`, `daily_reminders.py`
- **–î–µ–ø–ª–æ–π:** ‚úÖ –†–∞–∑–≤—ë—Ä–Ω—É—Ç–æ –Ω–∞ production

---

## [2025-12-27] - Dead Code Cleanup

### Removed

**SMS Auth (16 —Ñ–∞–π–ª–æ–≤)** ‚Äî –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å SMS-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
- `app/routers/sms_auth.py` ‚Äî —Ä–æ—É—Ç–µ—Ä
- `app/middleware/sms_auth_middleware.py` ‚Äî middleware
- `app/services/sms_auth_service.py` ‚Äî —Å–µ—Ä–≤–∏—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `app/services/sms_service.py` ‚Äî SMS –ø—Ä–æ–≤–∞–π–¥–µ—Ä
- `app/models/sms_auth.py` ‚Äî –º–æ–¥–µ–ª–∏
- `app/static/sms_auth_demo.html` ‚Äî –¥–µ–º–æ-—Å—Ç—Ä–∞–Ω–∏—Ü–∞
- `tests/test_sms_auth.py` ‚Äî —Ç–µ—Å—Ç—ã
- `env.sms.example`, `env.sms_production.example` ‚Äî –ø—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥–æ–≤
- 7 —Ñ–∞–π–ª–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (SMS_AUTHENTICATION.md, CHECKLIST_SMS.md, –∏ –¥—Ä.)

**Calendar Sync (6 —Ñ–∞–π–ª–æ–≤)** ‚Äî –æ—Ç–∫–ª—é—á—ë–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Calendar:
- `app/routers/calendar_sync.py` ‚Äî —Ä–æ—É—Ç–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- `app/routers/health.py` ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π health check (–¥—É–±–ª–∏—Ä–æ–≤–∞–ª /health –≤ main.py)
- `app/models/calendar_sync.py` ‚Äî –º–æ–¥–µ–ª–∏
- `app/services/calendar_sync_service.py` ‚Äî —Å–µ—Ä–≤–∏—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- `app/services/sync_database.py` ‚Äî –ë–î –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- `app/services/sync_hooks.py` ‚Äî —Ö—É–∫–∏

**Property Bot (~15 —Ñ–∞–π–ª–æ–≤)** ‚Äî –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–æ—Ç –¥–ª—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏:
- `app/run_property_bot.py` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
- `app/scripts/init_property_db.py` ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
- `app/scripts/test_property_*.py` (5 —Ñ–∞–π–ª–æ–≤) ‚Äî —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
- `app/tests/test_feed_mapper.py` ‚Äî —Ç–µ—Å—Ç—ã –º–∞–ø–ø–µ—Ä–∞
- `app/tests/integration/test_property_service.py` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- `app/tests/test_property_stage2_integration.py` ‚Äî Stage 2 —Ç–µ—Å—Ç—ã
- `app/migrations/` ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

**Test JSON —Ñ–∞–π–ª—ã (9 —Ñ–∞–π–ª–æ–≤)**:
- `app/property_bot_test_simple_*.json` (7 —Ñ–∞–π–ª–æ–≤) ‚Äî —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- `app/test_admin.json`, `app/test_analytics.json` ‚Äî —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

### Changed

**app/main.py** ‚Äî –æ—á–∏—Å—Ç–∫–∞ –æ—Ç –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞:
- –£–¥–∞–ª–µ–Ω—ã –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã (calendar_sync, health, property, sms_auth)
- –£–¥–∞–ª–µ–Ω—ã –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–æ—É—Ç–µ—Ä–æ–≤
- –£–¥–∞–ª–µ–Ω–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è —Ñ—É–Ω–∫—Ü–∏—è `_sync_task_loop()` (Google Calendar)
- –£–¥–∞–ª—ë–Ω –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ Property Bot scheduler

**app/config.py** ‚Äî —É–¥–∞–ª–µ–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- SMS: `sms_provider`, `sms_ru_api_id`, `twilio_*`
- Property Bot: `property_feed_url`, `property_database_url`, `property_db_password`
- Yandex Maps/Vision API settings
- Feature flags –¥–ª—è property
- Cache/Search/Rate limiting –¥–ª—è property

### Technical
- **–£–¥–∞–ª–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:** ~35
- **–£–¥–∞–ª–µ–Ω–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~8500
- **–ö–æ–º–º–∏—Ç—ã:** `7c6049f` (SMS Auth), `ba0f847` (Calendar Sync + Property Bot)
- **–î–µ–ø–ª–æ–π:** ‚úÖ –†–∞–∑–≤—ë—Ä–Ω—É—Ç–æ –Ω–∞ production

### Why
–ö–æ–¥ –±—ã–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á—ë–Ω (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –≤ main.py), –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –≤ production, –∏ —Å–æ–∑–¥–∞–≤–∞–ª confusion –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–µ–∫—Ç—É.

---

## [2025-12-20] - Disk Management & Infrastructure

### Problem
–î–∏—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –∑–∞–ø–æ–ª–Ω–∏–ª—Å—è –Ω–∞ 100% (57GB/59GB), —á—Ç–æ –≤—ã–∑–≤–∞–ª–æ `507 Insufficient Storage` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–æ–±—ã—Ç–∏–π.

### Root Cause
- Docker container logs —Ä–æ—Å–ª–∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ (–Ω–µ –±—ã–ª–æ –ª–∏–º–∏—Ç–∞)
- Docker images/layers –Ω–∞–∫–∞–ø–ª–∏–≤–∞–ª–∏—Å—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º build
- Build cache –Ω–µ –æ—á–∏—â–∞–ª—Å—è
- Journald –ª–æ–≥–∏ –Ω–µ –±—ã–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã

### Fixed
- –°–æ–∑–¥–∞–Ω `/etc/docker/daemon.json` —Å –ª–∏–º–∏—Ç–æ–º –ª–æ–≥–æ–≤ (50MB x 3 —Ñ–∞–π–ª–∞ –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
- –ù–∞—Å—Ç—Ä–æ–µ–Ω journald: max 500MB, —Ö—Ä–∞–Ω–µ–Ω–∏–µ 1 –Ω–µ–¥–µ–ª—è
- –î–æ–±–∞–≤–ª–µ–Ω `/etc/cron.daily/docker-cleanup` –¥–ª—è –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏ Docker
- –î–æ–±–∞–≤–ª–µ–Ω `/root/check-disk.sh` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
- –ü—Ä–∏ >80% –¥–∏—Å–∫–∞ - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ Docker

### Added
- `docs/02-deployment/DISK_MANAGEMENT.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –¥–∏—Å–∫–æ–º

---

## [2025-12-20] - Error Scenarios Fix (Based on 10-day Analytics Audit)

### Background
–ü—Ä–æ–≤–µ–¥—ë–Ω –∞—É–¥–∏—Ç –ª–æ–≥–æ–≤ –∑–∞ 10-20 –¥–µ–∫–∞–±—Ä—è: 337 –¥–µ–π—Å—Ç–≤–∏–π, 31 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, 25 –æ—à–∏–±–æ–∫.
–í—ã—è–≤–ª–µ–Ω—ã —Ç–æ–ø-10 –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –§–∞–∑—ã 1 –∏ 2.

### Fixed

**–§–∞–∑–∞ 1 (Critical):**
- **NoneType + timedelta crash –≤ batch_actions** (7 —Å–ª—É—á–∞–µ–≤)
  - –ü—Ä–∏—á–∏–Ω–∞: `start_time` –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è –∫–∞–∫ ISO —Å—Ç—Ä–æ–∫–∞ –≤–º–µ—Å—Ç–æ datetime
  - –†–µ—à–µ–Ω–∏–µ: –¥–æ–±–∞–≤–ª–µ–Ω `_parse_action_datetime()` helper —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
  - –§–∞–π–ª: `telegram_handler.py:1117-1153`

- **Yandex GPT content moderation refusal** (11 —Å–ª—É—á–∞–µ–≤)
  - –ü—Ä–∏—á–∏–Ω–∞: LLM –æ—Ç–≤–µ—á–∞–ª "–Ø –Ω–µ –º–æ–≥—É –æ–±—Å—É–∂–¥–∞—Ç—å —ç—Ç—É —Ç–µ–º—É" –Ω–∞ –±–µ–∑–æ–±–∏–¥–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
  - –†–µ—à–µ–Ω–∏–µ: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–µ—Ç–µ–∫—Ü–∏—è –æ—Ç–∫–∞–∑–∞ + fallback –Ω–∞ TODO
  - –§–∞–π–ª: `llm_agent_yandex.py:148-201, 909-927`

**–§–∞–∑–∞ 2 (UX Improvements):**
- **–ö—Ä–∞—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** ("12:00" –ø–æ—Å–ª–µ —É—Ç–æ—á–Ω–µ–Ω–∏—è)
  - –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–±–æ–≥–∞—â–µ–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤ –ø—Ä–µ–¥—ã–¥—É—â–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
  - –ü—Ä–∏–º–µ—Ä: "–ë—Ä–æ–∫–µ—Ä —Ç—É—Ä" + "12:00" ‚Üí "–ë—Ä–æ–∫–µ—Ä —Ç—É—Ä –≤ 12:00"
  - –§–∞–π–ª: `telegram_handler.py:1157-1217`

- **–ñ–∞–ª–æ–±—ã –Ω–∞ –≤—Ä–µ–º—è/—Ç–∞–π–º–∑–æ–Ω—É**
  - –î–æ–±–∞–≤–ª–µ–Ω Pre-LLM handler –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –æ –≤—Ä–µ–º–µ–Ω–∏
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –±–æ—Ç–∞ + —Å—Å—ã–ª–∫—É –Ω–∞ /timezone

- **Greetings –∏ small talk**
  - –î–æ–±–∞–≤–ª–µ–Ω—ã Pre-LLM handlers –¥–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π ("–ø—Ä–∏–≤–µ—Ç", "–∫–∞–∫ –¥–µ–ª–∞")
  - –≠–∫–æ–Ω–æ–º–∏—Ç LLM —Ç–æ–∫–µ–Ω—ã –Ω–∞ trivial –∑–∞–ø—Ä–æ—Å–∞—Ö

- **–ü—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤**
  - –£–ª—É—á—à–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–ª–∏–∂–∞–π—à–µ–µ —Å–æ–±—ã—Ç–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å
  - –ë–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã —á—Ç–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å

### Added
- `_parse_action_datetime()` - –ø–∞—Ä—Å–∏–Ω–≥ datetime –∏–∑ batch actions
- `_enrich_short_response()` - –æ–±–æ–≥–∞—â–µ–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- `_is_llm_refusal()` - –¥–µ—Ç–µ–∫—Ü–∏—è content moderation –æ—Ç–∫–∞–∑–∞
- `_create_todo_fallback()` - fallback –Ω–∞ TODO –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ LLM
- Pre-LLM handlers –¥–ª—è greetings, small talk, timezone complaints

### Technical
- **–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:** 2
- **–°—Ç—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** +283
- **–ü—Ä–æ–º–ø—Ç –∏–∑–º–µ–Ω—ë–Ω:** –ù–µ—Ç (–≤—Å–µ —Ñ–∏–∫—Å—ã —á–µ—Ä–µ–∑ –∫–æ–¥)

### Docs
- –°–æ–∑–¥–∞–Ω `docs/ERROR_SCENARIOS_ANALYSIS.md` - –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫
- –°–æ–∑–¥–∞–Ω `docs/TECHNICAL_AUDIT_AND_FIXES.md` - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –¢–ó

---

## [2025-12-12] - Analytics SQLite Migration v2 (Actions + User Count Fix)

### Fixed (v2 hotfix)
- **"0 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π" –≤ –∞–¥–º–∏–Ω–∫–µ**
  - –ü—Ä–∏—á–∏–Ω–∞: `get_dashboard_stats()` —Å—á–∏—Ç–∞–ª users –∏–∑ `actions`, –∞ –Ω–µ –∏–∑ `users`
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: —Ç–µ–ø–µ—Ä—å `total_users` –±–µ—Ä—ë—Ç—Å—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `users`
- **–ú–∏–≥—Ä–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö actions –∏–∑ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ JSON**
  - –î–æ–±–∞–≤–ª–µ–Ω `_migrate_encrypted_actions()` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è 318 –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π
  - –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ `EncryptedStorage`, –∑–∞–ø–∏—Å—å –≤ SQLite
  - –°—Ç–∞—Ä—ã–π —Ñ–∞–π–ª –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è –≤ `.enc.migrated`

---

## [2025-12-11] - Analytics SQLite Migration (Multi-Process Fix)

### Problem
- –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: –±–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–ª 61 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞–¥–º–∏–Ω–∫–∞ ‚Äî 41
- –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏–∑-–∑–∞ –¥–≤—É—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (uvicorn + bot) —Å –æ–±—â–∏–º JSON —Ñ–∞–π–ª–æ–º
- Docker SIGTERM –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è ‚Üí –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ

### Fixed
- **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ë–ê–ì: –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø—Ä–∏ –º—É–ª—å—Ç–∏-–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ–π —Ä–∞–±–æ—Ç–µ**
  - –ü—Ä–∏—á–∏–Ω–∞: –¥–≤–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ (FastAPI uvicorn + run_polling.py) –∏–º–µ–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã AnalyticsService
  - –ö–∞–∂–¥—ã–π –ø–∏—Å–∞–ª –≤ –æ–¥–∏–Ω JSON —Ñ–∞–π–ª, –ø–µ—Ä–µ–∑–∞—Ç–∏—Ä–∞—è –¥–∞–Ω–Ω—ã–µ –¥—Ä—É–≥–æ–≥–æ
  - FLUSH_INTERVAL=100 –±—ã–ª —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–º –¥–ª—è –Ω–∏–∑–∫–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞

### Changed
- **–ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è `analytics_service.py` –Ω–∞ SQLite**
  - –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (–±–µ–∑ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏)
  - WAL mode –¥–ª—è concurrent access
  - Multi-process safe
  - –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã: `users` (single source of truth), `actions`

- **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ `daily_reminders.py`**
  - `active_users` —Ç–µ–ø–µ—Ä—å property ‚Üí live query –∏–∑ analytics SQLite
  - `register_user()` ‚Üí `analytics_service.ensure_user()`
  - `unregister_user()` ‚Üí `analytics_service.deactivate_user()`
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –∏–∑ JSON –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ

- **Graceful shutdown –≤ `run_polling.py`**
  - –î–æ–±–∞–≤–ª–µ–Ω—ã signal handlers –¥–ª—è SIGTERM –∏ SIGINT
  - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

### Technical
- `app/services/analytics_service.py` ‚Äî –ø–æ–ª–Ω—ã–π rewrite (SQLite)
- `app/services/daily_reminders.py` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å analytics SQLite
- `run_polling.py` ‚Äî asyncio shutdown_event + signal handlers

### Security Review
- ‚úÖ –í—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ (–∑–∞—â–∏—Ç–∞ –æ—Ç injection)
- ‚úÖ PII –º–∞—Å–∫–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `safe_log_params()`
- ‚úÖ –ù–µ—Ç hardcoded —Å–µ–∫—Ä–µ—Ç–æ–≤
- ‚úÖ –¢–æ–∫–µ–Ω –º–∞—Å–∫–∏—Ä—É–µ—Ç—Å—è –≤ –ª–æ–≥–∞—Ö

### Migration
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ JSON –≤ SQLite –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- –°—Ç–∞—Ä—ã–π JSON –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è –≤ `.migrated`

---

## [2025-12-11] - Smart Daily Reminders with Todos Integration

### Added
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–∞–¥–∞—á (todos) –≤ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è**
  - –£—Ç—Ä–µ–Ω–Ω–∏–µ –∏ –≤–µ—á–µ—Ä–Ω–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
  - –í–µ—á–µ—Ä–Ω–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞ –¥–µ–Ω—å –∑–∞–¥–∞—á–∏

- **4 —Å—Ü–µ–Ω–∞—Ä–∏—è —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (09:00)**
  1. **–ü—É—Å—Ç–æ–π –¥–µ–Ω—å** ‚Äî –Ω–µ—Ç —Å–æ–±—ã—Ç–∏–π –∏ –∑–∞–¥–∞—á ‚Üí –º–æ—Ç–∏–≤–∞—Ü–∏—è —Å–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –¥–µ–Ω—å —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏
  2. **–¢–æ–ª—å–∫–æ –∑–∞–¥–∞—á–∏** ‚Äî –µ—Å—Ç—å –∑–∞–¥–∞—á–∏, –Ω–µ—Ç —Å–æ–±—ã—Ç–∏–π ‚Üí —Ñ–æ–∫—É—Å –Ω–∞ –∑–∞–¥–∞—á–∞—Ö
  3. **–¢–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è** ‚Äî –µ—Å—Ç—å —Å–æ–±—ã—Ç–∏—è, –Ω–µ—Ç –∑–∞–¥–∞—á ‚Üí –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
  4. **–ü–æ–ª–Ω—ã–π –¥–µ–Ω—å** ‚Äî –µ—Å—Ç—å –∏ —Å–æ–±—ã—Ç–∏—è, –∏ –∑–∞–¥–∞—á–∏ ‚Üí –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –æ–±–∑–æ—Ä

- **3 —Å—Ü–µ–Ω–∞—Ä–∏—è –≤–µ—á–µ—Ä–Ω–µ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (20:00)**
  1. **–ï—Å—Ç—å –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ** ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –Ω–∞ –∑–∞–≤—Ç—Ä–∞
  2. **–í—Å—ë –≤—ã–ø–æ–ª–Ω–µ–Ω–æ** ‚Äî –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–º –¥–Ω—ë–º
  3. **–¢–∏—Ö–∏–π –¥–µ–Ω—å** ‚Äî –º–æ—Ç–∏–≤–∞—Ü–∏—è –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤—Ç—Ä–∞—à–Ω–∏–π –¥–µ–Ω—å

- **21 –Ω–æ–≤—ã–π –ø–µ—Ä–µ–≤–æ–¥ –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π**
  - –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–¥ —Ä–∏–µ–ª—Ç–æ—Ä–æ–≤/–∞–≥–µ–Ω—Ç—Å–∫–∏–π —Ä—ã–Ω–æ–∫
  - –ü–æ–¥—Å–∫–∞–∑–∫–∏: –æ–±–∑–≤–æ–Ω–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤, –Ω–∞–∑–Ω–∞—á–∏—Ç—å –ø–æ–∫–∞–∑—ã, –æ–±–Ω–æ–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è
  - –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è: "–£–¥–∞—á–Ω—ã—Ö —Å–¥–µ–ª–æ–∫!" –∏ —Ç.–¥.

### Changed
- `send_morning_reminder()` ‚Äî –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π todos
- `send_evening_reminder()` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã todos, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∞–¥–º–∏–Ω—Å–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ LLM

### Technical
- `app/services/daily_reminders.py`:
  - –ù–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç: `from app.services.todos_service import todos_service`
  - –ù–æ–≤—ã–π –º–µ—Ç–æ–¥: `_get_user_todos(user_id)` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞ –¥–µ–Ω—å –∑–∞–¥–∞—á
  - –ù–æ–≤—ã–π –º–µ—Ç–æ–¥: `_format_task_list(tasks, max_items=5)` ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á —Å truncation

- `app/services/translations.py`:
  - 21 –Ω–æ–≤—ã–π –∫–ª—é—á –ø–µ—Ä–µ–≤–æ–¥–∞ (ru/en)
  - –ì—Ä—É–ø–ø—ã: `morning_*` (10 –∫–ª—é—á–µ–π), `evening_*` (11 –∫–ª—é—á–µ–π)

### Impact
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏ –≤ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è—Ö
- –ú–æ—Ç–∏–≤–∞—Ü–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –¥–µ–Ω—å –ø—Ä–∏ –ø—É—Å—Ç–æ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è —Ä–∏–µ–ª—Ç–æ—Ä–æ–≤

---

## [2025-12-11] - Daily Reminders Idempotency Fix

### Fixed
- **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ë–ê–ì: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ç—Ä–µ–Ω–Ω–∏—Ö/–≤–µ—á–µ—Ä–Ω–∏—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ**
  - –ü—Ä–æ–±–ª–µ–º–∞: —É—Ç—Ä–µ–Ω–Ω–∏–µ –∏ –≤–µ—á–µ—Ä–Ω–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –º–æ–≥–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
  - –ü—Ä–∏—á–∏–Ω–∞: –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç `morning_motivation` (–∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ in-memory set),
    `morning_reminder` –∏ `evening_reminder` –Ω–µ –∏–º–µ–ª–∏ –∑–∞—â–∏—Ç—ã –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
  - –†–µ—à–µ–Ω–∏–µ: SQLite-based –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (—Ç–∞–±–ª–∏—Ü–∞ `sent_daily_reminders`)

### Added
- **SQLite –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–ª—è daily reminders**
  - –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `sent_daily_reminders` –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î `/var/lib/calendar-bot/reminders.db`
  - –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω –∏–∑ `event_reminders_idempotent.py`
  - –¢—Ä–µ–∫–∏–Ω–≥ –ø–æ `(user_id, date, reminder_type)`
  - –¢–∏–ø—ã: `'morning'`, `'motivation'`, `'evening'`
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π cleanup –∑–∞–ø–∏—Å–µ–π —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π (–≤ 3:00 UTC)

- **–í—ã–Ω–µ—Å–µ–Ω–∏–µ `is_in_quiet_hours()` –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –º–æ–¥—É–ª—è**
  - –ë—ã–ª–∞: —Ñ—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å –∑–∞–Ω–æ–≤–æ –Ω–∞ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Ü–∏–∫–ª–∞ (61 —Ä–∞–∑/–º–∏–Ω)
  - –°—Ç–∞–ª–∞: –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥—É–ª—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π

### Changed
- –£–±—Ä–∞–Ω —É—Å—Ç–∞—Ä–µ–≤—à–∏–π `motivation_sent_today = set()` (–∑–∞–º–µ–Ω—ë–Ω –Ω–∞ SQLite)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ –ø—Ä–æ–≤–µ—Ä–∫–µ quiet hours

### Technical
- –§–∞–π–ª –∏–∑–º–µ–Ω—ë–Ω: `app/services/daily_reminders.py`
- –î–æ–±–∞–≤–ª–µ–Ω–æ: `import sqlite3`
- –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:
  - `_init_database()` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  - `_is_daily_reminder_sent()` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
  - `_record_daily_reminder()` ‚Äî –∑–∞–ø–∏—Å—å –æ–± –æ—Ç–ø—Ä–∞–≤–∫–µ
  - `cleanup_old_daily_reminders()` ‚Äî –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π

### –í–ª–∏—è–Ω–∏–µ
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –±–æ–ª—å—à–µ –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–∞—Ö/–¥–µ–ø–ª–æ—è—Ö
- –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É —Ä–µ—Å—Ç–∞—Ä—Ç–∞–º–∏ (SQLite)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

---

## [2025-12-10] - LLM Cost Optimization & Dialog Context

### Optimized
- **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ YandexGPT Lite** ‚Äî —ç–∫–æ–Ω–æ–º–∏—è ~4-5x –Ω–∞ —Ç–æ–∫–µ–Ω–∞—Ö
- **–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –Ω–∞ ~60%**
  - –£–±—Ä–∞–Ω—ã –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ (en, es, ar)
  - –û—Å—Ç–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫
  - –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–º–µ—Å—Ç–æ –º–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è date_context** ‚Äî —É–±—Ä–∞–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞—Ç

### Added
- **–ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ –¥–ª—è LLM –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**
  - –ù–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ `dialog_history` –≤ TelegramHandler (LRU, max 1000 users)
  - –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 –ø–∞—Ä —Å–æ–æ–±—â–µ–Ω–∏–π (user + bot) –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ LLM
  - –¢–µ–≥ `<dialog_history>` –≤ –ø—Ä–æ–º–ø—Ç–µ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –ú–µ—Ç–æ–¥—ã: `_add_to_dialog_history()`, `_get_dialog_history()`, `_clear_dialog_history()`

### Technical
- `app/services/llm_agent_yandex.py`:
  - –ú–æ–¥–µ–ª—å: `yandexgpt` ‚Üí `yandexgpt-lite`
  - base_system_prompt: ~250 —Å—Ç—Ä–æ–∫ ‚Üí ~70 —Å—Ç—Ä–æ–∫
  - lang_instructions: 4 —è–∑—ã–∫–∞ ‚Üí —Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–π
  - json_instructions: 4 —è–∑—ã–∫–∞ ‚Üí —Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–π
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è `conversation_history` –≤ `user_message_content`

- `app/services/telegram_handler.py`:
  - –ù–æ–≤–∞—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `MAX_DIALOG_HISTORY = 5`
  - –ù–æ–≤—ã–π LRUDict `dialog_history` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤
  - `_log_bot_response()` —Ç–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ `user_text`
  - –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ `user_text`

### Impact
- **–≠–∫–æ–Ω–æ–º–∏—è**: ~60-70% –Ω–∞ —Ç–æ–∫–µ–Ω–∞—Ö –∑–∞ –∑–∞–ø—Ä–æ—Å
- **–ö–∞—á–µ—Å—Ç–≤–æ**: –õ—É—á—à–µ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞
- **–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞**: ~4.5‚ÇΩ ‚Üí ~1.5‚ÇΩ (–ø—Ä–∏–º–µ—Ä–Ω–∞—è –æ—Ü–µ–Ω–∫–∞)

---

## [2025-12-10] - Extended Analytics & Bot Response Logging

### Added
- **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á (todos)**
  - `ActionType.TODO_CREATE` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
  - `ActionType.TODO_UPDATE` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
  - `ActionType.TODO_DELETE` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
  - `ActionType.TODO_COMPLETE` ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ/–Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ)
  - `ActionType.SETTINGS_CHANGED` ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∑–∞–¥–∞—á–∞–º–∏ —Ç–µ–ø–µ—Ä—å –≤–∏–¥–Ω—ã –≤ –¥–∏–∞–ª–æ–≥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

- **–ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –±–æ—Ç–∞**
  - –î–æ–±–∞–≤–ª–µ–Ω—ã `_log_bot_response()` –≤—ã–∑–æ–≤—ã –≤–æ –≤—Å–µ reply_text
  - –¢–µ–ø–µ—Ä—å –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –±–æ—Ç–∞ –≤ dialog history:
    - Rate limit —Å–æ–æ–±—â–µ–Ω–∏—è
    - –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
    - –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
    - –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
    - –ü–æ–∏—Å–∫ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
    - –ü–∞–∫–µ—Ç–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
    - –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Å–æ–±—ã—Ç–∏—è
    - –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
    - –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
    - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á

### Technical
- `app/models/analytics.py` ‚Äî –Ω–æ–≤—ã–µ ActionTypes –¥–ª—è todos
- `app/services/todos_service.py` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å analytics_service
- `app/services/telegram_handler.py` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–æ ~30 –≤—ã–∑–æ–≤–æ–≤ _log_bot_response()

### Impact
- –í –∞–¥–º–∏–Ω–∫–µ —Ç–µ–ø–µ—Ä—å –≤–∏–¥–µ–Ω –ø–æ–ª–Ω—ã–π –¥–∏–∞–ª–æ–≥ –±–æ—Ç ‚Üî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∑–∞–¥–∞—á–∞–º–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

## [2025-12-09] - Default Time for Events & Empty Schedule UX

### Fixed
- **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: `NoneType + timedelta` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–æ–±—ã—Ç–∏–π –±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏**
  - –û—à–∏–±–∫–∞: `unsupported operand type(s) for +: 'NoneType' and 'datetime.timedelta'`
  - –ü—Ä–∏—á–∏–Ω–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–≤–∞–ª —Å–æ–±—ã—Ç–∏–µ –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ ‚Üí `start_time = None` ‚Üí crash
  - –ü—Ä–∏–º–µ—Ä: "—Å–æ—Å—Ç–∞–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –ø—Ä–æ–∑–≤–æ–Ω–∞ –±–∞–∑—ã" (–±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏)
  - –†–µ—à–µ–Ω–∏–µ: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ default –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Å–æ–±—ã—Ç–∏–π –±–µ–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

### Added
- **Default start_time –¥–ª—è —Å–æ–±—ã—Ç–∏–π –±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏**
  - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–∫–∞–∑–∞–ª –≤—Ä–µ–º—è, —Å–æ–±—ã—Ç–∏–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
    - "–∑–∞–≤—Ç—Ä–∞" –±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏ ‚Üí –∑–∞–≤—Ç—Ä–∞ –≤ 09:00
    - "–ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞" –±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏ ‚Üí –ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞ –≤ 09:00
    - –ë–µ–∑ –¥–∞—Ç—ã (–¥–æ 18:00) ‚Üí –±–ª–∏–∂–∞–π—à–∏–π –∫—Ä—É–≥–ª—ã–π —á–∞—Å
    - –ë–µ–∑ –¥–∞—Ç—ã (–ø–æ—Å–ª–µ 18:00) ‚Üí –∑–∞–≤—Ç—Ä–∞ –≤ 09:00
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ multilingual: —Ä—É—Å—Å–∫–∏–π, –∞–Ω–≥–ª–∏–π—Å–∫–∏–π, –∏—Å–ø–∞–Ω—Å–∫–∏–π, –∞—Ä–∞–±—Å–∫–∏–π
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: `default_start_time_set` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

- **UX: –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –ø—É—Å—Ç–æ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏**
  - –ë—ã–ª–æ: "–ü—É—Å—Ç–æ ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ."
  - –°—Ç–∞–ª–æ: –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏—è
  - –ü—Ä–∏–º–µ—Ä—ã –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –∫ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø—Ä–æ—Å–∞ (—Å–µ–≥–æ–¥–Ω—è/–∑–∞–≤—Ç—Ä–∞/–¥–∞—Ç–∞)

- **Safety checks –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è crash**
  - `calendar_radicale.py:_create_event_sync` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ start_time –ø–µ—Ä–µ–¥ —Ä–∞—Å—á—ë—Ç–æ–º end_time
  - `telegram_handler.py:_handle_create_recurring` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ start_time –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å–æ–±—ã—Ç–∏–π

### Changed
- **–£–ª—É—á—à–µ–Ω–Ω—ã–µ error messages**
  - –ë—ã–ª–æ: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö. –£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –≤—Ä–µ–º—è."
  - –°—Ç–∞–ª–æ: –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è title –∏ time –æ—Ç–¥–µ–ª—å–Ω–æ

### Technical
- –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
  - `app/services/llm_agent_yandex.py` ‚Äî default start_time logic (—Å—Ç—Ä–æ–∫–∏ 1238-1263)
  - `app/services/telegram_handler.py` ‚Äî safety checks, error messages, empty schedule UX
  - `app/services/calendar_radicale.py` ‚Äî safety check (—Å—Ç—Ä–æ–∫–∏ 193-198)

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
| –í–≤–æ–¥ | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç |
|------|---------------------|
| "–°–æ–∑–≤–æ–Ω —Å –∫–æ–º–∞–Ω–¥–æ–π" (—É—Ç—Ä–æ–º) | –°–æ–±—ã—Ç–∏–µ –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–π —á–∞—Å |
| "–í—Å—Ç—Ä–µ—á–∞ –∑–∞–≤—Ç—Ä–∞" | –°–æ–±—ã—Ç–∏–µ –∑–∞–≤—Ç—Ä–∞ –≤ 09:00 |
| "–î–µ–ª–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è" (–ø—É—Å—Ç–æ) | –ü–æ–¥—Å–∫–∞–∑–∫–∞ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ |

---

## [2025-12-09] - Dialog History & Consent Tracking

### Added
- **–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∏–∞–ª–æ–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∞–¥–º–∏–Ω–∫–µ**
  - –ù–æ–≤—ã–π —Ç–∞–± "üí¨ –î–∏–∞–ª–æ–≥" –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (admin_report.html)
  - –•—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ —Å—Ç–∏–ª–µ —á–∞—Ç–∞:
    - –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–∏–Ω–∏–µ, —Å–ø—Ä–∞–≤–∞)
    - –û—Ç–≤–µ—Ç—ã –±–æ—Ç–∞ (—Å–µ—Ä—ã–µ, —Å–ª–µ–≤–∞)
    - –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (–ø–æ —Ü–µ–Ω—Ç—Ä—É)
  - –¶–≤–µ—Ç–æ–≤–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞: —Å–æ–≥–ª–∞—Å–∏—è (–∑–µ–ª—ë–Ω—ã–µ/–∫—Ä–∞—Å–Ω—ã–µ), –æ—à–∏–±–∫–∏ (–∫—Ä–∞—Å–Ω—ã–µ), —Å–æ–±—ã—Ç–∏—è (–∑–µ–ª—ë–Ω—ã–µ)

- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –±–æ—Ç–∞**
  - –ù–æ–≤—ã–π `ActionType.BOT_RESPONSE` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –±–æ—Ç–∞
  - –û—Ç–≤–µ—Ç—ã –±–æ—Ç–∞ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ analytics (–¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤)
  - –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–∏–¥–µ—Ç—å –ø–æ–ª–Ω—ã–π –¥–∏–∞–ª–æ–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üî –±–æ—Ç

- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–≥–ª–∞—Å–∏–π**
  - `ActionType.CONSENT_ADVERTISING_ACCEPTED/DECLINED`
  - `ActionType.CONSENT_PRIVACY_ACCEPTED/DECLINED`
  - –¢–µ–ø–µ—Ä—å –≤–∏–¥–Ω–æ –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–Ω—è–ª/–æ—Ç–∫–ª–æ–Ω–∏–ª —Å–æ–≥–ª–∞—Å–∏—è

### Technical
- `_log_bot_response()` helper –≤ TelegramHandler
- `loadAndRenderDialog()`, `renderDialog()` –≤ admin_report.html
- `getActionLabel()` –¥–ª—è —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –¥–µ–π—Å—Ç–≤–∏–π
- CSS —Å—Ç–∏–ª–∏ –¥–ª—è –¥–∏–∞–ª–æ–≥–∞: `.dialog-container`, `.dialog-msg-*`

---

## [2025-12-09] - Admin Panel Refactoring

### Changed
- **–ù–æ–≤–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
  - –ê–∫—Ç–∏–≤–Ω—ã–π = –µ—Å—Ç—å –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ —Å–æ–±—ã—Ç–∏—è –ò–õ–ò –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
  - –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π = –Ω–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π –ò –Ω–µ—Ç –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
  - –£–±—Ä–∞–Ω—ã –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏ "–° –∑–∞–¥–∞—á–∞–º–∏" –∏ "–° —Å–æ–±—ã—Ç–∏—è–º–∏"
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–ê–∫—Ç–∏–≤–Ω—ã—Ö" –∏ "–ù–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö"

- **–£–ø—Ä–æ—â—ë–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã**
  - –§–∏–ª—å—Ç—Ä "–ü–æ–∫–∞–∑–∞—Ç—å" —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç —Ç—Ä–∏ –æ–ø—Ü–∏–∏: –í—Å–µ / –ê–∫—Ç–∏–≤–Ω—ã–µ / –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ
  - –£–±—Ä–∞–Ω—ã –æ—Ç–¥–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ "–° –∑–∞–¥–∞—á–∞–º–∏" –∏ "–° —Å–æ–±—ã—Ç–∏—è–º–∏"

### Fixed
- **–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ª–æ–∞–¥–µ—Ä –ø—Ä–∏ —Ä–∞—Å–∫—Ä—ã—Ç–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏**
  - –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Ñ–æ–Ω–æ–≤–æ ‚Äî —Ä–µ–Ω–¥–µ—Ä–∏–º —Å—Ä–∞–∑—É –±–µ–∑ –ª–æ–∞–¥–µ—Ä–∞
  - `toggleUser()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –ª–æ–∞–¥–µ—Ä–∞
  - `loadUserData()` –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –æ–Ω–∏ —É–∂–µ –µ—Å—Ç—å

- **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏**
  - –¢–µ–ø–µ—Ä—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ (active + inactive = loaded)
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ "(18/30)" –ø–æ–∫–∞ –¥–∞–Ω–Ω—ã–µ –≥—Ä—É–∑—è—Ç—Å—è

### Added
- **–ù–∞–≤–∏–≥–∞—Ü–∏—è Dashboard ‚Üí User Report**
  - –ö–Ω–æ–ø–∫–∞ "üìã User Report" –≤ header admin.html
  - –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏

- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ sessionStorage**
  - –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ sessionStorage (TTL 5 –º–∏–Ω)
  - –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –∫—ç—à–∞
  - –î–æ–≥—Ä—É–∑–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  - –ö–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å" —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∫—ç—à –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å—ë

### Technical
- `saveToCache()`, `loadFromCache()`, `clearCache()` ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- `CACHE_KEY = 'admin_report_cache'`, `CACHE_TTL_MS = 5 * 60 * 1000`
- –ò–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ `getFilteredUsers()` –¥–ª—è –Ω–æ–≤–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ `updateSummary()` ‚Äî —Å—á–∏—Ç–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö/–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ

---

## [2025-12-09] - Admin Report Background Loading

### Added
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö** –≤ Admin Report
  - –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥—Ä—É–∑—è—Ç—Å—è todos –∏ events
  - –ù–µ –Ω—É–∂–Ω–æ –∫–ª–∏–∫–∞—Ç—å –Ω–∞ –∫–∞–∂–¥—É—é –∫–∞—Ä—Ç–æ—á–∫—É –≤—Ä—É—á–Ω—É—é
  - –î–∞–Ω–Ω—ã–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –ø–æ –º–µ—Ä–µ –∑–∞–≥—Ä—É–∑–∫–∏

- **–ü—Ä–æ–≥—Ä–µ—Å—Å-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏**
  - –í header –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è "‚è≥ –∑–∞–¥–∞—á–∏: 15/40" –∏–ª–∏ "‚è≥ —Å–æ–±—ã—Ç–∏—è: 8/40"
  - –î–≤–µ —Ñ–∞–∑—ã: —Å–Ω–∞—á–∞–ª–∞ todos (–±—ã—Å—Ç—Ä–æ), –ø–æ—Ç–æ–º events (–º–µ–¥–ª–µ–Ω–Ω–æ)
  - –°–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏

- **–ö–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä**
  - Todos: 4 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ (–ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã ‚Äî –±—ã—Å—Ç—Ä–æ)
  - Events: 2 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ (CalDAV ‚Äî –º–µ–¥–ª–µ–Ω–Ω–æ)
  - –ü–∞—É–∑–∞ 150ms –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏
  - –¢–∞–π–º–∞—É—Ç 15 —Å–µ–∫ –Ω–∞ –∑–∞–ø—Ä–æ—Å

- **–£–ª—É—á—à–µ–Ω–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å"**
  - –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Ñ–æ–Ω–æ–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É
  - –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É —Å –Ω—É–ª—è

### Technical
- `LOADING_CONFIG` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞ –∏ —Ç–∞–π–º–∞—É—Ç–æ–≤
- `loadingState` ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ (phase, loaded, total)
- `startBackgroundLoading()` ‚Äî –∑–∞–ø—É—Å–∫ –¥–≤—É—Ö—Ñ–∞–∑–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
- `loadDataInBatches()` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º concurrency
- `loadSingleUserData()` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å timeout
- `updateUserCardStats()` ‚Äî —Ç–æ—á–µ—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –±–µ–∑ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏ –≤—Å–µ–≥–æ —Å–ø–∏—Å–∫–∞
- `AbortController` ‚Äî –¥–ª—è –æ—Ç–º–µ–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

---

## [2025-12-09] - Admin Report Panel

### Added
- **–°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç—á—ë—Ç–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º** (`/static/admin_report.html`)
  - –ü—Ä–æ—Å–º–æ—Ç—Ä todos –∏ events –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
  - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É: –≤—Å–µ / —Å –∑–∞–¥–∞—á–∞–º–∏ / —Å —Å–æ–±—ã—Ç–∏—è–º–∏ / –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
  - –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ Telegram ID
  - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –≤—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å –∑–∞–¥–∞—á–∞–º–∏, —Å —Å–æ–±—ã—Ç–∏—è–º–∏

- **API endpoint** `GET /api/admin/report`
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç todos –∏ events –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `days_back`, `days_forward` –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞ —Å–æ–±—ã—Ç–∏–π
  - JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization

- **–°–∫—Ä—ã—Ç–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –≤—ã–¥–∞—á–∏**
  - –ö–Ω–æ–ø–∫–∞-–≥–ª–∞–∑–∏–∫ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage (`admin_hidden_users`)
  - –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ç–æ–≥–≥–ª –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –≤—Å–µ—Ö —Å–∫—Ä—ã—Ç—ã—Ö
  - –°–∫—Ä—ã—Ç—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å –ø–æ–Ω–∏–∂–µ–Ω–Ω–æ–π –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é

### Fixed
- **Bug:** `switchTab()` –≤—ã–∑—ã–≤–∞–ª—Å—è –±–µ–∑ –ø–µ—Ä–µ–¥–∞—á–∏ event
  - –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `e` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ `e.stopPropagation()`
- **Bug:** –û—à–∏–±–∫–∞ `can't compare offset-naive and offset-aware datetimes`
  - –ü—Ä–∏—á–∏–Ω–∞: `datetime.now()` –±–µ–∑ timezone —Å—Ä–∞–≤–Ω–∏–≤–∞–ª—Å—è —Å —Å–æ–±—ã—Ç–∏—è–º–∏ –∏–∑ CalDAV (—Å timezone)
  - –†–µ—à–µ–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `datetime.now(tz)` —Å timezone –∏–∑ settings
- **Perf:** –¢–∞–π–º–∞—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç—á—ë—Ç–∞ (40 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π √ó 5 —Å–µ–∫ CalDAV = 200 —Å–µ–∫)
  - –ü—Ä–∏—á–∏–Ω–∞: `/report` –∑–∞–≥—Ä—É–∂–∞–ª todos –∏ events –¥–ª—è –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
  - –†–µ—à–µ–Ω–∏–µ: Lazy loading ‚Äî –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ –∫–ª–∏–∫—É –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **Bug:** –ö–∞—Ä—Ç–æ—á–∫–∏ –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–ª–∏—Å—å (onclick handlers –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏)
  - –ü—Ä–∏—á–∏–Ω–∞: –§—É–Ω–∫—Ü–∏–∏ –Ω–µ –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ window scope
  - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–ª–µ–Ω–æ `window.toggleUser = toggleUser` –∏ —Ç.–¥.
- **UX:** –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∞—Å—å –ø—Ä–∏ —Å–∫—Ä—ã—Ç–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - –¢–µ–ø–µ—Ä—å –ø—Ä–∏ —Å–∫—Ä—ã—Ç–∏–∏/–ø–æ–∫–∞–∑–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—á—ë—Ç—á–∏–∫ "–í—Å–µ–≥–æ"
- **UX:** –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å aibroker_bot –ø–æ—Ä—Ç–∏–ª —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
  - –î–æ–±–∞–≤–ª–µ–Ω —Ñ–∏–ª—å—Ç—Ä TEST_USERNAMES –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤

### Technical
- `app/routers/admin.py`:
  - –£–ø—Ä–æ—â—ë–Ω endpoint `/report` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - –ù–æ–≤—ã–π endpoint `GET /users/{id}/todos` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é
  - –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π `GET /users/{id}/events` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–±—ã—Ç–∏–π
- `app/static/admin_report.html`:
  - Lazy loading –ø—Ä–∏ —Ä–∞—Å–∫—Ä—ã—Ç–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ todos –∏ events —á–µ—Ä–µ–∑ `Promise.all`
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ header –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
- –î–∏–∑–∞–π–Ω –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ß–ë UX/UI –≥–∞–π–¥–æ–º (—Ü–≤–µ—Ç–∞ #0b0b0b, #1a1a1a, —à—Ä–∏—Ñ—Ç Inter)

---

## [2025-12-05] - High Load Resilience Refactoring

### Added
- **Rate Limiting —á–µ—Ä–µ–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Redis**
  - –ü–æ–¥–∫–ª—é—á—ë–Ω —É–∂–µ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π `rate_limiter_redis.py` (–±—ã–ª –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è!)
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ `main.py` startup
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ `telegram_handler.py` –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
  - –õ–∏–º–∏—Ç—ã: 10 msg/min, 50 msg/hour, auto-block –ø—Ä–∏ —Å–ø–∞–º–µ

- **Circuit Breaker –¥–ª—è Yandex GPT**
  - –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–±–æ–µ–≤ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å API
  - –ü–æ—Å–ª–µ 5 –æ—à–∏–±–æ–∫ –ø–æ–¥—Ä—è–¥ ‚Äî circuit –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–∞ 60 —Å–µ–∫
  - –ö–ª–∞—Å—Å `CircuitOpenError` –¥–ª—è graceful degradation

- **Graceful Shutdown**
  - Flush –≤—Å–µ—Ö –±—É—Ñ–µ—Ä–æ–≤ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ (analytics, preferences)
  - –ó–∞–∫—Ä—ã—Ç–∏–µ HTTP –∫–ª–∏–µ–Ω—Ç–æ–≤ (llm_agent)
  - `stop_grace_period: 30s` –≤ docker-compose

### Changed
- **Analytics Service: –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è + —Ä–æ—Ç–∞—Ü–∏—è**
  - `_save_data()` –±–æ–ª—å—à–µ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥—ã–π `log_action()`
  - –ë—É—Ñ–µ—Ä `_pending_actions`, flush –∫–∞–∂–¥—ã–µ 100 –∑–∞–ø–∏—Å–µ–π
  - –†–æ—Ç–∞—Ü–∏—è: —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 50k –∑–∞–ø–∏—Å–µ–π
  - –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `flush()` –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞–ø–∏—Å–∏

- **User Preferences: dirty flag pattern**
  - `set_*()` –º–µ—Ç–æ–¥—ã –±–æ–ª—å—à–µ –Ω–µ –ø–∏—à—É—Ç –Ω–∞ –¥–∏—Å–∫ —Å—Ä–∞–∑—É
  - `_mark_dirty()` + auto-flush –∫–∞–∂–¥—ã–µ 10 –∏–∑–º–µ–Ω–µ–Ω–∏–π
  - –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `flush()` –¥–ª—è graceful shutdown

- **CalDAV: connection pooling + caching**
  - –ï–¥–∏–Ω—ã–π `_client` –≤–º–µ—Å—Ç–æ –Ω–æ–≤–æ–≥–æ –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å
  - –ö—ç—à –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–π —Å TTL 5 –º–∏–Ω—É—Ç (`_calendar_cache`)
  - LRU-eviction –ø—Ä–∏ >500 –∑–∞–ø–∏—Å–µ–π
  - –ú–µ—Ç–æ–¥ `invalidate_cache()` –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

- **Yandex GPT: httpx –≤–º–µ—Å—Ç–æ requests**
  - –ù–∞—Ç–∏–≤–Ω—ã–π async HTTP –∫–ª–∏–µ–Ω—Ç (–±–µ–∑ `asyncio.to_thread`)
  - Connection pooling —á–µ—Ä–µ–∑ `httpx.Limits`
  - –¢–∞–π–º–∞—É—Ç —É–º–µ–Ω—å—à–µ–Ω —Å 30s –¥–æ 15s

- **Webhook: concurrency limiting**
  - –°–µ–º–∞—Ñ–æ—Ä –Ω–∞ 50 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
  - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫—É –ø—Ä–∏ –Ω–∞–ø–ª—ã–≤–µ —Å–æ–æ–±—â–µ–Ω–∏–π

### Infrastructure
- **Docker resource limits**
  - `cpus: 2`, `memory: 1G` –¥–ª—è telegram-bot
  - `reservations: cpus 0.25, memory 256M`
  - Healthcheck interval: 15s (–±—ã–ª–æ 30s)

- **Config: redis_url**
  - –î–æ–±–∞–≤–ª–µ–Ω `redis_url` –∏ `redis_password` –≤ Settings

### Technical Files Changed
- `app/config.py` ‚Äî redis settings
- `app/main.py` ‚Äî rate limiter init, graceful shutdown
- `app/routers/telegram.py` ‚Äî semaphore
- `app/services/analytics_service.py` ‚Äî buffering, rotation
- `app/services/user_preferences.py` ‚Äî dirty flag
- `app/services/calendar_radicale.py` ‚Äî connection cache
- `app/services/telegram_handler.py` ‚Äî rate limit check
- `app/services/llm_agent_yandex.py` ‚Äî httpx, circuit breaker
- `docker-compose.secure.yml` ‚Äî resource limits

---

## [2025-12-05] - Event Context for Follow-up Commands

### Added
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–±—ã—Ç–∏–π –¥–ª—è follow-up –∫–æ–º–∞–Ω–¥**
  - –ü—Ä–æ–±–ª–µ–º–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞—ë—Ç "–≤ 10 –≤—Å—Ç—Ä–µ—á–∞, –≤ 11 –æ–±–µ–¥", –ø–æ—Ç–æ–º –≥–æ–≤–æ—Ä–∏—Ç "–ø–µ—Ä–µ–Ω–µ—Å–∏ —ç—Ç–∏ —Å–æ–±—ã—Ç–∏—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞" ‚Äî –±–æ—Ç –Ω–µ –∑–Ω–∞–ª –∫–∞–∫–∏–µ "—ç—Ç–∏"
  - –†–µ—à–µ–Ω–∏–µ: —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö event_uid –≤ `event_context` (LRUDict)
  - –ù–∞—Å—Ç—Ä–æ–π–∫–∏: `MAX_CONTEXT_EVENTS = 10`, `MAX_CONTEXT_MESSAGES = 5`
  - –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ N —Å–æ–æ–±—â–µ–Ω–∏–π –ë–ï–ó —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è (–Ω–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏)

- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ LLM –ø—Ä–æ–º–ø—Ç**
  - –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `recent_context` –≤ `extract_event()`
  - XML –±–ª–æ–∫ `<recent_context>` —Å ID –∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ —Å–æ–±—ã—Ç–∏–π
  - LLM –ø–æ–Ω–∏–º–∞–µ—Ç "—ç—Ç–∏ —Å–æ–±—ã—Ç–∏—è", "–∏—Ö", "–ø–µ—Ä–µ–ø–∏—à–∏", "–ø–µ—Ä–µ–Ω–µ—Å–∏"

### Technical
- `telegram_handler.py`:
  - `event_context: LRUDict` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
  - Helper-–º–µ—Ç–æ–¥—ã: `_add_to_event_context()`, `_remove_from_event_context()`, `_get_event_context()`, `_age_event_context()`, `_reset_context_age()`
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `_handle_create`, `_handle_batch_confirm`, `_handle_delete`
- `llm_agent_yandex.py`:
  - –ü–∞—Ä–∞–º–µ—Ç—Ä `recent_context` –≤ `extract_event()`
  - Prompt block —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –¥–ª—è LLM

---

## [2025-12-05] - Broadcast & Support Button

### Added
- **–°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—Å—ã–ª–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É**
  - –ù–æ–≤—ã–π endpoint `POST /api/admin/broadcast`
  - UI –≤ admin.html —Å –ø–æ–ª–µ–º –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∫–Ω–æ–ø–∫–∞–º–∏
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ HTML-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è inline –∫–Ω–æ–ø–∫–∞ "üöÄ –û–±–Ω–æ–≤–∏—Ç—å" (–≤—ã–∑—ã–≤–∞–µ—Ç /start)
  - –†–µ–∂–∏–º "—Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç" –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Å–µ–±–µ
  - Callback `broadcast:start` –≤ telegram_handler.py

- **–ö–Ω–æ–ø–∫–∞ "–ù–∞–ø–∏—Å–∞—Ç—å –Ω–∞–º" üí¨ –≤ –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–æ—Ç–∞**
  - Inline –∫–Ω–æ–ø–∫–∞ —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ t.me/iay_pm
  - –§–∞–π–ª: `app/services/telegram_handler.py`

- **–ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ ‚öôÔ∏è –≤ header WebApp**
- **–ú–æ–¥–∞–ª–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ WebApp** —Å –∫–Ω–æ–ø–∫–æ–π "–ù–∞–ø–∏—Å–∞—Ç—å –Ω–∞–º"

### Technical
- –§–∞–π–ª—ã: `app/routers/admin.py`, `app/static/admin.html`, `app/services/telegram_handler.py`, `app/static/index.html`
- –í–µ—Ä—Å–∏—è WebApp: `2025-12-04-v3` (UI: v982)
- Rate limiting: 50ms –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è ban –æ—Ç Telegram

---

## [2025-12-05] - Performance: Non-blocking CalDAV Operations

### Performance Improvements
- **LLM HTTP –≤—ã–∑–æ–≤—ã –±–æ–ª—å—à–µ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç event loop**
  - –û–±—ë—Ä–Ω—É—Ç `requests.post()` –≤ `asyncio.to_thread()`
  - –§–∞–π–ª: `app/services/llm_agent_yandex.py`

- **CalDAV –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–æ–ª—å—à–µ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç event loop**
  - `list_events` ‚Üí `_list_events_sync` + `asyncio.to_thread()`
  - `create_event` ‚Üí `_create_event_sync` + `asyncio.to_thread()`
  - `update_event` ‚Üí `_update_event_sync` + `asyncio.to_thread()`
  - `delete_event` ‚Üí `_delete_event_sync` + `asyncio.to_thread()`
  - `find_free_slots` —É–∂–µ async —á–µ—Ä–µ–∑ `list_events`
  - –§–∞–π–ª: `app/services/calendar_radicale.py`

### Diagnostics
- **–î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∞–π–º–∏–Ω–≥–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
  - `yandex_gpt_http_duration` ‚Äî –≤—Ä–µ–º—è HTTP –∑–∞–ø—Ä–æ—Å–∞ –∫ LLM
  - `calendar_found` ‚Äî –≤—Ä–µ–º—è –ø–æ–∏—Å–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `caldav_date_search_duration` ‚Äî –≤—Ä–µ–º—è –ø–æ–∏—Å–∫–∞ —Å–æ–±—ã—Ç–∏–π
  - `handle_text_llm_done` ‚Äî –æ–±—â–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è

### –û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç
- Event loop –æ—Å—Ç–∞—ë—Ç—Å—è responsive –≤–æ –≤—Ä–µ–º—è CalDAV –æ–ø–µ—Ä–∞—Ü–∏–π (~1-4 —Å–µ–∫)
- Bot –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–∫–∞ –∂–¥—ë—Ç –æ—Ç–≤–µ—Ç –æ—Ç Radicale/LLM
- –£–ª—É—á—à–µ–Ω–∞ –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å –ø—Ä–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö

---

## [2025-12-04] - Event Reminder Fix

### Bug Fixes
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏—è—Ö** ‚Äî –≤–º–µ—Å—Ç–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∫–ª—é—á–µ–π `in_30_minutes`, `time_label`, `location_label` —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —Ä—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç
  - –ü—Ä–∏—á–∏–Ω–∞: –∫–ª—é—á–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∏ –≤ —Å–ª–æ–≤–∞—Ä–µ TRANSLATIONS
  - –†–µ—à–µ–Ω–∏–µ: –∑–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ —Ö–∞—Ä–¥–∫–æ–¥ —Ä—É—Å—Å–∫–∏—Ö —Å—Ç—Ä–æ–∫ (—Å–µ—Ä–≤–∏—Å —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º)
  - –§–∞–π–ª: `app/services/event_reminders_idempotent.py`

---

## [2025-12-04] - Security & Code Quality Cleanup

### Security Fixes
- **–£–¥–∞–ª–µ–Ω—ã –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ credentials** –∏–∑ `test_feed_download.py`
  - –§–∞–π–ª—ã —Å–æ–¥–µ—Ä–∂–∞–ª–∏ –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –≤ URL –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
  - –£–¥–∞–ª–µ–Ω–æ: `app/test_feed_download.py`, `test_feed_download.py`

- **–£–¥–∞–ª—ë–Ω —É—Å—Ç–∞—Ä–µ–≤—à–∏–π admin.py —Å SHA-256 —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º**
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å–ª–∞–±–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–º–µ—Å—Ç–æ bcrypt
  - –°–æ–¥–µ—Ä–∂–∞–ª –ø–∞—Ä–æ–ª–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
  - –£–¥–∞–ª–µ–Ω–æ: `app/admin.py` (–∞–∫—Ç—É–∞–ª—å–Ω—ã–π –≤ `app/routers/admin.py`)

### Code Cleanup
- **–£–¥–∞–ª–µ–Ω–æ 29 –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Ñ–∞–π–ª–æ–≤** (6173 —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞)
  - –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã –≤ –∫–æ—Ä–Ω–µ –∏ app/
  - –°—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ telegram_handler.py, datetime_parser.py, events.py
  - –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ —É—Ç–∏–ª–∏—Ç—ã (fix_menu_button.py, populate_analytics.py)

### Bug Fixes
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤ Events API**
  - –î–æ–±–∞–≤–ª–µ–Ω `model_validator` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ `end > start`
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTTP 422 –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
  - –§–∞–π–ª: `app/routers/events.py`

- **Memory leak –≤ conversation_history**
  - –î–æ–±–∞–≤–ª–µ–Ω `LRUDict` —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ–º (max 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
  - –¢–∞–∫–∂–µ –ø—Ä–∏–º–µ–Ω—ë–Ω –∫ `user_timezones`
  - –§–∞–π–ª—ã: `app/utils/lru_dict.py`, `app/services/telegram_handler.py`

### Refactoring
- **Dependency Injection –¥–ª—è event_reminders**
  - –£–±—Ä–∞–Ω circular import —Ä–∏—Å–∫
  - `user_provider` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
  - –§–∞–π–ª—ã: `app/services/event_reminders_idempotent.py`, `run_polling.py`

- **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ _handle_text** (—É–º–µ–Ω—å—à–µ–Ω–∞ –Ω–∞ 25%)
  - –í—ã–¥–µ–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã: `_handle_settings_time_input()`, `_handle_delete_confirmation()`
  - –£–ª—É—á—à–µ–Ω–∞ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å
  - –§–∞–π–ª: `app/services/telegram_handler.py`

### Technical Stats
- –£–¥–∞–ª–µ–Ω–æ —Ñ–∞–π–ª–æ–≤: 32
- –£–¥–∞–ª–µ–Ω–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞: ~6900
- –ù–æ–≤—ã—Ö —É—Ç–∏–ª–∏—Ç: `app/utils/lru_dict.py`

---

## [2025-12-04] - Settings & Support Button

### Added
- **–ö–Ω–æ–ø–∫–∞ "–ù–∞–ø–∏—Å–∞—Ç—å –Ω–∞–º" üí¨ –≤ –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–æ—Ç–∞** ‚Äî inline –∫–Ω–æ–ø–∫–∞ —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ t.me/iay_pm
  - –ü–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏" –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ –±–æ—Ç–∞
  - –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —à–∞–≥–æ–≤
  - –§–∞–π–ª: `app/services/telegram_handler.py`

- **–ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ ‚öôÔ∏è –≤ header WebApp** (–±–æ–Ω—É—Å)
- **–ú–æ–¥–∞–ª–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ WebApp** —Å –∫–Ω–æ–ø–∫–æ–π "–ù–∞–ø–∏—Å–∞—Ç—å –Ω–∞–º"
- **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π popup –≤ WebApp** –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –≤ —á–∞—Ç

### Technical
- –§–∞–π–ª—ã: `app/services/telegram_handler.py`, `app/static/index.html`
- –í–µ—Ä—Å–∏—è WebApp: `2025-12-04-v3` (UI: v982)
- Telegram Bot: `InlineKeyboardButton` —Å `url` –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
- WebApp: `tg.showPopup()` + `tg.openTelegramLink()`

---

## [2025-12-04] - Reminders System Improvements v3

### Fixed
- **–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–π event_reminders** ‚Äî –±–æ–ª—å—à–µ –Ω–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞
  - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ —Å `EventRemindersService` (Set –≤ –ø–∞–º—è—Ç–∏) –Ω–∞ `EventRemindersServiceIdempotent` (SQLite)
  - –¢–µ–ø–µ—Ä—å event_reminders –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `daily_reminders.active_users` –∫–∞–∫ –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã
  - –§–∞–π–ª: `run_polling.py:11, 33-39`

- **Memory leak –≤ webapp_open_cache** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
  - –§—É–Ω–∫—Ü–∏—è `_cleanup_webapp_cache()` —É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ 1000 entries
  - –û—á–∏—â–∞—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ —Å—Ç–∞—Ä—à–µ 1 —á–∞—Å–∞
  - –§–∞–π–ª: `app/routers/events.py:25-36, 111`

- **–ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏ "Chat not found"** ‚Äî —Ç–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—è–µ—Ç—Å—è
  - –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `unregister_user()` –≤ `DailyRemindersService`
  - –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö "chat not found" –∏–ª–∏ "bot was blocked" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è
  - –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π: morning, motivation, evening, event
  - –§–∞–π–ª—ã: `daily_reminders.py:73-78, 129-136, 168-174, 221-227`, `event_reminders_idempotent.py:278-293`

### Changed
- **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** ‚Äî —É–±—Ä–∞–Ω–∞ –¥—É–±–ª–∏—Ä—É—é—â–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
  - –†–∞–Ω—å—à–µ: –¥–≤–∞ JSON —Ñ–∞–π–ª–∞ (`daily_reminder_users.json`, `event_reminder_users.json`)
  - –¢–µ–ø–µ—Ä—å: `daily_reminder_users.json` ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
  - –§–∞–π–ª: `run_polling.py:42-50`

### Technical
- –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
  - `run_polling.py` ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å, –µ–¥–∏–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
  - `app/services/daily_reminders.py` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω `unregister_user()`, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
  - `app/services/event_reminders_idempotent.py` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ "chat not found"
  - `app/routers/events.py` ‚Äî GC –¥–ª—è webapp cache

### –í–ª–∏—è–Ω–∏–µ
- –ù–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞
- –ü–∞–º—è—Ç—å –Ω–µ —É—Ç–µ–∫–∞–µ—Ç –ø—Ä–∏ –¥–æ–ª–≥–æ–π —Ä–∞–±–æ—Ç–µ
- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç—Å—è –æ—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö

---

## [2025-12-04] - Daily Reminders Fix v2 (Code Cleanup)

### Fixed
- **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è** ‚Äî —Ç–µ–ø–µ—Ä—å –ø—Ä–∏ –õ–Æ–ë–û–ú —Å–æ–æ–±—â–µ–Ω–∏–∏, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ /start
  - –†–∞–Ω—å—à–µ: 9 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ 15 –Ω–µ –ø–æ–ª—É—á–∞–ª–∏ event reminders (30 –º–∏–Ω –¥–æ —Å–æ–±—ã—Ç–∏—è)
  - –¢–µ–ø–µ—Ä—å: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç idempotent –Ω–∞ –ª—é–±–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
  - –§–∞–π–ª: `run_polling.py:36-45`

- **–ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ morning_enabled** ‚Äî —Ç–µ–ø–µ—Ä—å —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `morning_enabled` –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –º–æ—Ç–∏–≤–∞—Ü–∏–∏ –≤ 10:00
  - –§–∞–π–ª: `daily_reminders.py:313`

### Changed
- **–í—ã–Ω–µ—Å–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `is_time_match()` –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –º–æ–¥—É–ª—è** ‚Äî –±—ã–ª–∞ –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞, —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å 15 —Ä–∞–∑/–º–∏–Ω
  - –ü–µ—Ä–µ–º–µ—â–µ–Ω–∞ –Ω–∞ —Å—Ç—Ä–æ–∫—É 27 (—É—Ä–æ–≤–µ–Ω—å –º–æ–¥—É–ª—è)
  - –§–∞–π–ª: `daily_reminders.py:27-29`

- **–£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –∏–º–ø–æ—Ä—Ç—ã `timedelta`** ‚Äî –±—ã–ª–∏ –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–π
  - `timedelta` –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–º–ø–æ—Ä—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥—É–ª—è (—Å—Ç—Ä–æ–∫–∞ 4)
  - –£–¥–∞–ª–µ–Ω—ã `from datetime import timedelta` –Ω–∞ —Å—Ç—Ä–æ–∫–∞—Ö 81 –∏ 169
  - –§–∞–π–ª: `daily_reminders.py`

### Technical
- –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã: `run_polling.py`, `app/services/daily_reminders.py`
- –ß–∏—Å—Ç—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã

---

## [2025-12-04] - Daily Reminders Fix (Critical)

### Fixed
- **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ë–ê–ì: TEST_MODE = True –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ** ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å 14 –∏–∑ 15 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - –ò–∑–º–µ–Ω–µ–Ω–æ `TEST_MODE = True` ‚Üí `TEST_MODE = False` –≤ `daily_reminders.py`
  - –¢–µ–ø–µ—Ä—å –í–°–ï –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è (9:00 —É—Ç—Ä–µ–Ω–Ω–∏–µ, 20:00 –≤–µ—á–µ—Ä–Ω–∏–µ)

- **AttributeError: e.title** ‚Äî —É—Ç—Ä–µ–Ω–Ω–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–∞–¥–∞–ª–∏ —Å –æ—à–∏–±–∫–æ–π
  - `CalendarEvent` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞—Ç—Ä–∏–±—É—Ç `summary`, –Ω–µ `title`
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ `e.title` ‚Üí `e.summary` –≤ `daily_reminders.py:97`

- **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π ValueError –ø—Ä–∏ minute == 59** ‚Äî edge case –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏
  - –ó–∞–º–µ–Ω–µ–Ω–∞ —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ `time(hour, minute + 1)` –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `is_time_match()`

### Added
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏** ‚Äî —Ç–µ–ø–µ—Ä—å –≤ –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ:
  - –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ: `test_mode`, `active_users_count`
  - –ö–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç: `daily_reminders_check` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º

### Technical
- –§–∞–π–ª –∏–∑–º–µ–Ω—ë–Ω: `app/services/daily_reminders.py`
- –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏: 23, 97, 208, 218-228, 289-312

### –í–ª–∏—è–Ω–∏–µ
- 15 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞—á–Ω—É—Ç –ø–æ–ª—É—á–∞—Ç—å —É—Ç—Ä–µ–Ω–Ω–∏–µ/–≤–µ—á–µ—Ä–Ω–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 9:00 –∏ 20:00)
- –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ 10:00

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
```bash
# –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
docker logs telegram-bot 2>&1 | grep -E "daily_reminders_started|daily_reminders_check|morning_reminder_sent|evening_reminder_sent"
```

---

## [2025-12-04] - Analytics Data Quality Fixes

### Fixed
- **`total_logins` —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç** ‚Äî –∏–∑–º–µ–Ω—ë–Ω action_type —Å `user_start` –Ω–∞ `user_login`
- **–ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `from_voice` —á—Ç–æ–±—ã –Ω–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å `text_message` –ø–æ—Å–ª–µ STT
- **webapp_open –Ω–µ —Å–ø–∞–º–∏—Ç** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω rate limit (1 —Ä–∞–∑ –≤ 5 –º–∏–Ω—É—Ç –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

### Added
- **EVENT_QUERY —Ç–µ–ø–µ—Ä—å –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è** ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
- **Username –≤ WebApp –ª–æ–≥–∞—Ö** ‚Äî —Ç–µ–ø–µ—Ä—å –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ WebApp –∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–æ–±—ã—Ç–∏–π —á–µ—Ä–µ–∑ API —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è username/first_name/last_name
- **–§—É–Ω–∫—Ü–∏—è `verify_telegram_webapp_auth_full()`** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏–∑ Telegram initData

### Technical
- –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
  - `app/services/telegram_handler.py` ‚Äî user_login, from_voice flag, EVENT_QUERY logging
  - `app/routers/events.py` ‚Äî rate limit cache, user info –≤ –ª–æ–≥–∞—Ö
  - `app/middleware/telegram_auth.py` ‚Äî –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª–Ω–æ–π user info

### –í–ª–∏—è–Ω–∏–µ –Ω–∞ –¥–∞–Ω–Ω—ã–µ
- –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ —Å `user_start` –æ—Å—Ç–∞–Ω—É—Ç—Å—è, –Ω–æ–≤—ã–µ –±—É–¥—É—Ç `user_login`
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ `total_logins` –Ω–∞—á–Ω—ë—Ç —Ä–∞—Å—Ç–∏ —Å –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ú–µ–Ω—å—à–µ –º—É—Å–æ—Ä–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π `webapp_open` (—Ä–∞–Ω—å—à–µ: –∫–∞–∂–¥—ã–π API –∑–∞–ø—Ä–æ—Å, —Ç–µ–ø–µ—Ä—å: —Ä–∞–∑ –≤ 5 –º–∏–Ω)

---

## [2025-12-04] - Admin Panel Session Persistence (Deployed)

### Fixed
- **–°–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã** ‚Äî –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ –≤–≤–æ–¥–∏—Ç—å –ø–∞—Ä–æ–ª–∏ –∑–∞–Ω–æ–≤–æ
- **–°–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–∞–∂–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞** ‚Äî JWT —Ç–æ–∫–µ–Ω—ã –≤–º–µ—Å—Ç–æ in-memory storage
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `sessionStorage` ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ, –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
- **üöÄ DEPLOYED** ‚Äî –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω–æ –Ω–∞ –ø—Ä–æ–¥

### Technical
- –§–∞–π–ª—ã: `app/static/admin.html`, `app/routers/admin.py`
- **Frontend**: –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `sessionStorage` –ø–æ–¥ –∫–ª—é—á–æ–º `admin_session_token`
- **Backend**: JWT —Ç–æ–∫–µ–Ω—ã (PyJWT) –≤–º–µ—Å—Ç–æ in-memory dict
  - –¢–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 24 —á–∞—Å–∞
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `JWT_SECRET` –∏–∑ `.env` (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏)
  - Payload: `{mode: "real"|"fake", exp, iat}`
- –ü—Ä–∏ 401 –æ—à–∏–±–∫–µ (–∏—Å—Ç—ë–∫—à–∏–π —Ç–æ–∫–µ–Ω) —Å–µ—Å—Å–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç—Å—è
- **–ö–ª—é—á–µ–≤–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: `restoreSession()` —Ç–µ–ø–µ—Ä—å –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω –ü–ï–†–ï–î –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å–µ—Å—Å–∏–∏

---

## [2025-12-04] - Error Tracking for Admin Panel

### Added
- **–ù–æ–≤—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –≤ analytics** –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
  - `LLM_ERROR` - –æ—à–∏–±–∫–∏ Yandex GPT API
  - `LLM_PARSE_ERROR` - –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –æ—Ç–≤–µ—Ç–∞
  - `LLM_TIMEOUT` - —Ç–∞–π–º–∞—É—Ç—ã API (30—Å)
  - `CALENDAR_ERROR` - –æ—à–∏–±–∫–∏ Radicale (—Å–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
  - `STT_ERROR` - –æ—à–∏–±–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –≥–æ–ª–æ—Å–∞
  - `INTENT_UNCLEAR` - –∫–æ–≥–¥–∞ LLM –Ω–µ –ø–æ–Ω—è–ª –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

- **API endpoint `/api/admin/errors`** - –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∑–∞ N —á–∞—Å–æ–≤:
  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `hours` (1-168), `limit` (1-500)
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ç–∏–ø–∞–º
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ fake mode (–ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ)

- **–û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å**:
  - –ö–∞—Ä—Ç–æ—á–∫–∞ "–û—à–∏–±–∫–∏" —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞ 24—á
  - –ö–ª–∏–∫ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫
  - Breakdown –æ—à–∏–±–æ–∫ –ø–æ —Ç–∏–ø–∞–º –≤ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–µ
  - –ü–æ–∫–∞–∑ error_message –¥–ª—è –∫–∞–∂–¥–æ–π –æ—à–∏–±–∫–∏

### Technical
- –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
  - `app/models/analytics.py` - –Ω–æ–≤—ã–µ ActionType
  - `app/services/analytics_service.py` - –º–µ—Ç–æ–¥—ã get_errors(), get_error_stats()
  - `app/services/llm_agent_yandex.py` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ LLM –æ—à–∏–±–æ–∫
  - `app/services/calendar_radicale.py` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ calendar –æ—à–∏–±–æ–∫
  - `app/services/telegram_handler.py` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ STT –∏ INTENT_UNCLEAR
  - `app/routers/admin.py` - –Ω–æ–≤—ã–π endpoint /errors
  - `app/static/admin.html` - UI –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–æ–∫

### –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ
–¢–µ–ø–µ—Ä—å –≤ –∞–¥–º–∏–Ω–∫–µ –º–æ–∂–Ω–æ –≤–∏–¥–µ—Ç—å:
1. –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª –æ—à–∏–±–∫—É (–∏ –∫–∞–∫—É—é)
2. –ß—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–ª—Å—è —Å–¥–µ–ª–∞—Ç—å
3. –ö–∞–∫–æ–π —Ç–∏–ø –ø—Ä–æ–±–ª–µ–º—ã (API, –ø–∞—Ä—Å–∏–Ω–≥, –∫–∞–ª–µ–Ω–¥–∞—Ä—å, –≥–æ–ª–æ—Å)
4. –°–∫–æ–ª—å–∫–æ "—É—Ç–æ—á–Ω–µ–Ω–∏–π" —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (–ø–ª–æ—Ö–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)

---

## [2025-12-04] - Admin Panel Fix

### Fixed
- **admin.html**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è frontend —Å backend API
  - –§–æ—Ä–º–∞ –ª–æ–≥–∏–Ω–∞ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/api/admin/verify` (–±—ã–ª–æ: `/login`)
  - –î–æ–±–∞–≤–ª–µ–Ω–æ —Ç—Ä–µ—Ç—å–µ –ø–æ–ª–µ –ø–∞—Ä–æ–ª—è –¥–ª—è 3-—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  - Dashboard –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (`/stats`, `/users`, `/timeline`, `/actions`)
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å —Ç–æ–∫–µ–Ω–æ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (`data.token` –≤–º–µ—Å—Ç–æ `data.session_token`)

### Added
- **admin.py**: –ù–æ–≤—ã–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
  - `GET /api/admin/timeline` - –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ä—è–¥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞ N —á–∞—Å–æ–≤
  - `GET /api/admin/actions` - –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

- **telegram_handler.py**: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—è –≤ analytics
  - `event_create` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞
  - `event_update` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
  - `event_delete` - —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è

### Technical
- –§–∞–π–ª—ã: `admin.html`, `app/routers/admin.py`, `app/services/telegram_handler.py`
- –¢–µ–ø–µ—Ä—å –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ analytics_service
- –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `/var/lib/calendar-bot/analytics_data.json.enc` (—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ)

### API Reference
```
POST /api/admin/verify    - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (3 –ø–∞—Ä–æ–ª—è)
GET  /api/admin/stats     - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
GET  /api/admin/users     - –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
GET  /api/admin/users/{id}/dialog - –î–∏–∞–ª–æ–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET  /api/admin/users/{id}/events - –°–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET  /api/admin/timeline  - –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
GET  /api/admin/actions   - –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
GET  /api/admin/health    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
```

---

## [2025-12-04] - System Documentation

### Added
- **SYSTEM_GUIDE.md** ‚Äî –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–∏—Å—Ç–µ–º–µ (500+ —Å—Ç—Ä–æ–∫)
  - –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å –¥–∏–∞–≥—Ä–∞–º–º–∞–º–∏
  - –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ª–æ–∫–∞–ª—å–Ω–æ –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
  - Docker –∫–æ–º–∞–Ω–¥—ã –∏ –ø—Ä–∞–≤–∏–ª–∞
  - Git workflow
  - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é
  - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ smoke-—Ç–µ—Å—Ç—ã
  - Troubleshooting

### Technical
- –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ DEPLOY.md, CLAUDE.md –∏ docs/
- –°–ª—É–∂–∏—Ç –µ–¥–∏–Ω–æ–π —Ç–æ—á–∫–æ–π –≤—Ö–æ–¥–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–µ–∫—Ç–æ–º

---

## [2025-12-04] - Fix Todos Data Loss (Critical)

### Fixed
- **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ë–ê–ì: –ü–æ—Ç–µ—Ä—è –∑–∞–¥–∞—á –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**
- –ü—É—Ç—å `/var/lib/calendar-bot/` –Ω–µ –±—ã–ª –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ Docker volume
- –ü—Ä–∏ –∫–∞–∂–¥–æ–º `docker-compose build --no-cache` —Ç–µ—Ä—è–ª–∏—Å—å:
  - –í—Å–µ –∑–∞–¥–∞—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`/var/lib/calendar-bot/todos/`)
  - –ö–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (`/var/lib/calendar-bot/.encryption_key`)
  - –î–∞–∂–µ –µ—Å–ª–∏ —Ñ–∞–π–ª—ã –±—ã–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, –∫–ª—é—á –±—ã–ª –Ω–æ–≤—ã–π = —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞

### Added
- **Docker volume `bot-data`** ‚Äî –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç–∞
- Mount: `bot-data:/var/lib/calendar-bot`

### Technical
- –§–∞–π–ª: `docker-compose.secure.yml`
- –ü—Ä–∏—á–∏–Ω–∞: TodosService –∏ EncryptedStorage –∏—Å–ø–æ–ª—å–∑—É—é—Ç `/var/lib/calendar-bot/`
- –†–µ—à–µ–Ω–∏–µ: –¥–æ–±–∞–≤–ª–µ–Ω named volume –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏
- –≠—Ç–æ –ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (–æ–Ω–∏ –≤ Radicale volume)

### Why this happened
```
# –ë—ã–ª–æ (–ù–ï –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å):
volumes:
  - ./logs:/app/logs
  - ./data:/app/data
  - ./credentials:/app/credentials
  # /var/lib/calendar-bot –ù–ï –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–ª—Å—è!

# –°—Ç–∞–ª–æ (—Ç–µ–ø–µ—Ä—å –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è):
volumes:
  - ./logs:/app/logs
  - ./data:/app/data
  - ./credentials:/app/credentials
  - bot-data:/var/lib/calendar-bot  # <-- FIX
```

---

## [2025-12-04] - Automated Smoke Testing

### Added
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π smoke-—Ç–µ—Å—Ç** ‚Äî `scripts/monitoring/smoke_test.sh`
- **–û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á—ë—Ç–æ–≤ –≤ Telegram** ‚Äî –±–æ—Ç @dogovorarenda_bot
- **10 –ø—Ä–æ–≤–µ—Ä–æ–∫ —Å–∏—Å—Ç–µ–º—ã:**
  - Health endpoint
  - WebApp endpoint
  - Static files –≤–µ—Ä—Å–∏—è
  - Events/Todos API auth (–∑–∞—â–∏—Ç–∞ HMAC)
  - SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (—Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è)
  - Response time
  - Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (3/3 healthy)
  - –û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö –∑–∞ 6—á
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ
- **Cron —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ** ‚Äî 10:00 –∏ 17:00 –ø–æ –ú–æ—Å–∫–≤–µ
- **–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é** ‚Äî `docs/06-testing/SMOKE_TEST_GUIDE.md`

### Technical
- Chat ID: 2296243 (@nikita_tita)
- –°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ cron: `scripts/monitoring/setup_cron.sh`
- –õ–æ–≥–∏: `/var/log/smoke_test.log`

### Usage
```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –≤—Ä—É—á–Ω—É—é
SMOKE_TEST_CHAT_ID=2296243 ./scripts/monitoring/smoke_test.sh

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ cron –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
./scripts/monitoring/setup_cron.sh
```

---

## [2025-12-04] - Docker Architecture Cleanup

### Changed
- **–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è docker-compose** - —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ñ–∞–π–ª `docker-compose.secure.yml`
- **–ï–¥–∏–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä** - `telegram-bot` –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏ FastAPI, –∏ Telegram polling bot
- **–ò–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤** - `telegram-bot`, `calendar-redis`, `radicale-calendar`
- **Healthcheck** - HTTP –ø—Ä–æ–≤–µ—Ä–∫–∞ `/health` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (FastAPI —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 8000)

### Removed
- `docker-compose.yml` - —É–¥–∞–ª—ë–Ω (–±—ã–ª –¥—É–±–ª–µ–º)
- `docker-compose.polling.yml` - —É–¥–∞–ª—ë–Ω (—É—Å—Ç–∞—Ä–µ–ª)
- `docker-compose.production.yml` - —É–¥–∞–ª—ë–Ω (—É—Å—Ç–∞—Ä–µ–ª)
- –§–∞–π–ª—ã –∏–∑ `app/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ - —É–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏ docker-compose

### Technical
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: –æ–¥–∏–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `telegram-bot` —Å `Dockerfile.bot` + `start.sh`
- `start.sh` –∑–∞–ø—É—Å–∫–∞–µ—Ç uvicorn (FastAPI) –∏ python run_polling.py –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- Healthcheck –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `/health` endpoint —á–µ—Ä–µ–∑ curl

### Deployment
```bash
# –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–µ–ø–ª–æ—è
ssh -i ~/.ssh/id_housler root@95.163.227.26 '
  cd /root/ai-calendar-assistant/ai-calendar-assistant &&
  git pull origin main &&
  docker-compose -f docker-compose.secure.yml build --no-cache telegram-bot &&
  docker-compose -f docker-compose.secure.yml up -d telegram-bot
'
```

---

## [2025-12-04] - Data Protection & External Volume

### Fixed
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å–æ–±—ã—Ç–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è** - 447 —Å–æ–±—ã—Ç–∏–π –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ Docker volume
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –¥–µ–ø–ª–æ–µ** - –¥–∞–Ω–Ω—ã–µ —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω—è—Ç—Å—è –≤–æ –≤–Ω–µ—à–Ω–µ–º volume

### Added
- `scripts/backup-radicale.sh` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø –¥–∞–Ω–Ω—ã—Ö Radicale
- `scripts/restore-radicale.sh` - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
- `scripts/safe-deploy.sh` - –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–µ–ø–ª–æ–π —Å –∞–≤—Ç–æ–±—ç–∫–∞–ø–æ–º
- –í–Ω–µ—à–Ω–∏–π Docker volume `calendar-radicale-data` –¥–ª—è –∑–∞—â–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö

### Changed
- **docker-compose.secure.yml** - Radicale —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç external volume
- Volume `calendar-radicale-data` –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ `docker-compose down -v`

### Technical
- –ü—Ä–∏—á–∏–Ω–∞ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö: Docker —Å–æ–∑–¥–∞–≤–∞–ª –Ω–æ–≤—ã–π volume –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏–º–µ–Ω–∏ –ø—Ä–æ–µ–∫—Ç–∞
- –°—Ç–∞—Ä—ã–π volume: `ai-calendar-assistant_radicale_data` (–ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ)
- –ù–æ–≤—ã–π volume: `ai-calendar-assistant_radicale-data` (–¥–µ—Ñ–∏—Å)
- –†–µ—à–µ–Ω–∏–µ: –≤–Ω–µ—à–Ω–∏–π volume —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º `calendar-radicale-data`

### Backup Commands
```bash
# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø
./scripts/backup-radicale.sh

# –ü–æ–∫–∞–∑–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –±—ç–∫–∞–ø—ã
./scripts/restore-radicale.sh --list

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±—ç–∫–∞–ø–∞
./scripts/restore-radicale.sh --latest

# –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–µ–ø–ª–æ–π (—Å –∞–≤—Ç–æ–±—ç–∫–∞–ø–æ–º)
./scripts/safe-deploy.sh
```

---

## [2025-12-04] - Production Cleanup & Git-only Workflow

### Changed
- **–ü–æ–ª–Ω–∞—è —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è production —Å–µ—Ä–≤–µ—Ä–∞** - —É–¥–∞–ª–µ–Ω—ã –≤—Å–µ –¥—É–±–ª–∏–∫–∞—Ç—ã —Ñ–∞–π–ª–æ–≤
- **Git-only workflow** - —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ–º –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ git, –±–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∫–æ–ø–∏–π
- –ß–∏—Å—Ç—ã–π git clone –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤

### Added
- `Dockerfile.bot` –¥–æ–±–∞–≤–ª–µ–Ω –≤ git (—Ä–∞–Ω—å—à–µ –±—ã–ª —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
- `CLAUDE.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
- –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π `DEPLOY.md` —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏

### Technical
- –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: `/root/ai-calendar-assistant/ai-calendar-assistant/`
- Docker –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–∑ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- –ë—ç–∫–∞–ø —Å—Ç–∞—Ä–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: `/root/backup_before_cleanup_20251204/`

### Deployment
```bash
# –ù–æ–≤—ã–π –¥–µ–ø–ª–æ–π (–æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞)
ssh -i ~/.ssh/id_housler root@95.163.227.26 '
  cd /root/ai-calendar-assistant/ai-calendar-assistant &&
  git pull origin main &&
  docker-compose -f docker-compose.secure.yml build --no-cache telegram-bot &&
  docker-compose -f docker-compose.secure.yml up -d telegram-bot
'
```

---

## [2025-12-04] - WebApp Fixes v1

### Fixed
- **–°–∫—Ä–æ–ª–ª –∫ "–°–µ–≥–æ–¥–Ω—è"**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∫–æ–≥–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–ª–∞—Å—å –∫ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–π—Å—Ç–≤–∏–∏. –¢–µ–ø–µ—Ä—å —Å–∫—Ä–æ–ª–ª –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ.
- **–ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á –≤ WebApp.

### Added
- `initialScrollDone` —Ñ–ª–∞–≥ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞
- `openNewTodo()` —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
- `createTodo()` —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è POST-–∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ API —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
- –ö–Ω–æ–ø–∫–∞ "+ –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞" –≤ —Å–ø–∏—Å–∫–µ –∑–∞–¥–∞—á
- –£—Å–ª–æ–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å" / "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" –≤ —Ñ–æ—Ä–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `scripts/deploy_sync.sh` - —Å–∫—Ä–∏–ø—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ git —Å docker build context

### Technical
- –í–µ—Ä—Å–∏—è WebApp: `2025-12-04-v1`
- –§–∞–π–ª: `app/static/index.html`

### Deployment Notes
–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –µ—Å—Ç—å –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
- Git repo: `/root/ai-calendar-assistant/ai-calendar-assistant/`
- Docker context: `/root/ai-calendar-assistant/`

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `deploy_sync.sh` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è:
```bash
ssh root@95.163.227.26 '/root/ai-calendar-assistant/deploy_sync.sh'
```

---

## [2025-12-03] - Repository Cleanup

### Changed
- –£–¥–∞–ª–µ–Ω–æ 518 –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- –†–µ–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

---

## [2025-11-29] - Todos Integration

### Added
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–∞–¥–∞—á (todos) –≤ –æ—Å–Ω–æ–≤–Ω–æ–π WebApp
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ `todos.html` –∏ `index.html` –≤ –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –¢–∞–±—ã "–°–æ–±—ã—Ç–∏—è" –∏ "–ó–∞–¥–∞—á–∏" –≤ WebApp

---

## [2025-10-28] - WebApp Click Fix

### Fixed
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∫–æ–≥–¥–∞ –∫–ª–∏–∫–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏
- –§—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ (`window.viewEvent`, etc.)
- –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### Technical
- –í–µ—Ä—Å–∏—è: `2025-10-28-17:30`
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `docs/03-features/webapp/WEBAPP_FIX_REPORT.md`

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–µ—Ä—Å–∏–π WebApp

| –í–µ—Ä—Å–∏—è | –î–∞—Ç–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|----------|
| 2025-12-04-v1 | 2025-12-04 | –§–∏–∫—Å —Å–∫—Ä–æ–ª–ª–∞ + —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á |
| 2025-11-29-16:00 | 2025-11-29 | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è todos |
| 2025-10-28-17:30 | 2025-10-28 | –§–∏–∫—Å –∫–ª–∏–∫–æ–≤ |

---

## –ö–∞–∫ –¥–æ–±–∞–≤–ª—è—Ç—å –∑–∞–ø–∏—Å–∏

–ü—Ä–∏ –≤–Ω–µ—Å–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–æ–±–∞–≤–ª—è–π—Ç–µ –∑–∞–ø–∏—Å—å –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

```markdown
## [YYYY-MM-DD] - –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

### Added (–Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)
- –û–ø–∏—Å–∞–Ω–∏–µ

### Changed (–∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º)
- –û–ø–∏—Å–∞–Ω–∏–µ

### Fixed (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–≥–æ–≤)
- –û–ø–∏—Å–∞–Ω–∏–µ

### Removed (—É–¥–∞–ª—ë–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)
- –û–ø–∏—Å–∞–Ω–∏–µ

### Technical (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏)
- –í–µ—Ä—Å–∏—è, —Ñ–∞–π–ª—ã, –∫–æ–º–∞–Ω–¥—ã –¥–µ–ø–ª–æ—è
```
