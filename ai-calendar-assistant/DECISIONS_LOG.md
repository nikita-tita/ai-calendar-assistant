# Журнал решений (ADR Log)

**Последнее обновление:** 2026-01-09

Этот файл фиксирует значимые технические и архитектурные решения проекта.

---

## Формат записи

```
## DEC-XXX: Название решения
- **Дата:** YYYY-MM-DD
- **Статус:** Принято / Отменено / Заменено (DEC-YYY)
- **Контекст:** Почему возник вопрос
- **Решение:** Что решили
- **Альтернативы:** Что рассматривали
- **Последствия:** Что это означает
```

---

## 2026

### DEC-001: Полный code review перед масштабированием

- **Дата:** 2026-01-09
- **Статус:** Принято
- **Контекст:** Проект работает в production, но накопился технический долг. Перед добавлением новых фич необходимо понять реальное состояние кодовой базы.
- **Решение:** Провести полный Principal Engineer review по всем аспектам: безопасность, архитектура, код, инфраструктура, тесты, документация.
- **Альтернативы:**
  1. Продолжить добавлять фичи — риск накопления долга
  2. Частичный review — неполная картина
- **Последствия:**
  - Выявлено 45 проблем (10 Blocker, 13 High)
  - Создан приоритизированный backlog
  - Неделя 1 посвящена security fixes
- **Артефакт:** `FULL_CODE_REVIEW_2026-01-09.md`

---

### DEC-002: Приоритет безопасности над фичами

- **Дата:** 2026-01-09
- **Статус:** Принято
- **Контекст:** Code review выявил критические security issues (секреты в Git, SQL Injection, XSS). Одновременно есть запросы на новые фичи.
- **Решение:** Заморозить feature development до закрытия всех Blocker security issues (SEC-001 через SEC-005).
- **Альтернативы:**
  1. Параллельная работа — риск отвлечения от security
  2. Отложить security — неприемлемый риск
- **Последствия:**
  - Неделя 1: только security fixes
  - Новые фичи начнутся после закрытия Blockers
  - Возможно недовольство stakeholders

---

### DEC-003: Структура проектной документации

- **Дата:** 2026-01-09
- **Статус:** Принято
- **Контекст:** Документация была разрозненной (80+ файлов), отсутствовал единый backlog и tracking рисков.
- **Решение:** Внедрить стандартную структуру TPM:
  - `PROJECT_STATUS.md` — снимок состояния
  - `BACKLOG.md` — единый источник задач (Kanban)
  - `RISKS_AND_BLOCKERS.md` — tracking рисков
  - `DECISIONS_LOG.md` — журнал решений
- **Альтернативы:**
  1. Использовать Jira/Linear — overhead для малой команды
  2. Оставить как есть — потеря контроля
- **Последствия:**
  - Все задачи в одном месте
  - Прозрачность для команды
  - Требуется дисциплина обновления

---

## 2025

### DEC-004: Миграция на новый сервер (reg.ru)

- **Дата:** 2026-01-07
- **Статус:** Принято
- **Контекст:** Старый сервер (91.229.8.221) был удалён хостингом. Данные пользователей потеряны.
- **Решение:** Развернуть на новом сервере reg.ru (95.163.227.26) с нуля.
- **Альтернативы:**
  1. Восстановить старый сервер — невозможно
  2. Другой хостинг — нет времени на исследование
- **Последствия:**
  - Потеря всех данных пользователей
  - Необходимость повторного onboarding
  - **Урок:** нужны автоматические бэкапы (INFRA-001)

---

### DEC-005: Yandex GPT вместо Claude/OpenAI

- **Дата:** 2025 (точная дата неизвестна)
- **Статус:** Принято
- **Контекст:** Проект изначально использовал Claude API. Необходимо было выбрать LLM для production.
- **Решение:** Использовать Yandex GPT как основной LLM.
- **Альтернативы:**
  1. Claude API — дороже, требует зарубежную оплату
  2. OpenAI — аналогичные проблемы
  3. Локальная модель — недостаточное качество
- **Последствия:**
  - Российские платежи, рублёвый биллинг
  - Специфика content moderation Yandex
  - Необходимость обработки "refusal" responses

---

### DEC-006: Radicale вместо Google Calendar API only

- **Дата:** 2025 (точная дата неизвестна)
- **Статус:** Принято
- **Контекст:** Нужно хранить календарные данные. Варианты: только Google Calendar, собственный CalDAV, гибрид.
- **Решение:** Использовать Radicale (self-hosted CalDAV) как primary storage.
- **Альтернативы:**
  1. Только Google Calendar — зависимость от Google, требует OAuth от каждого пользователя
  2. Собственная БД — изобретение велосипеда
  3. Cal.com — тяжеловесно
- **Последствия:**
  - Полный контроль над данными
  - Нет зависимости от внешних сервисов
  - CalDAV стандарт — возможна будущая синхронизация
  - Требуется self-hosting и бэкапы

---

### DEC-007: Fernet для шифрования todos

- **Дата:** 2025 (точная дата неизвестна)
- **Статус:** Принято
- **Контекст:** Задачи (todos) могут содержать чувствительные данные. Нужно шифрование at rest.
- **Решение:** Использовать Fernet (symmetric encryption) из библиотеки cryptography.
- **Альтернативы:**
  1. Без шифрования — неприемлемо для PII
  2. AES напрямую — больше кода, риск ошибок
  3. Asymmetric encryption — излишне сложно
- **Последствия:**
  - Todos зашифрованы на диске
  - Требуется secure storage для ключа
  - При потере ключа — потеря данных

---

### DEC-008: 3-пароля для admin (legacy)

- **Дата:** 2025 (точная дата неизвестна)
- **Статус:** Заменено (DEC-009)
- **Контекст:** Admin panel требует защиты. Стандартный login/password недостаточен.
- **Решение:** Система 3 паролей: все 3 правильные = доступ, 2 из 3 = "fake mode".
- **Альтернативы:**
  1. Обычный login/password — слабая защита
  2. 2FA сразу — сложнее реализовать
- **Последствия:**
  - Нестандартная схема, сложно объяснить
  - "Fake mode" создаёт ложное чувство безопасности
  - Заменено на JWT + TOTP в admin_v2

---

### DEC-009: JWT + TOTP для admin v2

- **Дата:** 2025 (точная дата неизвестна)
- **Статус:** Принято
- **Контекст:** 3-пароля оказались неудобными и нестандартными. Нужна современная аутентификация.
- **Решение:** Admin v2 использует login/password + TOTP (Google Authenticator) + JWT tokens.
- **Альтернативы:**
  1. Оставить 3-пароля — deprecated
  2. OAuth2 — overhead для одного admin
- **Последствия:**
  - Стандартная 2FA схема
  - JWT с IP/UA binding
  - Совместимость с Google Authenticator

---

## Шаблон для новых решений

```markdown
### DEC-XXX: [Название]

- **Дата:** YYYY-MM-DD
- **Статус:** Принято
- **Контекст:** [Почему возник вопрос]
- **Решение:** [Что решили делать]
- **Альтернативы:**
  1. [Вариант 1] — [почему не подошёл]
  2. [Вариант 2] — [почему не подошёл]
- **Последствия:**
  - [Что это означает для проекта]
  - [Какие trade-offs]
```

---

*Журнал решений — источник правды для архитектурных и технических решений*
