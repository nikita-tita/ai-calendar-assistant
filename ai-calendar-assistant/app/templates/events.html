{% extends "base.html" %}

{% block title %}–°–æ–±—ã—Ç–∏—è{% endblock %}

{% block content %}
<div class="header">
    <h1>üìã –í—Å–µ —Å–æ–±—ã—Ç–∏—è</h1>
</div>

<div class="events-section">
    <div id="events-container" class="events-container">
        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π...</div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadAllEvents();
});

async function loadAllEvents() {
    const container = document.getElementById('events-container');
    
    try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–±—ã—Ç–∏—è –Ω–∞ –Ω–µ–¥–µ–ª—é
        const response = await fetch('/api/events/week');
        const events = await response.json();
        
        if (events.length === 0) {
            container.innerHTML = '<div class="empty-state">–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ</div>';
            return;
        }
        
        let html = '';
        events.forEach(event => {
            const date = new Date(event.start).toLocaleDateString('ru-RU');
            const time = new Date(event.start).toLocaleTimeString('ru-RU', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            html += `
                <div class="event-card">
                    <div class="event-date">${date}</div>
                    <div class="event-time">${time}</div>
                    <div class="event-title">${event.title || '–°–æ–±—ã—Ç–∏–µ'}</div>
                    ${event.location ? `<div class="event-location">üìç ${event.location}</div>` : ''}
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        container.innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—ã—Ç–∏–π</div>';
        console.error('Error loading events:', error);
    }
}
</script>
{% endblock %}