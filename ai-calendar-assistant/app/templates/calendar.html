{% extends "base.html" %}

{% block title %}–ö–∞–ª–µ–Ω–¥–∞—Ä—å{% endblock %}

{% block content %}
<div class="header">
    <div class="logo">üìÖ</div>
    <h1>–ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç</h1>
    <p>–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫</p>
</div>

<div class="quick-actions">
    <button class="btn btn-primary" onclick="loadEvents('today')">
        üìã –°–µ–≥–æ–¥–Ω—è
    </button>
    <button class="btn btn-secondary" onclick="loadEvents('tomorrow')">
        üìÖ –ó–∞–≤—Ç—Ä–∞
    </button>
    <button class="btn btn-secondary" onclick="loadEvents('week')">
        üìÜ –ù–µ–¥–µ–ª—è
    </button>
</div>

<div class="events-section">
    <h3>–°–æ–±—ã—Ç–∏—è</h3>
    <div id="events-container" class="events-container">
        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
</div>

<div class="create-section">
    <button class="btn btn-success" onclick="showCreateForm()">
        ‚ûï –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ
    </button>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Telegram Web App initialization
let tg = window.Telegram.WebApp;
tg.expand();
tg.ready();

// Load today's events by default
document.addEventListener('DOMContentLoaded', function() {
    loadEvents('today');
});

async function loadEvents(period) {
    const container = document.getElementById('events-container');
    container.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
    
    try {
        const response = await fetch(`/api/events/${period}`);
        const events = await response.json();
        
        if (events.length === 0) {
            container.innerHTML = '<div class="empty-state">–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π</div>';
            return;
        }
        
        let html = '';
        events.forEach(event => {
            const time = new Date(event.start).toLocaleTimeString('ru-RU', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            html += `
                <div class="event-card">
                    <div class="event-time">${time}</div>
                    <div class="event-title">${event.title || '–°–æ–±—ã—Ç–∏–µ'}</div>
                    ${event.location ? `<div class="event-location">üìç ${event.location}</div>` : ''}
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        container.innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
        console.error('Error loading events:', error);
    }
}

function showCreateForm() {
    tg.showPopup({
        title: '–°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è',
        message: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ —á–∞—Ç–µ —Å –±–æ—Ç–æ–º –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π',
        buttons: [{ type: 'ok' }]
    });
}
</script>
{% endblock %}