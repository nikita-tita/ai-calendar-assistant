#!/bin/bash
# Test property search with various queries

source .env

BOT_TOKEN="${PROPERTY_BOT_TOKEN:-$TELEGRAM_BOT_TOKEN}"
TEST_USER_ID="2296243"

# Test queries
declare -a queries=(
    "ÐÐ°Ð¹Ð´Ð¸ ÐºÐ²Ð°Ñ€Ñ‚Ð¸Ñ€Ñƒ Ð´Ð¾ 10 Ð¼Ð»Ð½ Ñ€ÑƒÐ±Ð»ÐµÐ¹"
    "Ð˜Ñ‰Ñƒ ÐºÐ²Ð°Ñ€Ñ‚Ð¸Ñ€Ñƒ Ð·Ð° 15000000 Ñ€ÑƒÐ±Ð»ÐµÐ¹"
    "ÐšÐ²Ð°Ñ€Ñ‚Ð¸Ñ€Ð° Ð´Ð¾ 20 Ð¼Ð»Ð½"
    "ÐžÐ´Ð½ÑƒÑˆÐºÐ° Ð´Ð¾ 8 Ð¼Ð¸Ð»Ð»Ð¸Ð¾Ð½Ð¾Ð²"
    "Ð”Ð²ÑƒÑˆÐºÐ° Ð´Ð¾ 12000000"
    "Ð¢Ñ€ÐµÑ…ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ð½Ð°Ñ ÐºÐ²Ð°Ñ€Ñ‚Ð¸Ñ€Ð° Ð´Ð¾ 18 Ð¼Ð»Ð½"
    "Ð¡Ñ‚ÑƒÐ´Ð¸Ñ Ð´Ð¾ 6000000"
    "Ð§ÐµÑ‚Ñ‹Ñ€ÐµÑ…ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ð½Ð°Ñ Ð´Ð¾ 25 Ð¼Ð»Ð½"
    "2-ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ð½Ð°Ñ ÐºÐ²Ð°Ñ€Ñ‚Ð¸Ñ€Ð° 15 Ð¼Ð»Ð½"
    "3-Ñ… ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ð½Ð°Ñ 20 Ð¼Ð¸Ð»Ð»Ð¸Ð¾Ð½Ð¾Ð²"
    "ÐšÐ²Ð°Ñ€Ñ‚Ð¸Ñ€Ð° Ð² Ð’Ñ‹Ð±Ð¾Ñ€Ð³ÑÐºÐ¾Ð¼ Ñ€Ð°Ð¹Ð¾Ð½Ðµ Ð´Ð¾ 15 Ð¼Ð»Ð½"
    "Ð”Ð²ÑƒÑˆÐºÐ° Ð² ÐŸÑ€Ð¸Ð¼Ð¾Ñ€ÑÐºÐ¾Ð¼ Ð´Ð¾ 18000000"
    "ÐšÐ²Ð°Ñ€Ñ‚Ð¸Ñ€Ð° Ð² ÐšÐ°Ð»Ð¸Ð½Ð¸Ð½ÑÐºÐ¾Ð¼ Ñ€Ð°Ð¹Ð¾Ð½Ðµ 12 Ð¼Ð»Ð½"
    "Ð¢Ñ€ÐµÑˆÐºÐ° Ð½Ð° ÑÐµÐ²ÐµÑ€Ðµ Ð³Ð¾Ñ€Ð¾Ð´Ð° Ð´Ð¾ 20 Ð¼Ð»Ð½"
    "ÐžÐ´Ð½ÑƒÑˆÐºÐ° Ð² Ñ†ÐµÐ½Ñ‚Ñ€Ðµ Ð´Ð¾ 10 Ð¼Ð¸Ð»Ð»Ð¸Ð¾Ð½Ð¾Ð²"
    "ÐšÐ²Ð°Ñ€Ñ‚Ð¸Ñ€Ð° Ñƒ Ð¼ÐµÑ‚Ñ€Ð¾ ÐžÐ·ÐµÑ€ÐºÐ¸ Ð´Ð¾ 15 Ð¼Ð»Ð½"
    "Ð”Ð²ÑƒÑˆÐºÐ° Ñ€ÑÐ´Ð¾Ð¼ Ñ Ð¼ÐµÑ‚Ñ€Ð¾ ÐŸÑ€Ð¾ÑÐ¿ÐµÐºÑ‚ ÐŸÑ€Ð¾ÑÐ²ÐµÑ‰ÐµÐ½Ð¸Ñ 18 Ð¼Ð»Ð½"
    "ÐšÐ²Ð°Ñ€Ñ‚Ð¸Ñ€Ð° Ð² 10 Ð¼Ð¸Ð½ÑƒÑ‚Ð°Ñ… Ð¾Ñ‚ Ð¼ÐµÑ‚Ñ€Ð¾ Ð´Ð¾ 12000000"
    "Ð¢Ñ€ÐµÑˆÐºÐ° Ð² 20 Ð¼Ð¸Ð½ÑƒÑ‚Ð°Ñ… Ð¾Ñ‚ Ñ†ÐµÐ½Ñ‚Ñ€Ð° Ð´Ð¾ 25 Ð¼Ð»Ð½"
    "ÐšÐ²Ð°Ñ€Ñ‚Ð¸Ñ€Ð° Ð¿Ð¾Ð´ Ð¸Ð¿Ð¾Ñ‚ÐµÐºÑƒ Ð¡Ð±ÐµÑ€Ð±Ð°Ð½ÐºÐ° Ð´Ð¾ 15 Ð¼Ð»Ð½"
    "Ð”Ð²ÑƒÑˆÐºÐ° Ñ Ð¸Ð¿Ð¾Ñ‚ÐµÐºÐ¾Ð¹ Ð´Ð¾ 18000000"
    "Ð¢Ñ€ÐµÑ…ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ð½Ð°Ñ Ð¿Ð¾Ð´ Ð¸Ð¿Ð¾Ñ‚ÐµÐºÑƒ Ð’Ð¢Ð‘ 20 Ð¼Ð»Ð½"
    "ÐšÐ²Ð°Ñ€Ñ‚Ð¸Ñ€Ð° Ð¿Ð¾Ð´Ñ…Ð¾Ð´ÑÑ‰Ð°Ñ Ð¿Ð¾Ð´ Ð²Ð¾ÐµÐ½Ð½ÑƒÑŽ Ð¸Ð¿Ð¾Ñ‚ÐµÐºÑƒ 10 Ð¼Ð»Ð½"
    "ÐÐ°Ð¹Ð´Ð¸ Ð¼Ð½Ðµ ÐºÐ²Ð°Ñ€Ñ‚Ð¸Ñ€Ñƒ Ð·Ð° 18000000 Ð´Ð²ÑƒÑ…ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ð½ÑƒÑŽ Ð½Ð° ÑÐµÐ²ÐµÑ€Ðµ Ð³Ð¾Ñ€Ð¾Ð´Ð° Ð² 20 Ð¼Ð¸Ð½ÑƒÑ‚Ð°Ñ… Ð¾Ñ‚ Ñ†ÐµÐ½Ñ‚Ñ€Ð° ÐŸÐ¾Ð´Ñ…Ð¾Ð´ÑÑ‰ÑƒÑŽ Ð¿Ð¾Ð´ Ð¸Ð¿Ð¾Ñ‚ÐµÐºÑƒ ÑÐ±ÐµÑ€Ð±Ð°Ð½ÐºÐ°"
    "Ð¢Ñ€ÐµÑ…ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ð½Ð°Ñ ÐºÐ²Ð°Ñ€Ñ‚Ð¸Ñ€Ð° Ð² Ð’Ñ‹Ð±Ð¾Ñ€Ð³ÑÐºÐ¾Ð¼ Ñ€Ð°Ð¹Ð¾Ð½Ðµ Ð´Ð¾ 20 Ð¼Ð»Ð½ Ñ Ð¸Ð¿Ð¾Ñ‚ÐµÐºÐ¾Ð¹"
    "Ð”Ð²ÑƒÑˆÐºÐ° Ñƒ Ð¼ÐµÑ‚Ñ€Ð¾ ÐžÐ·ÐµÑ€ÐºÐ¸ Ð´Ð¾ 16 Ð¼Ð¸Ð»Ð»Ð¸Ð¾Ð½Ð¾Ð² Ð¿Ð¾Ð´ Ð¸Ð¿Ð¾Ñ‚ÐµÐºÑƒ"
    "Ð¡Ñ‚ÑƒÐ´Ð¸Ñ Ð² Ð½Ð¾Ð²Ð¾ÑÑ‚Ñ€Ð¾Ð¹ÐºÐµ Ð´Ð¾ 7000000 Ð² ÐŸÑ€Ð¸Ð¼Ð¾Ñ€ÑÐºÐ¾Ð¼ Ñ€Ð°Ð¹Ð¾Ð½Ðµ"
    "Ð§ÐµÑ‚Ñ‹Ñ€ÐµÑ…ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ð½Ð°Ñ ÐºÐ²Ð°Ñ€Ñ‚Ð¸Ñ€Ð° Ð½Ð° ÑÐµÐ²ÐµÑ€Ðµ Ð³Ð¾Ñ€Ð¾Ð´Ð° Ð´Ð¾ 30 Ð¼Ð»Ð½ Ñ Ð¿Ð°Ñ€ÐºÐ¾Ð²ÐºÐ¾Ð¹"
    "Ð”Ð²ÑƒÑˆÐºÐ° Ð´Ð¾ 15 Ð¼Ð»Ð½ Ð² 15 Ð¼Ð¸Ð½ÑƒÑ‚Ð°Ñ… Ð¾Ñ‚ Ð¼ÐµÑ‚Ñ€Ð¾ Ñ Ð¸Ð¿Ð¾Ñ‚ÐµÐºÐ¾Ð¹ Ð¡Ð±ÐµÑ€Ð±Ð°Ð½ÐºÐ°"
    "Ð¢Ñ€ÐµÑ…ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ð½Ð°Ñ Ð´Ð¾ 22 Ð¼Ð¸Ð»Ð»Ð¸Ð¾Ð½Ð¾Ð² Ð² ÐšÐ°Ð»Ð¸Ð½Ð¸Ð½ÑÐºÐ¾Ð¼ Ñ€Ð°Ð¹Ð¾Ð½Ðµ Ð½Ð¾Ð²Ð¾ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°"
)

echo "ðŸš€ Starting property search tests..."
echo "ðŸ“Š Total test cases: ${#queries[@]}"
echo "ðŸ‘¤ Test user ID: $TEST_USER_ID"
echo ""

success=0
failed=0

for i in "${!queries[@]}"; do
    test_num=$((i + 1))
    query="${queries[$i]}"

    echo "================================================================================"
    echo "Test $test_num/${#queries[@]}"
    echo "Query: $query"
    echo "================================================================================"

    # Send message via Telegram API
    response=$(curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
        -H "Content-Type: application/json" \
        -d "{\"chat_id\": \"${TEST_USER_ID}\", \"text\": \"${query}\"}")

    # Check if successful
    if echo "$response" | grep -q '"ok":true'; then
        echo "âœ… Message sent successfully"
        ((success++))
    else
        echo "âŒ Failed to send message"
        echo "Response: $response"
        ((failed++))
    fi

    # Wait between messages
    if [ $test_num -lt ${#queries[@]} ]; then
        wait_time=12
        echo "â³ Waiting ${wait_time}s before next test..."
        sleep $wait_time
    fi
    echo ""
done

echo "================================================================================"
echo "ðŸ“Š Test Summary:"
echo "âœ… Successful: $success/${#queries[@]}"
echo "âŒ Failed: $failed/${#queries[@]}"
echo "================================================================================"
echo ""
echo "ðŸ’¡ Check bot logs on server:"
echo "   ssh root@91.229.8.221"
echo "   docker logs telegram-bot-polling 2>&1 | grep 'search_criteria\\|listings_found\\|search_execution_error'"
