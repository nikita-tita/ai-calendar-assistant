# ğŸ” ĞÑƒĞ´Ğ¸Ñ‚ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²: ĞšĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ vs ĞĞµĞ´Ğ²Ğ¸Ğ¶Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ

## Ğ”Ğ°Ñ‚Ğ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸: 2025-10-28

---

## Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TELEGRAM BOT (Entry Point)                â”‚
â”‚                  app/services/telegram_handler.py            â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ                 â”‚ â”‚
â”‚  â”‚  2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼: get_user_mode()           â”‚ â”‚
â”‚  â”‚  3. Ğ ĞĞ£Ğ¢Ğ˜ĞĞ“:                                            â”‚ â”‚
â”‚  â”‚     - BotMode.CALENDAR â†’ _handle_text() (calendar)      â”‚ â”‚
â”‚  â”‚     - BotMode.PROPERTY â†’ property_handler.handle()      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                               â”‚
          â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CALENDAR SERVICE   â”‚         â”‚  PROPERTY SERVICE   â”‚
â”‚   (ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸Ñ 1)   â”‚         â”‚   (ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸Ñ 2)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            ĞšĞĞ›Ğ•ĞĞ”ĞĞ Ğ¬                      ĞĞ•Ğ”Ğ’Ğ˜Ğ–Ğ˜ĞœĞĞ¡Ğ¢Ğ¬
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‚ Ğ‘ÑĞºĞµĞ½Ğ´ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹:
   calendar_radicale.py          property_service.py
   daily_reminders.py            property_scoring.py
   event_reminders.py            property_handler.py

ğŸ¤– AI Ğ°Ğ³ĞµĞ½Ñ‚Ñ‹:
   llm_agent_yandex.py           llm_agent_property.py

ğŸ’¾ Ğ¥Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ:
   Radicale CalDAV               SQLAlchemy DB
   (iCalendar Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚)            (PostgreSQL/SQLite)

ğŸ“Š ĞœĞ¾Ğ´ĞµĞ»Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:
   EventDTO                      PropertyClient
   CalendarEvent                 PropertyListing
   IntentType                    PropertySelection

ğŸ¯ ĞŸÑ€Ğ¾Ğ¼Ğ¿Ñ‚Ñ‹:
   "calendar assistant"          "property search agent"
   "create/update/delete         "extract search criteria"
    events"                       "must-have filters"

ğŸ”„ Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸:
   ĞĞ•Ğ¢ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹ Ğ¾Ñ‚           ĞĞ•Ğ¢ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹ Ğ¾Ñ‚
   Property                      Calendar
```

---

## âœ… ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° 1: AI ĞĞ³ĞµĞ½Ñ‚Ñ‹ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ñ‹

### ĞšĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ğ½Ñ‹Ğ¹ AI Ğ°Ğ³ĞµĞ½Ñ‚
**Ğ¤Ğ°Ğ¹Ğ»:** `app/services/llm_agent_yandex.py`

```python
class LLMAgentYandex:
    """
    LLM Agent for understanding natural language calendar commands.
    Uses Yandex GPT with function calling to extract structured
    event information from user queries.
    """

    base_system_prompt = """You are an intelligent calendar assistant.
    Your task is to understand user commands in natural language
    and convert them into structured calendar actions.

    Possible actions (intent):
    - create: create a single new event
    - update: modify an existing event
    - delete: delete an event
    - query: query information about events
    - find_free_slots: find free time
    ..."""
```

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** âœ… Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ¢ĞĞ›Ğ¬ĞšĞ Ñ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ğ½Ñ‹Ğ¼Ğ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸ÑĞ¼Ğ¸

### Property AI Ğ°Ğ³ĞµĞ½Ñ‚
**Ğ¤Ğ°Ğ¹Ğ»:** `app/services/property/llm_agent_property.py`

```python
class PropertyLLMAgent:
    """LLM Agent specifically for property search interactions."""

    system_prompt = """Ğ¢Ñ‹ - AI-Ğ°Ğ³ĞµĞ½Ñ‚ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ½ĞµĞ´Ğ²Ğ¸Ğ¶Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ (Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚Ñ€Ğ¾ĞµĞº).

    Ğ’ĞĞ–ĞĞ: Ğ¢Ñ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑˆÑŒ Ğ¢ĞĞ›Ğ¬ĞšĞ Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ¾Ğ¼ Ğ½ĞµĞ´Ğ²Ğ¸Ğ¶Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸.
    ĞĞ• Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¾ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ğµ, ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸ÑÑ…, Ğ²ÑÑ‚Ñ€ĞµÑ‡Ğ°Ñ… Ğ¸ Ñ‚.Ğ¿.

    Ğ˜Ğ· ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸Ğ·Ğ²Ğ»ĞµĞºĞ¸:
    1. Ğ‘ÑĞ´Ğ¶ĞµÑ‚ (budget_min, budget_max)
    2. ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ĞºĞ¾Ğ¼Ğ½Ğ°Ñ‚ (rooms_min, rooms_max)
    3. Ğ›Ğ¾ĞºĞ°Ñ†Ğ¸Ñ (districts[], metro_stations[])
    ..."""
```

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** âœ… Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ¢ĞĞ›Ğ¬ĞšĞ Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ¾Ğ¼ Ğ½ĞµĞ´Ğ²Ğ¸Ğ¶Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ + ÑĞ²Ğ½Ğ°Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²

---

## âœ… ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° 2: ĞĞµÑ‚ Ğ¿ĞµÑ€ĞµĞºÑ€Ñ‘ÑÑ‚Ğ½Ñ‹Ñ… Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ²

### Property â†’ Calendar: âŒ ĞĞ•Ğ¢
```bash
$ grep -r "from app.services.calendar" app/services/property/
NO CALENDAR IMPORTS IN PROPERTY

$ grep -r "llm_agent_yandex" app/services/property/
NO CALENDAR LLM IN PROPERTY
```

### Calendar â†’ Property: âŒ ĞĞ•Ğ¢
```bash
$ grep -r "from app.services.property" app/services/*.py | grep -v telegram_handler
NO PROPERTY IMPORTS IN CALENDAR
```

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** âœ… ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ²

---

## âœ… ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° 3: Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### ĞšĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ
**Ğ¢Ğ¸Ğ¿:** CalDAV (Radicale)
**Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚:** iCalendar (.ics)
**Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹:**
- ĞĞµÑ‚ SQL Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†
- Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ `/data/collections/`
- Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°: `{user_id}/{calendar_id}/events.ics`

**ĞœĞ¾Ğ´ĞµĞ»Ğ¸:**
```python
# app/schemas/events.py
class EventDTO:
    title: str
    start_time: datetime
    end_time: datetime
    description: Optional[str]
    attendees: List[str]
    location: Optional[str]
```

### ĞĞµĞ´Ğ²Ğ¸Ğ¶Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ
**Ğ¢Ğ¸Ğ¿:** SQLAlchemy (Ñ€ĞµĞ»ÑÑ†Ğ¸Ğ¾Ğ½Ğ½Ğ°Ñ Ğ‘Ğ”)
**Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚:** SQL Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹
**Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹:**
- `property_clients` - ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñ‹
- `property_listings` - Ğ¾Ğ±ÑŠĞµĞºÑ‚Ñ‹
- `property_selections` - Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€ĞºĞ¸
- `selection_items` - ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€Ğ¾Ğº
- `selection_feedback` - Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ñ‹
- `user_bot_modes` - Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼ Ğ±Ğ¾Ñ‚Ğ°

**ĞœĞ¾Ğ´ĞµĞ»Ğ¸:**
```python
# app/models/property.py
class PropertyClient(Base):
    __tablename__ = "property_clients"
    id: Column(String, primary_key=True)
    telegram_user_id: Column(String, nullable=False)
    budget_min: Column(Integer)
    rooms_min: Column(Integer)
    districts: Column(JSON)
    taste_weights: Column(JSON)
    ...
```

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** âœ… ĞŸĞ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ

---

## âœ… ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° 4: Ğ•Ğ´Ğ¸Ğ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ñ‚Ğ¾Ñ‡ĞºĞ° ÑĞ²ÑĞ·Ğ¸ - Router Ğ² telegram_handler.py

### ĞšĞ¾Ğ´ Ñ€Ğ¾ÑƒÑ‚Ğ¸Ğ½Ğ³Ğ°

```python
# app/services/telegram_handler.py (ÑÑ‚Ñ€Ğ¾ĞºĞ¸ 179-194)

async def handle_update(self, update: Update, user_id: str):
    """Route message to appropriate service based on bot mode."""

    message = update.message

    # Check if user wants to switch to property mode
    if message.text in ["ğŸ  ĞŸĞ¾Ğ¸ÑĞº Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸", "ĞŸĞ¾Ğ¸ÑĞº Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸"]:
        await property_handler.handle_mode_switch(update, user_id, BotMode.PROPERTY)
        return

    # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    # â”‚  Ğ•Ğ”Ğ˜ĞĞ¡Ğ¢Ğ’Ğ•ĞĞĞĞ¯ Ğ¢ĞĞ§ĞšĞ Ğ¡Ğ’Ğ¯Ğ—Ğ˜                      â”‚
    # â”‚  ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼ Ğ¸ Ñ€Ğ¾ÑƒÑ‚Ğ¸Ğ¼ Ğ½Ğ° Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸Ñ       â”‚
    # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    current_mode = await property_service.get_user_mode(user_id)

    if current_mode == BotMode.PROPERTY:
        # ====> ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸Ñ ĞĞµĞ´Ğ²Ğ¸Ğ¶Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
        await property_handler.handle_property_message(update, user_id, message.text)
        return
    else:
        # ====> ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸Ñ ĞšĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ
        await self._handle_text(update, user_id, message.text)
        return
```

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** âœ… Ğ§Ğ¸ÑÑ‚Ñ‹Ğ¹ Ñ€Ğ¾ÑƒÑ‚Ğ¸Ğ½Ğ³ Ğ±ĞµĞ· ÑĞ¼ĞµÑˆĞ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸

---

## âœ… ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° 5: Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ API endpoints

### ĞšĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ API
**Router:** `app/routers/events.py`
**Prefix:** `/api/events`

**Endpoints:**
```
GET    /api/events                    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
POST   /api/events                    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ
PUT    /api/events/{user_id}/{id}     # ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ
DELETE /api/events/{user_id}/{id}     # Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ
GET    /api/events/free-slots         # ĞĞ°Ğ¹Ñ‚Ğ¸ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ğµ ÑĞ»Ğ¾Ñ‚Ñ‹
```

### ĞĞµĞ´Ğ²Ğ¸Ğ¶Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ API
**Router:** `app/routers/property.py`
**Prefix:** `/api/property`

**Endpoints:**
```
POST   /api/property/clients          # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°
GET    /api/property/clients/{id}     # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°
POST   /api/property/listings         # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ğ±ÑŠĞµĞºÑ‚
POST   /api/property/selections       # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€ĞºÑƒ
POST   /api/property/feedback         # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ·Ñ‹Ğ²
POST   /api/property/rank             # Ğ Ğ°Ğ½Ğ¶Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ñ‹
```

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** âœ… Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ URL Ğ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ÑÑ‚Ğ²Ğ°, Ğ½ĞµÑ‚ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ²

---

## âœ… ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° 6: ĞĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ñ‹Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ Telegram

### ĞšĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ğ½Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº
```python
# app/services/telegram_handler.py - TelegramHandler class

async def _handle_text(self, update, user_id, text):
    """Handle text messages in CALENDAR mode."""

    # 1. Call Calendar AI agent
    result = await llm_agent.process_request(
        user_message=text,
        user_id=user_id,
        existing_events=events
    )

    # 2. Execute calendar operations
    if result["intent"] == "create":
        event_id = await calendar_service.create_event(...)
    elif result["intent"] == "update":
        await calendar_service.update_event(...)
    elif result["intent"] == "delete":
        await calendar_service.delete_event(...)
```

### Property Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº
```python
# app/services/property/property_handler.py - PropertyHandler class

async def handle_property_message(self, update, user_id, text):
    """Handle text messages in PROPERTY mode."""

    # 1. Call Property AI agent
    criteria = await llm_agent_property.extract_search_criteria(
        user_message=text,
        user_id=user_id
    )

    # 2. Execute property operations
    listings = await property_service.search_listings(criteria)
    ranked = property_scoring_service.rank_listings(listings, client)
```

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** âœ… ĞĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ñ‹Ğµ ĞºĞ»Ğ°ÑÑÑ‹, Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹, Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ°Ğ³ĞµĞ½Ñ‚Ñ‹

---

## ğŸ“Š Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°

| ĞÑĞ¿ĞµĞºÑ‚ | ĞšĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ | ĞĞµĞ´Ğ²Ğ¸Ğ¶Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ | Ğ¡Ğ²ÑĞ·ÑŒ? |
|--------|-----------|--------------|--------|
| **AI ĞĞ³ĞµĞ½Ñ‚** | `llm_agent_yandex.py` | `llm_agent_property.py` | âŒ ĞĞ•Ğ¢ |
| **ĞŸÑ€Ğ¾Ğ¼Ğ¿Ñ‚** | "calendar assistant" | "property search agent" | âŒ ĞĞ•Ğ¢ |
| **Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…** | Radicale (CalDAV) | SQLAlchemy (SQL) | âŒ ĞĞ•Ğ¢ |
| **ĞœĞ¾Ğ´ĞµĞ»Ğ¸** | EventDTO, CalendarEvent | PropertyClient, PropertyListing | âŒ ĞĞ•Ğ¢ |
| **API Prefix** | `/api/events` | `/api/property` | âŒ ĞĞ•Ğ¢ |
| **Handler** | TelegramHandler._handle_text() | PropertyHandler.handle_property_message() | âŒ ĞĞ•Ğ¢ |
| **Ğ¡ĞµÑ€Ğ²Ğ¸ÑÑ‹** | calendar_radicale.py | property_service.py | âŒ ĞĞ•Ğ¢ |
| **Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñ‹** | ĞĞµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Property | ĞĞµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Calendar | âŒ ĞĞ•Ğ¢ |
| **Ğ¢Ğ¾Ñ‡ĞºĞ° ÑĞ²ÑĞ·Ğ¸** | âœ… Ğ¢ĞĞ›Ğ¬ĞšĞ telegram_handler Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ | âœ… Ğ¢ĞĞ›Ğ¬ĞšĞ telegram_handler Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ | âœ… Ğ”Ğ |

---

## ğŸ¯ Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞ¢Ğ•Ğ›Ğ¬                             â”‚
â”‚                   (Telegram Message)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              TELEGRAM_HANDLER (Router)                        â”‚
â”‚                                                               â”‚
â”‚  mode = get_user_mode(user_id)                               â”‚
â”‚                                                               â”‚
â”‚  if mode == CALENDAR:                                        â”‚
â”‚      self._handle_text() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  elif mode == PROPERTY:                          â”‚           â”‚
â”‚      property_handler.handle() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚        â”‚
                                          â”‚        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                               â”‚
                    â–¼                                               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  PROPERTY MICROSERVICEâ”‚                   â”‚  CALENDAR MICROSERVICEâ”‚
        â”‚                       â”‚                   â”‚                       â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚ Property LLM    â”‚ â”‚                   â”‚  â”‚ Calendar LLM    â”‚ â”‚
        â”‚  â”‚ Agent           â”‚ â”‚                   â”‚  â”‚ Agent           â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚           â”‚           â”‚                   â”‚           â”‚           â”‚
        â”‚           â–¼           â”‚                   â”‚           â–¼           â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚ property_       â”‚ â”‚                   â”‚  â”‚ calendar_       â”‚ â”‚
        â”‚  â”‚ service         â”‚ â”‚                   â”‚  â”‚ radicale        â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚           â”‚           â”‚                   â”‚           â”‚           â”‚
        â”‚           â–¼           â”‚                   â”‚           â–¼           â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚ SQL Database    â”‚ â”‚                   â”‚  â”‚ Radicale Server â”‚ â”‚
        â”‚  â”‚ (property_      â”‚ â”‚                   â”‚  â”‚ (CalDAV .ics)   â”‚ â”‚
        â”‚  â”‚  clients,       â”‚ â”‚                   â”‚  â”‚                 â”‚ â”‚
        â”‚  â”‚  listings)      â”‚ â”‚                   â”‚  â”‚                 â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ Ğ“Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ğ¸ Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ğ¸

### 1. ĞĞ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ ĞºĞ¾Ğ´Ğ°
- âœ… Property Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ ĞĞ• Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Calendar
- âœ… Calendar ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ ĞĞ• Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒÑÑ‚ Property
- âœ… Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ ĞºĞ»Ğ°ÑÑÑ‹ AI Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ²
- âœ… Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ñ‹

### 2. ĞĞ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- âœ… Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ (CalDAV vs SQL)
- âœ… Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (.ics vs JSON)
- âœ… Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ ÑÑ…ĞµĞ¼Ñ‹ (EventDTO vs PropertyClient)

### 3. ĞĞ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ API
- âœ… Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ URL Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑÑ‹ (/events vs /property)
- âœ… Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€Ñ‹ (events.py vs property.py)
- âœ… Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ ÑÑ…ĞµĞ¼Ñ‹ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸

### 4. ĞĞ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸
- âœ… Calendar: CRUD ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹, Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ, Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑÑÑ‰Ğ¸ĞµÑÑ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
- âœ… Property: Dream Score, Ñ€Ğ°Ğ½Ğ¶Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ, Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€ĞºĞ¸, Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ñ‹
- âœ… ĞĞµÑ‚ Ğ¾Ğ±Ñ‰Ğ¸Ñ… ĞºĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ğ¹

---

## âš ï¸ Ğ•Ğ´Ğ¸Ğ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ñ‚Ğ¾Ñ‡ĞºĞ° ÑĞ²ÑĞ·Ğ¸

**Ğ¤Ğ°Ğ¹Ğ»:** `app/services/telegram_handler.py`
**Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ¸:** 179-194

**Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ:**
```python
current_mode = await property_service.get_user_mode(user_id)

if current_mode == BotMode.PROPERTY:
    await property_handler.handle_property_message(...)
else:
    await self._handle_text(...)  # Calendar mode
```

**Ğ­Ñ‚Ğ¾ ĞĞ• Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°, ÑÑ‚Ğ¾ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°:**
- âœ… ĞĞ´Ğ¸Ğ½ entry point Ğ´Ğ»Ñ Ñ€Ğ¾ÑƒÑ‚Ğ¸Ğ½Ğ³Ğ°
- âœ… ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ² Ğ‘Ğ”
- âœ… ĞĞµÑ‚ ÑĞ¼ĞµÑˆĞ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸
- âœ… Ğ›ĞµĞ³ĞºĞ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ 3-Ğ¹, 4-Ğ¹ Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸Ñ

---

## ğŸš€ Ğ•ÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾ ÑĞ²ÑĞ·Ğ°Ñ‚ÑŒ ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚Ğ¸

ĞšĞ°Ğº Ğ²Ñ‹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ ÑĞºĞ°Ğ·Ğ°Ğ»Ğ¸: **"ĞµÑĞ»Ğ¸ Ğ½Ğ°Ğ´Ğ¾ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¸Ñ… ÑĞ²ÑĞ·Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑĞ¼, Ñ‚Ğ¾ ÑĞ´ĞµĞ»Ğ°ĞµĞ¼ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸Ñ"**

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         INTEGRATION MICROSERVICE (Ğ±ÑƒĞ´ÑƒÑ‰Ğ¸Ğ¹)              â”‚
â”‚                                                          â”‚
â”‚  ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¹:                                    â”‚
â”‚  â€¢ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ "ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ ĞºĞ²Ğ°Ñ€Ñ‚Ğ¸Ñ€Ñ‹" Ğ¸Ğ· Property     â”‚
â”‚  â€¢ Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ´Ğ°Ñ‚Ñ‹ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¾Ğ² Ñ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ‘Ğ¼       â”‚
â”‚  â€¢ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ Ğ¾ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ğµ Ñ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ¼           â”‚
â”‚                                                          â”‚
â”‚  Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°:                                             â”‚
â”‚  app/services/integration/                              â”‚
â”‚  â”œâ”€â”€ __init__.py                                        â”‚
â”‚  â”œâ”€â”€ property_calendar_sync.py                         â”‚
â”‚  â””â”€â”€ models.py                                          â”‚
â”‚                                                          â”‚
â”‚  ĞĞ• Ğ½Ğ°Ñ€ÑƒÑˆĞ°ĞµÑ‚ Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ:                                 â”‚
â”‚  âœ… Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ ĞĞ‘Ğ ÑĞµÑ€Ğ²Ğ¸ÑĞ°, Ğ½Ğ¾ Ğ¾Ğ½Ğ¸ Ğ½Ğµ Ğ·Ğ½Ğ°ÑÑ‚ Ğ´Ñ€ÑƒĞ³ Ğ¾ Ğ´Ñ€ÑƒĞ³Ğµâ”‚
â”‚  âœ… Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ API Ğ¾Ğ±Ğ¾Ğ¸Ñ… Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²       â”‚
â”‚  âœ… Ğ›ĞµĞ³ĞºĞ¾ Ğ²ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ/Ğ²Ñ‹ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… Ğ—Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ

### Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ: âœ… ĞŸĞĞ›ĞĞĞ¡Ğ¢Ğ¬Ğ® Ğ ĞĞ—Ğ”Ğ•Ğ›Ğ•ĞĞ

**AI ĞĞ³ĞµĞ½Ñ‚Ñ‹:**
- âœ… llm_agent_yandex.py - Ğ¢ĞĞ›Ğ¬ĞšĞ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ
- âœ… llm_agent_property.py - Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ½ĞµĞ´Ğ²Ğ¸Ğ¶Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ
- âœ… Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ñ‹, Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸

**Ğ‘ÑĞºĞµĞ½Ğ´:**
- âœ… calendar_radicale.py â†” property_service.py = ĞĞ•Ğ—ĞĞ’Ğ˜Ğ¡Ğ˜ĞœĞ«
- âœ… ĞĞµÑ‚ Ğ¿ĞµÑ€ĞµĞºÑ€Ñ‘ÑÑ‚Ğ½Ñ‹Ñ… Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ²
- âœ… Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

**Ğ¢Ğ¾Ñ‡ĞºĞ° ÑĞ²ÑĞ·Ğ¸:**
- âœ… Ğ¢ĞĞ›Ğ¬ĞšĞ telegram_handler.py Ñ€Ğ¾ÑƒÑ‚ĞµÑ€
- âœ… ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ° â†’ Ñ€Ğ¾ÑƒÑ‚Ğ¸Ğ½Ğ³
- âœ… ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ½Ğµ Ğ·Ğ½Ğ°ÑÑ‚ Ğ´Ñ€ÑƒĞ³ Ğ¾ Ğ´Ñ€ÑƒĞ³Ğµ

**ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°:**
```
Telegram Handler (Router)
    â”‚
    â”œâ”€â–º Calendar Microservice (Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ½ĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ñ‹Ğ¹)
    â”‚   â”œâ”€ AI Agent (Yandex GPT)
    â”‚   â”œâ”€ Backend (calendar_radicale)
    â”‚   â””â”€ Storage (Radicale CalDAV)
    â”‚
    â””â”€â–º Property Microservice (Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ½ĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ñ‹Ğ¹)
        â”œâ”€ AI Agent (Yandex GPT)
        â”œâ”€ Backend (property_service)
        â””â”€ Storage (SQLAlchemy DB)
```

**Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğº Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ñ:**
- âœ… Ğ›ĞµĞ³ĞºĞ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ 3-Ğ¹ Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸Ñ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, "Ğ¤Ğ¸Ğ½Ğ°Ğ½ÑÑ‹")
- âœ… Ğ›ĞµĞ³ĞºĞ¾ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Integration Service Ğ´Ğ»Ñ ÑĞ²ÑĞ·Ğ¸ ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚ĞµĞ¹
- âœ… ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

---

**Ğ”Ğ°Ñ‚Ğ° Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°:** 2025-10-28
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** âœ… ĞŸĞĞ›ĞĞĞ• Ğ ĞĞ—Ğ”Ğ•Ğ›Ğ•ĞĞ˜Ğ• ĞŸĞĞ”Ğ¢Ğ’Ğ•Ğ Ğ–Ğ”Ğ•ĞĞ
**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ:** ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸ÑĞ¼ Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
