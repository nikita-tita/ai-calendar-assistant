# Риски и блокеры проекта

**Последнее обновление:** 2026-01-10

---

## Активные блокеры

| ID | Блокер | Что блокирует | Владелец | Дедлайн | Статус |
|----|--------|---------------|----------|---------|--------|
| BLK-001 | Секреты в Git истории | Безопасность production | DevOps | 2026-01-10 | ✅ Закрыт |
| BLK-002 | Нет автоматических бэкапов | Защита данных | DevOps | 2026-01-10 | ✅ Закрыт |

### BLK-001: Секреты в Git истории

**Статус:** ✅ ЗАКРЫТ (2026-01-10)

**Описание:** Полные credentials были в Git истории. BFG Repo-Cleaner удалил их.

**Выполнено:**
- [x] BFG удалил 5 Telegram токенов из истории
- [x] BFG удалил 1 Yandex GPT API ключ из истории
- [x] Force push на GitHub выполнен
- [x] gitleaks + pre-commit настроены

**Отложено:**
- [ ] Ротация секретов (по решению владельца)

**Владелец:** DevOps
**Дата закрытия:** 2026-01-10

---

### BLK-002: Нет автоматических бэкапов

**Статус:** ✅ ЗАКРЫТ (2026-01-10)

**Описание:** backup-calendar.sh был добавлен в cron.

**Выполнено:**
- [x] Cron: `0 3 * * *` — ежедневно в 3:00
- [x] Бэкапятся: Radicale, SQLite, todos, encryption key, .env
- [x] Ротация: 30 дней
- [x] Проверено: бэкап от 2026-01-10 содержит все данные

**Отложено:**
- [ ] GPG encryption (Fernet уже шифрует todos)
- [ ] Cloud upload

**Владелец:** DevOps
**Дата закрытия:** 2026-01-10

---

## Риски

| ID | Риск | Вероятность | Влияние | Митигация | Владелец | Статус |
|----|------|-------------|---------|-----------|----------|--------|
| RSK-001 | Security breach через SQL Injection | — | — | SEC-002 ✅ | Backend | ✅ Закрыт |
| RSK-002 | XSS атака через event title | — | — | SEC-003 ✅ | Frontend | ✅ Закрыт |
| RSK-003 | Downtime без диагностики | Высокая | Высокое | INFRA-002 задача | DevOps | Открыт |
| RSK-004 | Regression при изменениях | Высокая | Среднее | TEST-001/002 задачи | QA | Открыт |
| RSK-005 | Memory exhaustion | Средняя | Среднее | PERF-001/002 задачи | Backend | Открыт |
| RSK-006 | Data corruption при concurrent access | — | — | BIZ-001 ✅ | Backend | ✅ Закрыт |
| RSK-007 | Double-booking при create/update событий | — | — | BIZ-004 ✅ | Backend | ✅ Закрыт |

---

### RSK-001: Security breach через SQL Injection

**Статус:** ✅ ЗАКРЫТ (2026-01-10)

**Описание:** analytics_service.py использовал f-strings для SQL запросов.

**Митигация выполнена:**
- [x] Проблема идентифицирована (SEC-002)
- [x] Все SQL параметризованы (2026-01-10)
- [x] Audit всех SQL в проекте — чисто
- [ ] Security test suite (отложено)

**Связанная задача:** SEC-002 ✅
**Владелец:** Backend
**Дата закрытия:** 2026-01-10

---

### RSK-002: XSS атака через event title

**Статус:** ✅ ЗАКРЫТ (2026-01-09)

**Описание:** Frontend использовал onclick с string interpolation.

**Митигация выполнена:**
- [x] Проблема идентифицирована (SEC-003)
- [x] safeId() функция добавлена для валидации ID
- [x] Security headers middleware добавлен
- [ ] OWASP ZAP scan (отложено)

**Связанная задача:** SEC-003 ✅
**Владелец:** Frontend
**Дата закрытия:** 2026-01-09

---

### RSK-003: Downtime без диагностики

**Описание:** Prometheus метрики определены, но не инструментированы. При инциденте невозможно понять причину.

**Вероятность:** Высокая (инциденты случаются)
**Влияние:** Высокое (MTTR увеличен)

**Митигация:**
- [x] Проблема идентифицирована (INFRA-002)
- [ ] Prometheus настроен
- [ ] Grafana dashboards созданы
- [ ] Alert rules настроены

**Связанная задача:** INFRA-002
**Владелец:** DevOps
**Целевая дата закрытия:** 2026-01-20

---

### RSK-004: Regression при изменениях

**Описание:** Тестовое покрытие 13%. Critical paths (API, auth) не покрыты. Изменения могут сломать production незаметно.

**Вероятность:** Высокая (каждое изменение — риск)
**Влияние:** Среднее (функционал может сломаться)

**Митигация:**
- [x] Проблема идентифицирована (TEST-001/002)
- [ ] API endpoints покрыты
- [ ] Security code покрыт
- [ ] CI enforces coverage

**Связанные задачи:** TEST-001, TEST-002, TEST-003
**Владелец:** QA
**Целевая дата закрытия:** 2026-01-25

---

### RSK-005: Memory exhaustion

**Описание:** webapp_cache не очищается, conversation_history растёт. При длительной работе память может закончиться.

**Вероятность:** Низкая (после PERF-001)
**Влияние:** Среднее (сервис падает)

**Митигация:**
- [x] Проблема идентифицирована (PERF-001/002)
- [x] webapp_cache cleanup включён (PERF-001 ✅)
- [ ] PERF-002: SQLite concurrent writes
- [ ] Memory profiling (отложено)
- [ ] Alerting на memory usage (отложено)

**Связанные задачи:** PERF-001 ✅, PERF-002
**Владелец:** Backend
**Целевая дата закрытия:** 2026-01-15

---

### RSK-006: Data corruption при concurrent access

**Статус:** ✅ ЗАКРЫТ (2026-01-09)

**Описание:** Calendar cache был не защищён lock'ом.

**Митигация выполнена:**
- [x] Проблема идентифицирована (BIZ-001)
- [x] threading.Lock() добавлен в calendar_radicale.py
- [ ] Concurrent tests (отложено)

**Связанная задача:** BIZ-001 ✅
**Владелец:** Backend
**Дата закрытия:** 2026-01-09

---

### RSK-007: Double-booking при create/update событий

**Статус:** ✅ ЗАКРЫТ (2026-01-10)

**Описание:** При создании или переносе события на занятое время не было проверки конфликтов.

**Митигация выполнена:**
- [x] Проблема идентифицирована (BIZ-004)
- [x] `_find_conflicts()` метод добавлен в RadicaleService
- [x] `_create_event_sync()` проверяет конфликты, логирует warning
- [x] `_update_event_sync()` проверяет конфликты с exclude_uid
- [x] Unit-тесты в `tests/unit/test_conflict_detection.py`

**Связанная задача:** BIZ-004 ✅
**Владелец:** Backend
**Дата закрытия:** 2026-01-10

---

## Закрытые риски/блокеры

| ID | Описание | Дата закрытия | Задача |
|----|----------|---------------|--------|
| BLK-001 | Секреты в Git истории | 2026-01-10 | SEC-001 |
| BLK-002 | Нет автоматических бэкапов | 2026-01-10 | INFRA-001 |
| RSK-001 | SQL Injection в analytics_service.py | 2026-01-10 | SEC-002 |
| RSK-002 | XSS через event title | 2026-01-09 | SEC-003 |
| RSK-006 | Race condition в calendar cache | 2026-01-09 | BIZ-001 |
| RSK-007 | Double-booking при create/update событий | 2026-01-10 | BIZ-004 |

---

## Escalation процедура

1. **Новый блокер:** Создать запись в этом файле, назначить владельца
2. **Блокер > 24 часов:** Escalate к техлиду
3. **Критический риск реализовался:** Incident response по RUNBOOKS.md

---

*Источник правды для рисков и блокеров*
