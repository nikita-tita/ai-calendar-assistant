# ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°: Ğ”Ğ²Ğ° Ğ½ĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ñ‹Ñ… Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ°

## Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ ÑÑ…ĞµĞ¼Ğ° Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ñ

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                            TELEGRAM BOT INFRASTRUCTURE                         â•‘
â•‘                                                                                â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘   â”‚                    telegram_handler.py (ROUTER)                      â”‚    â•‘
â•‘   â”‚                                                                       â”‚    â•‘
â•‘   â”‚   Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ: Ğ•Ğ´Ğ¸Ğ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ñ‚Ğ¾Ñ‡ĞºĞ° ÑĞ²ÑĞ·Ğ¸ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼Ğ¸            â”‚    â•‘
â•‘   â”‚                                                                       â”‚    â•‘
â•‘   â”‚   message = get_telegram_message()                                   â”‚    â•‘
â•‘   â”‚   mode = get_user_mode(user_id)  # From property DB                 â”‚    â•‘
â•‘   â”‚                                                                       â”‚    â•‘
â•‘   â”‚   if mode == "CALENDAR":                                             â”‚    â•‘
â•‘   â”‚       â†’ calendar_microservice.handle()                               â”‚    â•‘
â•‘   â”‚   elif mode == "PROPERTY":                                           â”‚    â•‘
â•‘   â”‚       â†’ property_microservice.handle()                               â”‚    â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                             â”‚                         â”‚                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              â”‚                         â”‚
                              â”‚                         â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                          â”‚     â”‚                            â”‚
          â–¼                          â”‚     â”‚                            â–¼

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚     â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   CALENDAR MICROSERVICE       â•‘   â”‚     â”‚   â•‘   PROPERTY MICROSERVICE        â•‘
â•‘   (ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸Ñ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ)     â•‘   â”‚     â”‚   â•‘   (ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸Ñ Ğ½ĞµĞ´Ğ²Ğ¸Ğ¶Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸)   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚     â”‚   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– AI AGENT                   â”‚   â”‚     â”‚   â”‚ ğŸ¤– AI AGENT                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚     â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ llm_agent_yandex.py           â”‚   â”‚     â”‚   â”‚ llm_agent_property.py          â”‚
â”‚                               â”‚   â”‚     â”‚   â”‚                                â”‚
â”‚ ĞŸÑ€Ğ¾Ğ¼Ğ¿Ñ‚:                       â”‚   â”‚     â”‚   â”‚ ĞŸÑ€Ğ¾Ğ¼Ğ¿Ñ‚:                        â”‚
â”‚ "You are a calendar           â”‚   â”‚     â”‚   â”‚ "Ğ¢Ñ‹ - Ğ°Ğ³ĞµĞ½Ñ‚ Ğ¿Ğ¾Ğ¸ÑĞºĞ°             â”‚
â”‚  assistant. Extract event     â”‚   â”‚     â”‚   â”‚  Ğ½ĞµĞ´Ğ²Ğ¸Ğ¶Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸. Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°Ğ¹        â”‚
â”‚  information..."              â”‚   â”‚     â”‚   â”‚  Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ¿Ğ¾Ğ¸ÑĞºĞ°..."          â”‚
â”‚                               â”‚   â”‚     â”‚   â”‚                                â”‚
â”‚ ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚:                 â”‚   â”‚     â”‚   â”‚ ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚:                  â”‚
â”‚ â€¢ create event                â”‚   â”‚     â”‚   â”‚ â€¢ budget_min/max               â”‚
â”‚ â€¢ update event                â”‚   â”‚     â”‚   â”‚ â€¢ rooms_min/max                â”‚
â”‚ â€¢ delete event                â”‚   â”‚     â”‚   â”‚ â€¢ districts[]                  â”‚
â”‚ â€¢ query events                â”‚   â”‚     â”‚   â”‚ â€¢ metro_stations[]             â”‚
â”‚ â€¢ find free slots             â”‚   â”‚     â”‚   â”‚ â€¢ floor_min/max                â”‚
â”‚                               â”‚   â”‚     â”‚   â”‚                                â”‚
â”‚ âŒ ĞĞ• Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¾ Property        â”‚   â”‚     â”‚   â”‚ âŒ ĞĞ• Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¾ Calendar         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                   â”‚     â”‚                    â”‚
                â–¼                   â”‚     â”‚                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¦ BACKEND SERVICES           â”‚   â”‚     â”‚   â”‚ ğŸ“¦ BACKEND SERVICES            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚     â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ calendar_radicale.py          â”‚   â”‚     â”‚   â”‚ property_service.py            â”‚
â”‚ â€¢ create_event()              â”‚   â”‚     â”‚   â”‚ â€¢ create_client()              â”‚
â”‚ â€¢ update_event()              â”‚   â”‚     â”‚   â”‚ â€¢ search_listings()            â”‚
â”‚ â€¢ delete_event()              â”‚   â”‚     â”‚   â”‚ â€¢ get_user_mode()              â”‚
â”‚ â€¢ get_events()                â”‚   â”‚     â”‚   â”‚ â€¢ set_user_mode()              â”‚
â”‚ â€¢ find_free_slots()           â”‚   â”‚     â”‚   â”‚                                â”‚
â”‚                               â”‚   â”‚     â”‚   â”‚ property_scoring.py            â”‚
â”‚ daily_reminders.py            â”‚   â”‚     â”‚   â”‚ â€¢ calculate_dream_score()      â”‚
â”‚ â€¢ check_daily_schedule()      â”‚   â”‚     â”‚   â”‚ â€¢ rank_listings()              â”‚
â”‚                               â”‚   â”‚     â”‚   â”‚ â€¢ explain_score()              â”‚
â”‚ event_reminders.py            â”‚   â”‚     â”‚   â”‚                                â”‚
â”‚ â€¢ check_upcoming_events()     â”‚   â”‚     â”‚   â”‚ property_handler.py            â”‚
â”‚                               â”‚   â”‚     â”‚   â”‚ â€¢ handle_mode_switch()         â”‚
â”‚ âŒ NO imports from Property   â”‚   â”‚     â”‚   â”‚ â€¢ handle_property_message()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”‚   â”‚ â€¢ _start_search_flow()         â”‚
                â”‚                   â”‚     â”‚   â”‚                                â”‚
                â–¼                   â”‚     â”‚   â”‚ âŒ NO imports from Calendar    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ ğŸ—„ï¸  STORAGE                  â”‚   â”‚     â”‚                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚     â”‚                    â–¼
â”‚ Radicale CalDAV Server        â”‚   â”‚     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               â”‚   â”‚     â”‚   â”‚ ğŸ—„ï¸  STORAGE                   â”‚
â”‚ Type: CalDAV                  â”‚   â”‚     â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Format: iCalendar (.ics)      â”‚   â”‚     â”‚   â”‚ SQLAlchemy Database            â”‚
â”‚ Port: 5232                    â”‚   â”‚     â”‚   â”‚                                â”‚
â”‚                               â”‚   â”‚     â”‚   â”‚ Type: SQL (PostgreSQL/SQLite)  â”‚
â”‚ Structure:                    â”‚   â”‚     â”‚   â”‚ Format: Relational tables      â”‚
â”‚ /data/collections/            â”‚   â”‚     â”‚   â”‚                                â”‚
â”‚   â”œâ”€ user_123/               â”‚   â”‚     â”‚   â”‚ Tables:                        â”‚
â”‚   â”‚   â””â”€ calendar_id/        â”‚   â”‚     â”‚   â”‚ â€¢ property_clients             â”‚
â”‚   â”‚       â””â”€ events.ics      â”‚   â”‚     â”‚   â”‚ â€¢ property_listings            â”‚
â”‚   â””â”€ user_456/               â”‚   â”‚     â”‚   â”‚ â€¢ property_selections          â”‚
â”‚       â””â”€ calendar_id/        â”‚   â”‚     â”‚   â”‚ â€¢ selection_items              â”‚
â”‚           â””â”€ events.ics      â”‚   â”‚     â”‚   â”‚ â€¢ selection_feedback           â”‚
â”‚                               â”‚   â”‚     â”‚   â”‚ â€¢ user_bot_modes â† Ñ€ĞµĞ¶Ğ¸Ğ¼ Ğ±Ğ¾Ñ‚Ğ°  â”‚
â”‚ âŒ No SQL tables              â”‚   â”‚     â”‚   â”‚                                â”‚
â”‚ âŒ No Property data           â”‚   â”‚     â”‚   â”‚ âŒ No .ics files               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”‚   â”‚ âŒ No Calendar data            â”‚
                                    â”‚     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ API ENDPOINTS              â”‚   â”‚     â”‚   â”‚ ğŸŒ API ENDPOINTS               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚     â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ app/routers/events.py         â”‚   â”‚     â”‚   â”‚ app/routers/property.py        â”‚
â”‚                               â”‚   â”‚     â”‚   â”‚                                â”‚
â”‚ GET    /api/events            â”‚   â”‚     â”‚   â”‚ POST   /api/property/clients   â”‚
â”‚ POST   /api/events            â”‚   â”‚     â”‚   â”‚ GET    /api/property/clients/  â”‚
â”‚ PUT    /api/events/:id        â”‚   â”‚     â”‚   â”‚ POST   /api/property/listings  â”‚
â”‚ DELETE /api/events/:id        â”‚   â”‚     â”‚   â”‚ POST   /api/property/          â”‚
â”‚ GET    /api/events/free-slots â”‚   â”‚     â”‚   â”‚        selections              â”‚
â”‚                               â”‚   â”‚     â”‚   â”‚ POST   /api/property/feedback  â”‚
â”‚ âŒ No /property endpoints     â”‚   â”‚     â”‚   â”‚ POST   /api/property/rank      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”‚   â”‚                                â”‚
                                    â”‚     â”‚   â”‚ âŒ No /events endpoints        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ ğŸ“Š DATA MODELS                â”‚   â”‚     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚     â”‚   â”‚ ğŸ“Š DATA MODELS                 â”‚
â”‚ app/schemas/events.py         â”‚   â”‚     â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                               â”‚   â”‚     â”‚   â”‚ app/models/property.py         â”‚
â”‚ class EventDTO:               â”‚   â”‚     â”‚   â”‚ app/schemas/property.py        â”‚
â”‚   title: str                  â”‚   â”‚     â”‚   â”‚                                â”‚
â”‚   start_time: datetime        â”‚   â”‚     â”‚   â”‚ class PropertyClient:          â”‚
â”‚   end_time: datetime          â”‚   â”‚     â”‚   â”‚   telegram_user_id: str        â”‚
â”‚   description: str            â”‚   â”‚     â”‚   â”‚   budget_min: int              â”‚
â”‚   location: str               â”‚   â”‚     â”‚   â”‚   budget_max: int              â”‚
â”‚   attendees: List[str]        â”‚   â”‚     â”‚   â”‚   rooms_min: int               â”‚
â”‚                               â”‚   â”‚     â”‚   â”‚   districts: JSON              â”‚
â”‚ class IntentType:             â”‚   â”‚     â”‚   â”‚   taste_weights: JSON          â”‚
â”‚   CREATE = "create"           â”‚   â”‚     â”‚   â”‚                                â”‚
â”‚   UPDATE = "update"           â”‚   â”‚     â”‚   â”‚ class PropertyListing:         â”‚
â”‚   DELETE = "delete"           â”‚   â”‚     â”‚   â”‚   address: str                 â”‚
â”‚   QUERY = "query"             â”‚   â”‚     â”‚   â”‚   price: int                   â”‚
â”‚                               â”‚   â”‚     â”‚   â”‚   rooms: int                   â”‚
â”‚ âŒ No Property models         â”‚   â”‚     â”‚   â”‚   area: float                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”‚   â”‚   district: str                â”‚
                                    â”‚     â”‚   â”‚   metro_distance: int          â”‚
                                    â”‚     â”‚   â”‚                                â”‚
                                    â”‚     â”‚   â”‚ âŒ No Event models             â”‚
                                    â”‚     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚     â”‚
    âŒ ĞĞ• Ğ¡Ğ’Ğ¯Ğ—ĞĞĞ« âŒ              â”‚     â”‚              âŒ ĞĞ• Ğ¡Ğ’Ğ¯Ğ—ĞĞĞ« âŒ


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        Ğ•Ğ”Ğ˜ĞĞ¡Ğ¢Ğ’Ğ•ĞĞĞĞ¯ Ğ¢ĞĞ§ĞšĞ Ğ¡Ğ’Ğ¯Ğ—Ğ˜
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                    telegram_handler.py (ÑÑ‚Ñ€Ğ¾ĞºĞ¸ 179-194)

                current_mode = property_service.get_user_mode(user_id)

                         â”‚
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                 â”‚
        â–¼                                 â–¼
   BotMode.CALENDAR                  BotMode.PROPERTY
        â”‚                                 â”‚
        â”‚                                 â”‚
        â””â”€â”€â–º self._handle_text()          â””â”€â”€â–º property_handler.handle()
                  â”‚                                    â”‚
                  â”‚                                    â”‚
                  â””â”€â–º llm_agent_yandex                â””â”€â–º llm_agent_property
                          â”‚                                    â”‚
                          â””â”€â–º calendar_radicale               â””â”€â–º property_service


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         Ğ‘Ğ£Ğ”Ğ£Ğ©ĞĞ¯ Ğ˜ĞĞ¢Ğ•Ğ“Ğ ĞĞ¦Ğ˜Ğ¯ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                    Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ ÑĞ²ÑĞ·Ğ°Ñ‚ÑŒ ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚Ğ¸:

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚            INTEGRATION MICROSERVICE (3-Ğ¹ Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸Ñ)           â”‚
    â”‚                                                                  â”‚
    â”‚  app/services/integration/                                      â”‚
    â”‚  â”œâ”€â”€ __init__.py                                                â”‚
    â”‚  â””â”€â”€ property_calendar_sync.py                                  â”‚
    â”‚                                                                  â”‚
    â”‚  ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹:                                                       â”‚
    â”‚  â€¢ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ "ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ ĞºĞ²Ğ°Ñ€Ñ‚Ğ¸Ñ€Ñ‹" Ğ² ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ğµ             â”‚
    â”‚  â€¢ Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ´Ğ°Ñ‚Ñ‹ Ğ²ÑÑ‚Ñ€ĞµÑ‡ Ñ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ¼                      â”‚
    â”‚  â€¢ ĞĞ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ Ğ¾ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ°Ñ…                                    â”‚
    â”‚                                                                  â”‚
    â”‚  Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚:                                                   â”‚
    â”‚  from app.services.calendar_radicale import calendar_service   â”‚
    â”‚  from app.services.property.property_service import ...        â”‚
    â”‚                                                                  â”‚
    â”‚  ĞĞ! Calendar Ğ¸ Property Ğ²ÑÑ‘ Ñ€Ğ°Ğ²Ğ½Ğ¾ ĞĞ• Ğ·Ğ½Ğ°ÑÑ‚ Ğ´Ñ€ÑƒĞ³ Ğ¾ Ğ´Ñ€ÑƒĞ³Ğµ       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹

| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Calendar? | Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Property? | ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ğµ |
|-----------|----------------------|----------------------|------------|
| **telegram_handler.py** | âœ… Ğ”Ğ | âœ… Ğ”Ğ | Ğ Ğ¾ÑƒÑ‚ĞµÑ€ (ÑÑ‚Ğ¾ OK) |
| **llm_agent_yandex.py** | - | âŒ ĞĞ•Ğ¢ | Ğ˜Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ |
| **llm_agent_property.py** | âŒ ĞĞ•Ğ¢ | - | Ğ˜Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ |
| **calendar_radicale.py** | - | âŒ ĞĞ•Ğ¢ | Ğ˜Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ |
| **property_service.py** | âŒ ĞĞ•Ğ¢ | - | Ğ˜Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ |
| **property_handler.py** | âŒ ĞĞ•Ğ¢ | âœ… Ğ”Ğ (Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ) | Ğ˜Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ |
| **events.py router** | âœ… Ğ”Ğ | âŒ ĞĞ•Ğ¢ | Ğ˜Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ |
| **property.py router** | âŒ ĞĞ•Ğ¢ | âœ… Ğ”Ğ | Ğ˜Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ |

---

## ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ²

### Calendar Ğ½Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Property âœ…
```bash
$ grep -r "property" app/services/calendar_radicale.py
$ grep -r "property" app/services/llm_agent_yandex.py
$ grep -r "property" app/services/daily_reminders.py
$ grep -r "property" app/services/event_reminders.py

â†’ Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: ĞŸĞ£Ğ¡Ğ¢Ğ (Ğ½ĞµÑ‚ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ²)
```

### Property Ğ½Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Calendar âœ…
```bash
$ grep -r "calendar" app/services/property/
$ grep -r "radicale" app/services/property/
$ grep -r "llm_agent_yandex" app/services/property/

â†’ Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: ĞŸĞ£Ğ¡Ğ¢Ğ (Ğ½ĞµÑ‚ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ²)
```

---

## Ğ ĞµĞ¶Ğ¸Ğ¼Ñ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ±Ğ¾Ñ‚Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER MODE STATE                            â”‚
â”‚                                                               â”‚
â”‚  Table: user_bot_modes                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ telegram_user_idâ”‚ current_mode                     â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚ 123456          â”‚ CALENDAR (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ)          â”‚     â”‚
â”‚  â”‚ 789012          â”‚ PROPERTY                         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                               â”‚
â”‚  ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ:                                               â”‚
â”‚  â€¢ ĞšĞ½Ğ¾Ğ¿ĞºĞ° "ğŸ  ĞŸĞ¾Ğ¸ÑĞº Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸" â†’ PROPERTY                 â”‚
â”‚  â€¢ ĞšĞ½Ğ¾Ğ¿ĞºĞ° "ğŸ“… ĞšĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ" â†’ CALENDAR                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User message â†’ telegram_handler
                    â†“
        mode = get_user_mode(user_id)
                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                       â–¼
   CALENDAR mode          PROPERTY mode
        â”‚                       â”‚
        â””â”€â–º Calendar Agent      â””â”€â–º Property Agent
```

---

## Ğ˜Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ Ğ½Ğ° Ğ²ÑĞµÑ… ÑƒÑ€Ğ¾Ğ²Ğ½ÑÑ…

### ğŸ§  Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 1: AI ĞŸÑ€Ğ¾Ğ¼Ğ¿Ñ‚Ñ‹
```
CALENDAR:                           PROPERTY:
"You are a calendar assistant"      "Ğ¢Ñ‹ Ğ°Ğ³ĞµĞ½Ñ‚ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ½ĞµĞ´Ğ²Ğ¸Ğ¶Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸"
"Extract event information"         "ĞĞ• Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¾ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ğµ"
"create/update/delete events"       "Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°Ğ¹ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ¿Ğ¾Ğ¸ÑĞºĞ°"
```

### ğŸ’» Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 2: ĞšĞ¾Ğ´
```
CALENDAR:                           PROPERTY:
llm_agent_yandex.py                llm_agent_property.py
calendar_radicale.py               property_service.py
                                   property_scoring.py
                                   property_handler.py

NO imports between them âœ…
```

### ğŸ—„ï¸ Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 3: Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ
```
CALENDAR:                           PROPERTY:
Radicale CalDAV                    SQLAlchemy
/data/collections/*.ics            Tables: property_clients,
                                          property_listings, etc.

Different storage systems âœ…
```

### ğŸŒ Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 4: API
```
CALENDAR:                           PROPERTY:
/api/events                        /api/property/clients
/api/events/:id                    /api/property/listings
/api/events/free-slots             /api/property/selections

Different URL namespaces âœ…
```

---

## Ğ’Ñ‹Ğ²Ğ¾Ğ´Ñ‹

âœ… **AI Ğ°Ğ³ĞµĞ½Ñ‚Ñ‹ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ñ‹**
- Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ñ‹
- Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸
- ĞĞµÑ‚ Ğ¿ĞµÑ€ĞµĞºÑ€Ñ‘ÑÑ‚Ğ½Ñ‹Ñ… ÑÑÑ‹Ğ»Ğ¾Ğº

âœ… **Ğ‘ÑĞºĞµĞ½Ğ´Ñ‹ Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹**
- ĞĞµÑ‚ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ² Ğ´Ñ€ÑƒĞ³ Ğ´Ñ€ÑƒĞ³Ğ°
- Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹
- ĞĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ñ‹Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸

âœ… **Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾**
- Calendar: CalDAV (.ics Ñ„Ğ°Ğ¹Ğ»Ñ‹)
- Property: SQL (Ñ€ĞµĞ»ÑÑ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹)
- ĞĞµÑ‚ Ğ¾Ğ±Ñ‰Ğ¸Ñ… Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†

âœ… **API endpoints Ğ½Ğµ Ğ¿ĞµÑ€ĞµÑĞµĞºĞ°ÑÑ‚ÑÑ**
- /api/events vs /api/property
- Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€Ñ‹
- Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ ÑÑ…ĞµĞ¼Ñ‹

âœ… **Ğ•Ğ´Ğ¸Ğ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ñ‚Ğ¾Ñ‡ĞºĞ° ÑĞ²ÑĞ·Ğ¸ - Router**
- telegram_handler.py Ñ€Ğ¾ÑƒÑ‚Ğ¸Ñ‚ Ğ¿Ğ¾ Ñ€ĞµĞ¶Ğ¸Ğ¼Ñƒ
- ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ½Ğµ Ğ·Ğ½Ğ°ÑÑ‚ Ğ´Ñ€ÑƒĞ³ Ğ¾ Ğ´Ñ€ÑƒĞ³Ğµ
- Ğ›ĞµĞ³ĞºĞ¾ Ñ€Ğ°ÑÑˆĞ¸Ñ€ÑÑ‚ÑŒ (Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ 3-Ğ¹, 4-Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ)

**ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸ÑĞ¼ Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²! ğŸ‰**
