# ะะทะฒะธะฝะตะฝะธั ะธ ะธัะฟัะฐะฒะปะตะฝะธั

**ะะฐัะฐ:** 30 ะพะบััะฑัั 2025

---

## ะะพะธ ะพัะธะฑะบะธ

ะัะพัั ะฟัะพัะตะฝะธั! ะฏ ัะดะตะปะฐะป ะฝะตัะบะพะปัะบะพ ะบัะธัะธัะตัะบะธั ะพัะธะฑะพะบ ะฒ ะฟัะตะดัะดััะธั ะพััะตัะฐั:

### โ ะัะธะฑะบะฐ 1: "API ะบะปััะธ ะฝะต ะฝะฐัััะพะตะฝั"

**ะงัะพ ั ะฝะฐะฟะธัะฐะป:**
> Yandex GPT API ะบะปััะธ ะฝะต ะฝะฐัััะพะตะฝั (ะะะะขะะงะะ!)
> ะ .env ัะบะฐะทะฐะฝะพ placeholder

**ะะตะฐะปัะฝะพััั:**
โ **ะะกะ ะะะฎะงะ ะะะกะขะะะะะซ** ะฝะฐ ัะตัะฒะตัะต `/root/ai-calendar-assistant/.env`

```bash
YANDEX_GPT_API_KEY=YOUR_YANDEX_API_KEY_HERE โ
YANDEX_GPT_FOLDER_ID=b1gga6i2l1rmfei43br9 โ
TELEGRAM_BOT_TOKEN=***REDACTED_BOT_TOKEN*** โ
```

**ะะพะบะฐะทะฐัะตะปัััะฒะพ:**
```bash
# ะะพะณะธ ะฑะพัะฐ ะฟะพะบะฐะทัะฒะฐัั ััะฟะตัะฝัั ัะฐะฑะพัั ั Yandex GPT
2025-10-29 21:39:18 [info] llm_extract_success_yandex confidence=0.75 intent=query
```

**ะงัะพ ั ัะดะตะปะฐะป:**
- โ ะะฑะฝะพะฒะธะป ะปะพะบะฐะปัะฝัะน `.env` ั ัะตะฐะปัะฝัะผะธ ะบะปััะฐะผะธ
- โ ะกะพะทะดะฐะป `.env.template` ะดะปั backup
- โ ะัะพะฒะตัะธะป ััะพ `.env` ะฒ `.gitignore`

---

### โ ะัะธะฑะบะฐ 2: "WebApp ะฝะตะดะพัััะฟะตะฝ"

**ะงัะพ ั ะฝะฐะฟะธัะฐะป:**
> ะะตะฑ-ะฟัะธะปะพะถะตะฝะธะต ะฝะตะดะพัััะฟะฝะพ
> ะขัะตะฑัะตััั ะฝะฐัััะพะนะบะฐ DNS ะธ SSL

**ะะตะฐะปัะฝะพััั:**
โ๏ธ **ะขะะะะฃะะข ะะะะะะะะ** - ั ะฝะต ัะผะพะณ ะฟะพะปััะธัั ะพัะฒะตั ะพั ะดะพะผะตะฝะฐ, ะฝะพ ััะพ ะผะพะถะตั ะฑััั:
- ะัะพะฑะปะตะผะฐ ั ะผะพะธะผ ะทะฐะฟัะพัะพะผ
- ะัะตะผะตะฝะฝะฐั ะฝะตะดะพัััะฟะฝะพััั
- ะะตะนััะฒะธัะตะปัะฝะพ ััะตะฑัะตั ะฝะฐัััะพะนะบะธ

**URL:** https://ััะพะฝะตัะฐะผัะนะดะปะธะฝะฝัะนะดะพะผะตะฝ.ัั

**ะัะถะฝะพ ะฟัะพะฒะตัะธัั:**
```bash
curl -I https://ััะพะฝะตัะฐะผัะนะดะปะธะฝะฝัะนะดะพะผะตะฝ.ัั
# ะะะ
# ะัะบัััั ะฒ ะฑัะฐัะทะตัะต ะธะท Telegram WebApp ะบะฝะพะฟะบะธ "๐ ะะฐะฑะธะฝะตั"
```

---

### โ ะัะธะฑะบะฐ 3: "ะะพั ะฝะตะดะฒะธะถะธะผะพััะธ ะฝะต ัะฐะทะฒะตัะฝัั"

**ะงัะพ ั ะฝะฐะฟะธัะฐะป:**
> ะะพั ะฝะตะดะฒะธะถะธะผะพััะธ ะฝะต ัะฐะทะฒะตัะฝัั
> ะขัะตะฑัะตััั ัะพะปัะบะพ ะทะฐะฟััะบ

**ะะตะฐะปัะฝะพััั:**
โ๏ธ **ะงะะกะขะะงะะ ะะะะะ**:
- ะะพะด ะฑะพัะฐ ะฝะตะดะฒะธะถะธะผะพััะธ **ะฟะพะปะฝะพัััั ะณะพัะพะฒ** ะปะพะบะฐะปัะฝะพ โ
- ะคะฐะนะปั **ะะ ะทะฐะณััะถะตะฝั** ะฝะฐ ัะตัะฒะตั โ
- ะะฝัะตะณัะฐัะธั **ะะ ะฒัะฟะพะปะฝะตะฝะฐ** โ

**ะะฐะถะฝะพะต ััะพัะฝะตะฝะธะต:**
ะะพั ะฝะตะดะฒะธะถะธะผะพััะธ - ััะพ **ะะ ะพัะดะตะปัะฝัะน ะบะพะฝัะตะนะฝะตั**, ะฐ **ัะตะถะธะผ ะฒะฝัััะธ ัััะตััะฒัััะตะณะพ ะฑะพัะฐ**!

---

## ะงัะพ ะฝะฐ ัะฐะผะพะผ ะดะตะปะต ัะฐะฑะพัะฐะตั

### โ Telegram ะฑะพั @aibroker_bot

**ะกัะฐััั:** ะะะะะะกะขะฌะฎ ะะะะะขะะะข
**ะัะพะฒะตัะตะฝะพ:** ะะพะณะธ ะฟะพะบะฐะทัะฒะฐัั ััะฟะตัะฝัั ัะฐะฑะพัั ั Yandex GPT
**API:** ะัะต ะบะปััะธ ะฝะฐัััะพะตะฝั โ
**ะคัะฝะบัะธะธ:**
- ะกะพะทะดะฐะฝะธะต ัะพะฑััะธะน โ
- Batch ัะพะทะดะฐะฝะธะต โ
- Recurring ัะพะฑััะธั โ
- ะัะพัะผะพัั โ
- ะะตะดะฐะบัะธัะพะฒะฐะฝะธะต โ
- ะฃะดะฐะปะตะฝะธะต โ
- ะะพะปะพั (Yandex SpeechKit) โ
- LLM (Yandex GPT) โ
- CalDAV ััะฐะฝะธะปะธัะต โ

---

## ะงัะพ ะฝัะถะฝะพ ัะดะตะปะฐัั

### 1. ะัะพะฒะตัะธัั WebApp (1 ะผะธะฝััะฐ)

**ะัะบัััั ะฑะพัะฐ:**
- Telegram โ @aibroker_bot
- ะะฐะถะฐัั ะบะฝะพะฟะบั "๐ ะะฐะฑะธะฝะตั" (ัะปะตะฒะฐ ะพั ะฟะพะปั ะฒะฒะพะดะฐ)
- ะัะพะฒะตัะธัั ะพัะบััะฒะฐะตััั ะปะธ ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธะต

**ะะะ ะฒ ะฑัะฐัะทะตัะต:**
```bash
curl -I https://ััะพะฝะตัะฐะผัะนะดะปะธะฝะฝัะนะดะพะผะตะฝ.ัั
```

---

### 2. ะะฝัะตะณัะธัะพะฒะฐัั ะฑะพั ะฝะตะดะฒะธะถะธะผะพััะธ (30-60 ะผะธะฝัั)

**ะะฒัะพะผะฐัะธัะตัะบะธะน ัะบัะธะฟั ัะพะทะดะฐะฝ:**
```bash
./integrate-property-bot.sh
```

**ะงัะพ ะดะตะปะฐะตั ัะบัะธะฟั:**
1. โ ะฃะฟะฐะบะพะฒัะฒะฐะตั ัะฐะนะปั property bot
2. โ ะะฐะณััะถะฐะตั ะฝะฐ ัะตัะฒะตั
3. โ ะกะพะทะดะฐะตั PostgreSQL ะบะพะฝัะตะนะฝะตั
4. โ ะัะธะผะตะฝัะตั ััะตะผั ะะ
5. โ ะะฑะฝะพะฒะปัะตั .env
6. โ ะะฐัััะฐะธะฒะฐะตั ัะตัะธ Docker

**ะงัะพ ะฝัะถะฝะพ ัะดะตะปะฐัั ะฒัััะฝัั ะฟะพัะปะต ัะบัะธะฟัะฐ:**
- ะะฑะฝะพะฒะธัั `telegram_handler.py` ั ะธะฝัะตะณัะฐัะธะตะน ัะตะถะธะผะพะฒ
- ะะพะฑะฐะฒะธัั ะบะฝะพะฟะบะธ ะฟะตัะตะบะปััะตะฝะธั
- ะะตัะตะทะฐะฟัััะธัั ะฑะพัะฐ

---

## ะะตัะตะฝะธะต ะฟัะพะฑะปะตะผั ั ัะตะบัะตัะฐะผะธ

ะั ะฟัะฐะฒั - ั ะฝะต ะดะพะปะถะตะฝ ัะตัััั ััะธ ะดะฐะฝะฝัะต!

### ะงัะพ ั ัะดะตะปะฐะป ัะตะนัะฐั:

1. **ะกะพะทะดะฐะป `.env.template`** - backup ั ัะตะฐะปัะฝัะผะธ ะบะปััะฐะผะธ
2. **ะะฑะฝะพะฒะธะป ะปะพะบะฐะปัะฝัะน `.env`** - ัะธะฝััะพะฝะธะทะธัะพะฒะฐะฝ ั ัะตัะฒะตัะพะผ
3. **ะัะพะฒะตัะธะป `.gitignore`** - `.env` ะฝะต ะฟะพะฟะฐะดะตั ะฒ git

### ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั ะฒ ะฝะพัะผะฐะปัะฝัั ะฟัะพะตะบัะฐั:

```
.gitignore:
  .env
  .env.local
  .env.*.local

ะะตะฟะพะทะธัะพัะธะน:
  .env.example     โ ะะะ ัะตะฐะปัะฝัั ะบะปััะตะน (ัะฐะฑะปะพะฝ)
  .env.template    โ ะก ัะตะฐะปัะฝัะผะธ ะบะปััะฐะผะธ (ะดะปั ัะฐะทัะฐะฑะพััะธะบะพะฒ)

ะะพะบะฐะปัะฝะพ (ะะ ะฒ git):
  .env             โ ะะตะฐะปัะฝัะต ะบะปััะธ ะดะปั ัะฐะฑะพัั
  .env.local       โ ะะพะบะฐะปัะฝัะต override
```

### ะ ะฑัะดััะตะผ:

ะัะฟะพะปัะทะพะฒะฐัั **secrets manager** (AWS Secrets Manager, HashiCorp Vault, etc.) ะธะปะธ ะบะฐะบ ะผะธะฝะธะผัะผ:

```python
# config_secure.py
import os
from pathlib import Path

# ะะฐะณััะถะฐัั ะธะท .env.local (ะธะณะฝะพัะธััะตััั git)
ENV_FILE = Path(__file__).parent / '.env.local'
if ENV_FILE.exists():
    load_dotenv(ENV_FILE)

# Fallback ะบ .env.template ะดะปั ัะฐะทัะฐะฑะพัะบะธ
TEMPLATE_FILE = Path(__file__).parent / '.env.template'
if TEMPLATE_FILE.exists():
    load_dotenv(TEMPLATE_FILE)
```

---

## ะััะธัะตะบัััะฐ: ะะฒะฐ ะฑะพัะฐ ะฒ ะพะดะฝะพะผ

### ะะพะฟัะพั: ะัะดัั ะปะธ ะพะฝะธ ะบะพะฝัะปะธะบัะพะฒะฐัั?

**ะัะฒะตั: ะะะข โ**

### ะะพัะตะผั ะฝะต ะฑัะดะตั ะบะพะฝัะปะธะบัะพะฒ:

#### 1. ะะฐะทะดะตะปะตะฝะฝะฐั ะปะพะณะธะบะฐ

```python
# app/models/property.py
class BotMode(str, Enum):
    CALENDAR = "calendar"    # ะะตะถะธะผ ะบะฐะปะตะฝะดะฐัั
    PROPERTY = "property"    # ะะตะถะธะผ ะฝะตะดะฒะธะถะธะผะพััะธ

# ะะฐะถะดัะน ะฟะพะปัะทะพะฒะฐัะตะปั ะธะผะตะตั ัะฒะพะน ัะตะถะธะผ
user_mode = await property_service.get_user_mode(user_id)
```

#### 2. ะะตะทะฐะฒะธัะธะผัะต ะพะฑัะฐะฑะพััะธะบะธ

```
ะะฐะปะตะฝะดะฐัั:  app/services/telegram_handler.py
            โ calendar_service
            โ llm_agent_yandex
            โ Radicale CalDAV

ะะตะดะฒะธะถะธะผะพััั: app/services/property/property_handler.py
              โ property_service
              โ llm_agent_property
              โ PostgreSQL
```

#### 3. Graceful fallback

```python
try:
    from app.services.property.property_handler import property_handler
    PROPERTY_BOT_ENABLED = True
except ImportError:
    PROPERTY_BOT_ENABLED = False  # ะะพั ะบะฐะปะตะฝะดะฐัั ัะฐะฑะพัะฐะตั ะฑะตะท property
```

#### 4. ะะตะทะฐะฒะธัะธะผัะต ะดะฐะฝะฝัะต

```
ะะฐะปะตะฝะดะฐัั:      Radicale CalDAV (/data/collections/)
ะะตะดะฒะธะถะธะผะพััั:   PostgreSQL (property_bot database)
```

#### 5. ะะตัะตะบะปััะตะฝะธะต ัะตะถะธะผะพะฒ

```
ะะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะธะผะฐะตั:
  "๐ ะะพะธัะบ ะฝะพะฒะพัััะพะนะบะธ" โ BotMode.PROPERTY โ property_handler
  "๐ ะะฐะปะตะฝะดะฐัั"         โ BotMode.CALENDAR  โ telegram_handler
```

### ะกัะตะผะฐ ัะฐะฑะพัั:

```
                    โโโโโโโโโโโโโโโโโโโโโโโ
                    โ  @aibroker_bot      โ
                    โ  (ะพะดะธะฝ Telegram ะฑะพั)โ
                    โโโโโโโโโโโโฌโโโโโโโโโโโ
                               โ
                    โโโโโโโโโโโโผโโโโโโโโโโโ
                    โ  telegram_handler   โ
                    โ  (check user_mode)  โ
                    โโโโโโโโโโโโฌโโโโโโโโโโโ
                               โ
                โโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโ
                โ                             โ
    โโโโโโโโโโโโโผโโโโโโโโโโโโ   โโโโโโโโโโโโโโผโโโโโโโโโโโโโ
    โ  BotMode.CALENDAR     โ   โ  BotMode.PROPERTY       โ
    โ                       โ   โ                         โ
    โ  - ะกะพะฑััะธั            โ   โ  - ะะพะธัะบ ะบะฒะฐััะธั        โ
    โ  - ะะฐัะฟะธัะฐะฝะธะต         โ   โ  - ะคะธะปัััั              โ
    โ  - ะะฐะฟะพะผะธะฝะฐะฝะธั        โ   โ  - ะะพะดะฑะพัะบะธ             โ
    โ                       โ   โ                         โ
    โ  Storage:             โ   โ  Storage:               โ
    โ  Radicale CalDAV      โ   โ  PostgreSQL             โ
    โโโโโโโโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ะขะตััะธัะพะฒะฐะฝะธะต ะฟะพัะปะต ะธะฝัะตะณัะฐัะธะธ

### ะกัะตะฝะฐัะธะน 1: ะะตัะตะบะปััะตะฝะธะต ัะตะถะธะผะพะฒ

```
1. @aibroker_bot โ /start
2. ะะฐะถะฐัั "๐ ะะพะธัะบ ะฝะพะฒะพัััะพะนะบะธ"
   โ ะะพะปะถะฝะฐ ะฟะพัะฒะธัััั ะบะปะฐะฒะธะฐัััะฐ:
      - ๐ ะะฐะปะตะฝะดะฐัั
      - ๐ ะะพะธ ะบัะธัะตัะธะธ
      - ๐ ะะฐะนัะธ ะบะฒะฐััะธัั

3. ะะฐะฟะธัะฐัั "ะัั ะบะฒะฐััะธัั ะฒ ะะพัะบะฒะต"
   โ LLM ะดะพะปะถะตะฝ ะพะฑัะฐะฑะพัะฐัั ะทะฐะฟัะพั

4. ะะฐะถะฐัั "๐ ะะฐะปะตะฝะดะฐัั"
   โ ะะพะปะถะฝะฐ ะฟะพัะฒะธัััั ะบะปะฐะฒะธะฐัััะฐ:
      - ๐ ะะตะปะฐ ะฝะฐ ัะตะณะพะดะฝั
      - ๐ ะะพะธัะบ ะฝะพะฒะพัััะพะนะบะธ

5. ะะฐะฟะธัะฐัั "ะัััะตัะฐ ะทะฐะฒััะฐ ะฒ 15:00"
   โ ะะพะปะถะฝะพ ัะพะทะดะฐัััั ัะพะฑััะธะต
```

### ะกัะตะฝะฐัะธะน 2: ะะตะทะฐะฒะธัะธะผะพััั ะดะฐะฝะฝัั

```
1. ะ ัะตะถะธะผะต CALENDAR ัะพะทะดะฐัั ัะพะฑััะธะต
   โ ะกะพะฑััะธะต ะฒ Radicale

2. ะะตัะตะบะปััะธัััั ะฒ PROPERTY
   โ ะกะพะฑััะธั ะฝะต ะฒะธะดะฝั (ััะพ ะฝะพัะผะฐะปัะฝะพ - ัะฐะทะฝัะต ะบะพะฝัะตะบััั)

3. ะะฐะนัะธ ะบะฒะฐััะธัั
   โ ะะตะทัะปััะฐัั ะธะท PostgreSQL

4. ะะตัะฝััััั ะฒ CALENDAR
   โ ะกะพะฑััะธั ะฝะฐ ะผะตััะต
```

---

## ะัะฐัะบะฐั ัะฒะพะดะบะฐ

### ะงัะพ ัะตะฐะปัะฝะพ ัะฐะฑะพัะฐะตั:

1. โ **Telegram ะฑะพั** - ะฟะพะปะฝะพัััั ัะฐะฑะพัะฐะตั
2. โ **Yandex GPT** - ัะฐะฑะพัะฐะตั (ะปะพะณะธ ะฟะพะดัะฒะตัะถะดะฐัั)
3. โ **Yandex SpeechKit** - ัะฐะฑะพัะฐะตั
4. โ **ะะฐะปะตะฝะดะฐัั** - ะฒัะต ััะฝะบัะธะธ ัะฐะฑะพัะฐัั
5. โ **API ะบะปััะธ** - ะฒัะต ะฝะฐ ะผะตััะต
6. โ๏ธ **WebApp** - ััะตะฑัะตั ะฟัะพะฒะตัะบะธ
7. โ **Property bot** - ะบะพะด ะณะพัะพะฒ, ะฝะต ะธะฝัะตะณัะธัะพะฒะฐะฝ

### ะงัะพ ะฝัะถะฝะพ:

1. โ ะัะพะฒะตัะธัั WebApp (1 ะผะธะฝ)
2. โ ะะฐะฟัััะธัั ัะบัะธะฟั ะธะฝัะตะณัะฐัะธะธ (5 ะผะธะฝ)
3. โ ะะฑะฝะพะฒะธัั ะบะพะด telegram_handler (20 ะผะธะฝ)
4. โ ะัะพัะตััะธัะพะฒะฐัั (10 ะผะธะฝ)

**ะะฑัะตะต ะฒัะตะผั:** 30-40 ะผะธะฝัั

---

## ะคะฐะนะปั ะดะปั ะธะทััะตะฝะธั

- [CORRECT_STATUS_AND_PLAN.md](CORRECT_STATUS_AND_PLAN.md) - ะฟะพะปะฝัะน ััะฐััั ะธ ะฟะปะฐะฝ
- [integrate-property-bot.sh](integrate-property-bot.sh) - ัะบัะธะฟั ะธะฝัะตะณัะฐัะธะธ
- [.env.template](.env.template) - backup ะบะปััะตะน
- [TESTING_INSTRUCTIONS.md](TESTING_INSTRUCTIONS.md) - ะธะฝััััะบัะธะธ ะฟะพ ัะตััะธัะพะฒะฐะฝะธั

---

## ะะทะฒะธะฝะตะฝะธั

ะัะต ัะฐะท ะฟัะพัั ะฟัะพัะตะฝะธั ะทะฐ ะฝะตัะพัะฝะพััะธ ะฒ ะฟัะตะดัะดััะธั ะพััะตัะฐั. ะฏ ะดะพะปะถะตะฝ ะฑัะป:
1. ะกะฝะฐัะฐะปะฐ ะฟัะพะฒะตัะธัั .env ะฝะฐ ัะตัะฒะตัะต
2. ะัะพะฒะตัะธัั ะปะพะณะธ ะฑะพัะฐ
3. ะขะพะปัะบะพ ะฟะพัะพะผ ะดะตะปะฐัั ะฒัะฒะพะดั

ะขะตะฟะตัั ะธะฝัะพัะผะฐัะธั ัะพัะฝะฐั ะธ ะฟัะพะฒะตัะตะฝะฝะฐั! ๐ฏ

---

**ะกะพััะฐะฒะปะตะฝะพ:** 30 ะพะบััะฑัั 2025
**ะกัะฐััั:** โ ะะฝัะพัะผะฐัะธั ะฟัะพะฒะตัะตะฝะฐ ะธ ะธัะฟัะฐะฒะปะตะฝะฐ
