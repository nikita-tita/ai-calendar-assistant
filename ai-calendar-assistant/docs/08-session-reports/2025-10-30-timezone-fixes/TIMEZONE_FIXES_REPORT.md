# –û—Ç—á—ë—Ç –æ —Ñ–∏–∫—Å–∞—Ö timezone –∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç
**–î–∞—Ç–∞:** 30 –æ–∫—Ç—è–±—Ä—è 2025
**–¢–∏–ø —Ä–∞–±–æ—Ç—ã:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏ –∏ —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è timezone

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏

**–°–∏–º–ø—Ç–æ–º:**
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —á–µ—Ç–≤–µ—Ä–≥ 30.10 —Å–∫–∞–∑–∞–ª "–ó–∞–ø–ª–∞–Ω–∏—Ä—É–π –≤—ã—Ö–æ–¥ –≤ –æ–∫–Ω–æ –≤ –ø—è—Ç–Ω–∏—Ü—É –≤ 20:00", –Ω–æ –±–æ—Ç —Å–æ–∑–¥–∞–ª —Å–æ–±—ã—Ç–∏–µ –Ω–∞ **7 –Ω–æ—è–±—Ä—è** (—Å–ª–µ–¥—É—é—â–∏–π —á–µ—Ç–≤–µ—Ä–≥) –≤–º–µ—Å—Ç–æ 31 –æ–∫—Ç—è–±—Ä—è (–∑–∞–≤—Ç—Ä–∞, –ø—è—Ç–Ω–∏—Ü–∞).

**–ü—Ä–∏—á–∏–Ω–∞:**
–í –ø—Ä–æ–º–ø—Ç–µ –¥–ª—è Yandex GPT –±—ã–ª–∏ –ø—Ä–∏–º–µ—Ä—ã —Ç–æ–ª—å–∫–æ –¥–ª—è:
- "–∑–∞–≤—Ç—Ä–∞"
- "–ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞"
- "—á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é"

–ù–û –Ω–µ –±—ã–ª–æ –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–ª—è **–¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏** ("–≤ –ø—è—Ç–Ω–∏—Ü—É", "–≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫" –∏ —Ç.–¥.). LLM –ø—ã—Ç–∞–ª—Å—è —Å–∞–º –≤—ã—á–∏—Å–ª–∏—Ç—å —ç—Ç–∏ –¥–∞—Ç—ã –∏ –æ—à–∏–±–∞–ª—Å—è.

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –≤—Å–µ—Ö –±–ª–∏–∂–∞–π—à–∏—Ö –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏ —Å —è–≤–Ω—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏ –≤ –ø—Ä–æ–º–ø—Ç:

```python
# –í—ã—á–∏—Å–ª—è–µ–º –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è –Ω–µ–¥–µ–ª–∏
- "–≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫" = 03.11.2025 (2025-11-03)
- "–≤–æ –≤—Ç–æ—Ä–Ω–∏–∫" = 04.11.2025 (2025-11-04)
- "–≤ —Å—Ä–µ–¥—É" = 05.11.2025 (2025-11-05)
- "–≤ —á–µ—Ç–≤–µ—Ä–≥" = 06.11.2025 (2025-11-06)
- "–≤ –ø—è—Ç–Ω–∏—Ü—É" = 31.10.2025 (2025-10-31)  ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
- "–≤ —Å—É–±–±–æ—Ç—É" = 01.11.2025 (2025-11-01)
- "–≤ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ" = 02.11.2025 (2025-11-02)
```

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–π —Ñ–∞–π–ª:** [app/services/llm_agent_yandex.py](../../../app/services/llm_agent_yandex.py#L464-L486)

---

### 2. ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã

**–°–∏–º–ø—Ç–æ–º:**
–ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–ª —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã 09:00-10:00 –∏ 13:00-14:00, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–≤–æ—Ä–∏–ª —á—Ç–æ —ç—Ç–∏ —Å–ª–æ—Ç—ã **–∑–∞–Ω—è—Ç—ã**.

**–ü—Ä–∏—á–∏–Ω–∞:**
–°–æ–±—ã—Ç–∏—è –∏–∑ Radicale —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **UTC timezone**, –∞ –ø–æ–∏—Å–∫ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–ª –≤ **MSK timezone**. –ü—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–ª—É—á–∞–ª–∞—Å—å –ø—É—Ç–∞–Ω–∏—Ü–∞:

```
–°–æ–±—ã—Ç–∏–µ "–ü—Ä–æ–≥—É–ª–∫–∞": 06:00 UTC = 09:00 MSK
–ë–æ—Ç —Å—á–∏—Ç–∞–ª: 09:00 MSK > 06:00 UTC ‚Üí —Å–≤–æ–±–æ–¥–Ω–æ
–ù–û –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ: 09:00 MSK == 09:00 MSK ‚Üí –ó–ê–ù–Ø–¢–û ‚ùå
```

**–ü—Ä–∏–º–µ—Ä –∏–∑ –ª–æ–≥–æ–≤:**
```
–°–æ–±—ã—Ç–∏—è –≤ UTC:
06:00 UTC = 09:00 MSK  –ü—Ä–æ–≥—É–ª–∫–∞
07:00 UTC = 10:00 MSK  –ó–∞–≤—Ç—Ä–∞–∫ —Å –õ–∏–∑–æ–π
10:00 UTC = 13:00 MSK  –î–æ—Ä–æ–≥–∞ –≤ –æ—Ñ–∏—Å
11:00 UTC = 14:00 MSK  –í—Å—Ç—Ä–µ—á–∞ —Å –ê–Ω–¥—Ä–µ–µ–º

–ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–ª "—Å–≤–æ–±–æ–¥–Ω–æ":
‚Ä¢ 09:00-10:00 ‚ùå (–Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –ü—Ä–æ–≥—É–ª–∫–∞)
‚Ä¢ 13:00-14:00 ‚ùå (–Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –î–æ—Ä–æ–≥–∞ –≤ –æ—Ñ–∏—Å)
```

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏—è –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –∏–∑ UTC –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π timezone (Europe/Moscow) —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑ Radicale:

```python
# Convert UTC to user's timezone (Moscow by default)
user_tz = pytz.timezone(settings.default_timezone)
start_local = start.astimezone(user_tz)
end_local = end.astimezone(user_tz)
```

–¢–µ–ø–µ—Ä—å –≤—Å–µ –≤—Ä–µ–º–µ–Ω–∞ –≤ –æ–¥–Ω–æ–º timezone –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è.

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- [app/services/calendar_radicale.py](../../../app/services/calendar_radicale.py#L240-L258) - –∫–æ–Ω–≤–µ—Ä—Å–∏—è timezone
- [app/services/calendar_radicale.py](../../../app/services/calendar_radicale.py#L288-L368) - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

### 3. ‚úÖ –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è timezone –ø–æ –≤—Å–µ–º—É –ø—Ä–æ–µ–∫—Ç—É

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü–æ –ø—Ä–æ–µ–∫—Ç—É –±—ã–ª–∏ —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã —Ö–∞—Ä–¥–∫–æ–¥—ã `'Europe/Moscow'` –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö, —á—Ç–æ –∑–∞—Ç—Ä—É–¥–Ω—è–ª–æ –±—É–¥—É—â—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö timezone.

**–†–µ—à–µ–Ω–∏–µ:**
–ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ —Ö–∞—Ä–¥–∫–æ–¥—ã –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É `settings.default_timezone`:

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
1. [app/services/calendar_radicale.py](../../../app/services/calendar_radicale.py)
   - `pytz.timezone('Europe/Moscow')` ‚Üí `pytz.timezone(settings.default_timezone)` (3 –º–µ—Å—Ç–∞)

2. [app/services/user_preferences.py](../../../app/services/user_preferences.py#L97-L108)
   - `return prefs.get("timezone", "Europe/Moscow")` ‚Üí `settings.default_timezone`

3. [app/services/llm_agent_yandex.py](../../../app/services/llm_agent_yandex.py#L1175-L1178)
   - `pytz.timezone('Europe/Moscow')` ‚Üí `pytz.timezone(settings.default_timezone)`

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ timezone

–¢–µ–ø–µ—Ä—å timezone —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ:

```
config.py
  ‚îî‚îÄ default_timezone = "Europe/Moscow"  ‚Üê –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã
       ‚îú‚îÄ user_preferences.get_timezone(user_id)
       ‚îÇ    ‚îî‚îÄ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π TZ –∏–ª–∏ default_timezone
       ‚îÇ
       ‚îú‚îÄ telegram_handler._get_user_timezone(update)
       ‚îÇ    ‚îî‚îÄ –≤—ã–∑—ã–≤–∞–µ—Ç user_preferences.get_timezone()
       ‚îÇ
       ‚îú‚îÄ llm_agent.extract_event(..., timezone=user_tz)
       ‚îÇ    ‚îî‚îÄ –ø–æ–ª—É—á–∞–µ—Ç timezone –æ—Ç telegram_handler
       ‚îÇ
       ‚îú‚îÄ calendar_radicale.list_events()
       ‚îÇ    ‚îî‚îÄ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç UTC ‚Üí settings.default_timezone
       ‚îÇ
       ‚îî‚îÄ calendar_radicale.find_free_slots()
            ‚îî‚îÄ –ª–æ–∫–∞–ª–∏–∑—É–µ—Ç naive datetime –≤ settings.default_timezone
```

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ —Ñ–∏–∫—Å–æ–≤:
‚ùå "–≤ –ø—è—Ç–Ω–∏—Ü—É" ‚Üí 7 –Ω–æ—è–±—Ä—è (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
‚ùå –°–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∑–∞–Ω—è—Ç–æ–µ –≤—Ä–µ–º—è
‚ö†Ô∏è –•–∞—Ä–¥–∫–æ–¥—ã timezone –ø–æ –≤—Å–µ–º—É –ø—Ä–æ–µ–∫—Ç—É

### –ü–æ—Å–ª–µ —Ñ–∏–∫—Å–æ–≤:
‚úÖ "–≤ –ø—è—Ç–Ω–∏—Ü—É" ‚Üí 31 –æ–∫—Ç—è–±—Ä—è (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
‚úÖ –°–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã (—É—á–∏—Ç—ã–≤–∞—é—Ç MSK timezone)
‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ timezone —á–µ—Ä–µ–∑ config
‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø–æ–¥–¥–µ—Ä–∂–∫–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö timezone

---

## –î–µ–ø–ª–æ–π

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã –Ω–∞ production —Å–µ—Ä–≤–µ—Ä:
```bash
scp app/services/llm_agent_yandex.py root@server:/root/ai-calendar-assistant/
scp app/services/calendar_radicale.py root@server:/root/ai-calendar-assistant/
scp app/services/user_preferences.py root@server:/root/ai-calendar-assistant/
docker restart telegram-bot-polling
```

–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–æ–≤—ã–º–∏ —Ñ–∏–∫—Å–∞–º–∏.

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
1. ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏ ("–≤ –ø—è—Ç–Ω–∏—Ü—É", "–≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫" –∏ —Ç.–¥.)
2. üîÑ –ü–æ–∏—Å–∫ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ –Ω–∞ –∑–∞–≤—Ç—Ä–∞
3. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ UI –¥–ª—è –≤—ã–±–æ—Ä–∞ timezone –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
3. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥—Ä—É–≥–∏—Ö timezone (–µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è)

---

**–ê–≤—Ç–æ—Ä:** Claude Code
**–§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ:** 3
**–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~150
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–¥–µ–ø–ª–æ–µ–Ω–æ –≤ production
