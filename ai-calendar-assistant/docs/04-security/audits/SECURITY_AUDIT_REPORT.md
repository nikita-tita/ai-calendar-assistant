# üîí –û—Ç—á–µ—Ç –ø–æ –∞—É–¥–∏—Ç—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ AI Calendar Assistant

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 28 –æ–∫—Ç—è–±—Ä—è 2025
**–ê—É–¥–∏—Ç–æ—Ä:** Claude (Anthropic)
**–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã:** Production –Ω–∞ —ç—Ç–æ–Ω–µ—Å–∞–º—ã–π–¥–ª–∏–Ω–Ω—ã–π–¥–æ–º–µ–Ω.—Ä—Ñ

---

## üìä –°–≤–æ–¥–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –°—Ç–∞—Ç—É—Å | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
|-----------|--------|-------------|
| –•—Ä–∞–Ω–µ–Ω–∏–µ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö | ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û | üî¥ –í—ã—Å–æ–∫–∞—è |
| –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö | ‚ö†Ô∏è –ù–£–ñ–ù–´ –£–õ–£–ß–®–ï–ù–ò–Ø | üü° –°—Ä–µ–¥–Ω—è—è |
| –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è | ‚úÖ –•–û–†–û–®–û | üü¢ –ù–∏–∑–∫–∞—è |
| –°–µ—Ç–µ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | ‚ö†Ô∏è –ù–£–ñ–ù–´ –£–õ–£–ß–®–ï–ù–ò–Ø | üü° –°—Ä–µ–¥–Ω—è—è |
| –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢ | üî¥ –í—ã—Å–æ–∫–∞—è |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚úÖ –•–û–†–û–®–û | üü¢ –ù–∏–∑–∫–∞—è |

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò

### 1. ‚ö†Ô∏è –ü–ê–†–û–õ–ò –í –û–¢–ö–†–´–¢–û–ú –í–ò–î–ï –í –ö–û–î–ï

**–§–∞–π–ª:** `app/routers/admin.py` —Å—Ç—Ä–æ–∫–∏ 22-31

```python
# ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê
PASSWORD_1 = "***REDACTED_ADMIN***"
PASSWORD_2 = "***REDACTED_ADMIN***"
PASSWORD_3 = "***REDACTED_ADMIN***"
```

**–†–∏—Å–∫–∏:**
- –ü–∞—Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ
- –î–æ—Å—Ç—É–ø–Ω—ã –≤ git –∏—Å—Ç–æ—Ä–∏–∏
- –í–∏–¥–Ω—ã –≤—Å–µ–º, –∫—Ç–æ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –±–µ–∑ —Ä–µ–¥–µ–ø–ª–æ—è
- –ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è = –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—É–∂–µ –µ—Å—Ç—å `admin_auth.py`, –Ω–æ `admin.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥)

---

### 2. ‚ö†Ô∏è –û–¢–°–£–¢–°–¢–í–ò–ï –†–ï–ó–ï–†–í–ù–û–ì–û –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Docker volume `radicale_data`
- JSON —Ñ–∞–π–ª—ã (preferences, analytics) –≤ `/var/lib/calendar-bot/` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏–ª–∏ —Å–±–æ–µ —Å–µ—Ä–≤–µ—Ä–∞ - –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è –ë–ï–ó–í–û–ó–í–†–ê–¢–ù–û

**–§–∞–π–ª—ã –±–µ–∑ backup:**
```
/var/lib/calendar-bot/user_preferences.json     # –Ø–∑—ã–∫–∏, —á–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
/var/lib/calendar-bot/analytics_data.json       # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
/var/lib/calendar-bot/daily_reminder_users.json # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
/var/lib/calendar-bot/event_reminder_users.json # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ —Å–æ–±—ã—Ç–∏—è—Ö
```

**–†–∏—Å–∫–∏:**
- –ü–æ—Ç–µ—Ä—è –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü–æ—Ç–µ—Ä—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Å–±–æ—è

---

## üü° –°–†–ï–î–ù–Ø–Ø –ö–†–ò–¢–ò–ß–ù–û–°–¢–¨

### 3. ‚ö†Ô∏è –°–ï–†–í–ò–°–´ –î–û–°–¢–£–ü–ù–´ –ü–£–ë–õ–ò–ß–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:** Radicale CalDAV —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ –Ω–∞ –ø–æ—Ä—Ç—É 5232

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
tcp  0.0.0.0:5232  0.0.0.0:*  LISTEN  (docker-proxy)
tcp  0.0.0.0:8000  0.0.0.0:*  LISTEN  (docker-proxy)
```

**–†–∏—Å–∫–∏:**
- Radicale –º–æ–∂–µ—Ç –±—ã—Ç—å –∞—Ç–∞–∫–æ–≤–∞–Ω –Ω–∞–ø—Ä—è–º—É—é
- –ë—Ä—É—Ç—Ñ–æ—Ä—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- DDoS –Ω–∞ CalDAV endpoint

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü–æ—Ä—Ç 8000 (FastAPI) –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–æ Radicale –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Docker —Å–µ—Ç–∏.

---

### 4. ‚ö†Ô∏è –û–¢–°–£–¢–°–¢–í–ò–ï –®–ò–§–†–û–í–ê–ù–ò–Ø –î–ê–ù–ù–´–• –í –ü–û–ö–û–ï

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ plaintext –≤ Radicale
- JSON —Ñ–∞–π–ª—ã –Ω–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) –Ω–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∞

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
```
/data/collections/collection-root/.../*.ics  # –ù–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ iCal —Ñ–∞–π–ª—ã
/var/lib/calendar-bot/*.json                 # –ù–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ JSON
```

**–†–∏—Å–∫–∏:**
- –ü—Ä–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º –¥–æ—Å—Ç—É–ø–µ –∫ —Å–µ—Ä–≤–µ—Ä—É –¥–∞–Ω–Ω—ã–µ —á–∏—Ç–∞—é—Ç—Å—è
- –ü—Ä–∏ —É—Ç–µ—á–∫–µ backup'–∞ - –¥–∞–Ω–Ω—ã–µ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ

---

### 5. ‚ö†Ô∏è SECRET_KEY –ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ

**–§–∞–π–ª:** `app/config.py:52`

```python
secret_key: Optional[str] = "default-secret-key-change-in-production"
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –≤ .env –Ω–µ –∑–∞–¥–∞–Ω SECRET_KEY, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π.

**–†–∏—Å–∫–∏:**
- –ü–æ–¥–ø–∏—Å–∏ —Å–µ—Å—Å–∏–π –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–¥–¥–µ–ª–∞–Ω—ã
- JWT —Ç–æ–∫–µ–Ω—ã –º–æ–≥—É—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω—ã –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–º

---

### 6. ‚ö†Ô∏è .ENV –§–ê–ô–õ–´ –í GIT (IGNORED, –ù–û –†–ò–°–ö –ï–°–¢–¨)

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
```
.env        # ignored ‚úÖ
.env.backup # ignored ‚úÖ
```

**–†–∏—Å–∫–∏:**
- –ï—Å–ª–∏ —Å–ª—É—á–∞–π–Ω–æ —Å–¥–µ–ª–∞—Ç—å `git add -f .env`
- –ò—Å—Ç–æ—Ä–∏—è git –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏
- –õ–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–ø–∏–∏ —É —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

---

## üü¢ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢ –•–û–†–û–®–û

### ‚úÖ 1. –¢—Ä–µ—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

–°–∏—Å—Ç–µ–º–∞ —Ç—Ä–µ–±—É–µ—Ç 3 –ø–∞—Ä–æ–ª—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω–∫–µ + fake mode –ø—Ä–∏ 2 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–∞—Ä–æ–ª—è—Ö.

### ‚úÖ 2. PII Masking –≤ –ª–æ–≥–∞—Ö

–§–∞–π–ª `app/utils/pii_masking.py` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –º–∞—Å–∫–∏—Ä—É–µ—Ç:
- User ID (—Ö–µ—à–∏—Ä—É–µ—Ç—Å—è)
- Email, —Ç–µ–ª–µ—Ñ–æ–Ω—ã
- –¢–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è —Å–æ–±—ã—Ç–∏–π
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### ‚úÖ 3. Rate Limiting

```python
max_requests_per_user_per_day: int = 20
max_concurrent_requests: int = 100
```

### ‚úÖ 4. CORS –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

```python
cors_origins: str = "https://yourdomain.ru,https://www.yourdomain.ru,https://webapp.telegram.org"
```

### ‚úÖ 5. Webhook Secret –¥–ª—è Telegram

```python
telegram_webhook_secret: Optional[str] = None  # ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
```

### ‚úÖ 6. HTTPS –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç Let's Encrypt –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

## üìã –ü–õ–ê–ù –£–õ–£–ß–®–ï–ù–ò–ô –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### üî¥ –ö–†–ò–¢–ò–ß–ù–û (–°–¥–µ–ª–∞—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)

#### 1. –£–±—Ä–∞—Ç—å –ø–∞—Ä–æ–ª–∏ –∏–∑ –∫–æ–¥–∞

**–§–∞–π–ª:** `app/routers/admin.py`

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –£–¥–∞–ª–∏—Ç—å —Ö–∞—Ä–¥–∫–æ–¥ –ø–∞—Ä–æ–ª–µ–π –∏–∑ `admin.py`
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º `admin_auth.py` –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ö–æ–¥ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

```python
# ‚ùå –£–î–ê–õ–ò–¢–¨:
PASSWORD_1 = "***REDACTED_ADMIN***"
PASSWORD_2 = "***REDACTED_ADMIN***"
PASSWORD_3 = "***REDACTED_ADMIN***"

# ‚úÖ –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨:
from app.services.admin_auth import admin_auth_service
```

#### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç backup:**

```bash
#!/bin/bash
# /root/backup-calendar.sh

BACKUP_DIR="/root/backups/calendar"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p $BACKUP_DIR

# Backup Radicale data
docker run --rm \
  --volumes-from radicale \
  -v $BACKUP_DIR:/backup \
  alpine tar czf /backup/radicale_$DATE.tar.gz /data

# Backup bot data
docker cp telegram-bot:/var/lib/calendar-bot $BACKUP_DIR/bot_data_$DATE/

# Keep only last 30 days
find $BACKUP_DIR -type f -mtime +30 -delete

# Encrypt and upload to cloud (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# gpg --encrypt --recipient your@email.com $BACKUP_DIR/radicale_$DATE.tar.gz
# rclone copy $BACKUP_DIR/radicale_$DATE.tar.gz.gpg remote:backups/
```

**Cron job:**
```cron
# Backup every day at 3 AM
0 3 * * * /root/backup-calendar.sh >> /var/log/calendar-backup.log 2>&1
```

#### 3. –ó–∞–∫—Ä—ã—Ç—å Radicale –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞

**–§–∞–π–ª:** `docker-compose.yml`

```yaml
# ‚ùå –£–î–ê–õ–ò–¢–¨ –ø—É–±–ª–∏—á–Ω—ã–π –ø–æ—Ä—Ç:
radicale:
  ports:
    - "5232:5232"  # ‚ùå –£–±—Ä–∞—Ç—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É

# ‚úÖ –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ internal network:
radicale:
  expose:
    - "5232"  # ‚úÖ –¢–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Docker —Å–µ—Ç–∏
  networks:
    - internal
```

**–î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ç—å:**
```yaml
networks:
  internal:
    internal: true  # –ó–∞–ø—Ä–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
```

---

### üü° –í–ê–ñ–ù–û (–°–¥–µ–ª–∞—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏)

#### 4. –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π SECRET_KEY

**–í .env –¥–æ–±–∞–≤–∏—Ç—å:**
```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å:
python3 -c "import secrets; print(secrets.token_urlsafe(32))"

# –î–æ–±–∞–≤–∏—Ç—å –≤ .env:
SECRET_KEY=<—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π_–∫–ª—é—á>
```

#### 5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

**–û–ø—Ü–∏–∏:**
- **–î–ª—è Radicale:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å encrypted filesystem (LUKS)
- **–î–ª—è JSON —Ñ–∞–π–ª–æ–≤:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `cryptography` –±–∏–±–ª–∏–æ—Ç–µ–∫—É

**–ü—Ä–∏–º–µ—Ä —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è JSON:**

```python
from cryptography.fernet import Fernet
import os
import json

class EncryptedStorage:
    def __init__(self):
        key_file = "/var/lib/calendar-bot/.encryption_key"
        if os.path.exists(key_file):
            with open(key_file, 'rb') as f:
                self.key = f.read()
        else:
            self.key = Fernet.generate_key()
            with open(key_file, 'wb') as f:
                f.write(self.key)
            os.chmod(key_file, 0o600)

        self.cipher = Fernet(self.key)

    def save_encrypted(self, data: dict, path: str):
        json_data = json.dumps(data).encode()
        encrypted = self.cipher.encrypt(json_data)
        with open(path, 'wb') as f:
            f.write(encrypted)

    def load_encrypted(self, path: str) -> dict:
        with open(path, 'rb') as f:
            encrypted = f.read()
        decrypted = self.cipher.decrypt(encrypted)
        return json.loads(decrypted.decode())
```

#### 6. –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤

```bash
# /etc/logrotate.d/calendar-assistant
/var/log/calendar-assistant/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0640 root root
}
```

#### 7. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å fail2ban –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞:**

```bash
apt install fail2ban

# /etc/fail2ban/jail.local
[nginx-auth]
enabled = true
filter = nginx-auth
logpath = /var/log/nginx/error.log
maxretry = 3
bantime = 3600
```

---

### üü¢ –ñ–ï–õ–ê–¢–ï–õ–¨–ù–û (–°–¥–µ–ª–∞—Ç—å –ø—Ä–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)

#### 8. –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–î–æ–±–∞–≤–∏—Ç—å TOTP –¥–ª—è –æ—Å–æ–±–æ –≤–∞–∂–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ Telegram Bot.

#### 9. Audit –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
- –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫

#### 10. –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π security audit
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
  aquasec/trivy image your-calendar-bot:latest
```

---

## üîê –ß–ï–ö–õ–ò–°–¢ –ù–ï–ú–ï–î–õ–ï–ù–ù–´–• –î–ï–ô–°–¢–í–ò–ô

- [ ] 1. –£–±—Ä–∞—Ç—å –ø–∞—Ä–æ–ª–∏ –∏–∑ `admin.py`, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [ ] 2. –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –±—ç–∫–∞–ø–∞
- [ ] 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å cron –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞
- [ ] 4. –ó–∞–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç 5232 Radicale –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- [ ] 5. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π SECRET_KEY
- [ ] 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ .env –Ω–µ –ø–æ–ø–∞–ª –≤ git (`git log --all --full-history -- .env`)
- [ ] 7. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ JSON —Ñ–∞–π–ª–æ–≤
- [ ] 8. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–æ—Ç–∞—Ü–∏—é –ª–æ–≥–æ–≤
- [ ] 9. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å fail2ban
- [ ] 10. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞

---

## üìû –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô –ü–†–ò –ò–ù–¶–ò–î–ï–ù–¢–ï

### –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —É—Ç–µ–∫–ª–∏:
1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ —Å–º–µ–Ω–∏—Ç—å –≤—Å–µ –ø–∞—Ä–æ–ª–∏ (–∞–¥–º–∏–Ω, Telegram token, API keys)
2. –†–æ—Ç–∏—Ä–æ–≤–∞—Ç—å SECRET_KEY
3. –£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∞

### –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω:
1. –û—Ç–∫–ª—é—á–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –æ—Ç —Å–µ—Ç–∏
2. –°–æ–∑–¥–∞—Ç—å snapshot –¥–∏—Å–∫–∞ –¥–ª—è forensics
3. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ backup –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ
4. –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ï—Å–ª–∏ –ø–æ—Ç–µ—Ä—è–Ω—ã –¥–∞–Ω–Ω—ã–µ:
1. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ backup
2. –ü—Ä–æ–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É backup –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–º
3. –£–ª—É—á—à–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É backup'–æ–≤

---

## üìà –†–ï–ô–¢–ò–ù–ì –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å: 6/10 ‚ö†Ô∏è

**–û—Ü–µ–Ω–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:**
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: 8/10 ‚úÖ
- –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: 4/10 ‚ö†Ô∏è
- –°–µ—Ç–µ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: 5/10 ‚ö†Ô∏è
- –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ: 0/10 ‚ùå
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: 9/10 ‚úÖ
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ: 3/10 ‚ö†Ô∏è

### –¶–µ–ª–µ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –ø–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏–π: 9/10 ‚úÖ

---

## üéØ –í–´–í–û–î–´

–°–∏—Å—Ç–µ–º–∞ –∏–º–µ–µ—Ç —Ö–æ—Ä–æ—à—É—é –±–∞–∑—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (—Ç—Ä–µ—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, PII masking, rate limiting), –Ω–æ **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ**:

1. **–°–†–û–ß–ù–û:** –£–±—Ä–∞—Ç—å –ø–∞—Ä–æ–ª–∏ –∏–∑ –∫–æ–¥–∞
2. **–°–†–û–ß–ù–û:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å backup
3. **–í–ê–ñ–ù–û:** –ó–∞–∫—Ä—ã—Ç—å Radicale –æ—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
4. **–í–ê–ñ–ù–û:** –î–æ–±–∞–≤–∏—Ç—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

–ë–µ–∑ —ç—Ç–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π —Å–∏—Å—Ç–µ–º–∞ —É—è–∑–≤–∏–º–∞ –∫:
- –ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- –ë–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ–π –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ê—Ç–∞–∫–∞–º –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
- –£—Ç–µ—á–∫–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º –¥–æ—Å—Ç—É–ø–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –≤—Ä–µ–º—è –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é:** 2-3 –¥–Ω—è —Ä–∞–±–æ—Ç—ã.
