# üîç –û—Ç—á—ë—Ç –æ code review: AI Calendar Assistant

**–î–∞—Ç–∞:** 10 –Ω–æ—è–±—Ä—è 2025
**–†–µ–≤—å—é–µ—Ä:** Claude Code
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ù–∞–π–¥–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

## üìä –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

–ü—Ä–æ–≤—ë–ª –ø–æ–ª–Ω–æ–µ —Ä–µ–≤—å—é –∫–æ–¥–∞. –•–æ—Ä–æ—à–∞—è –Ω–æ–≤–æ—Å—Ç—å: –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ø—Ä–æ–¥—É–º–∞–Ω–Ω–∞—è, –µ—Å—Ç—å rate limiting, middleware –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ. **–ù–æ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —Å—Ä–æ—á–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å.**

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** 6.5/10

- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** ‚ö†Ô∏è 6/10 (–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏)
- **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:** ‚úÖ 7/10 (—Ö–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –Ω–æ –µ—Å—Ç—å —á—Ç–æ —É–ª—É—á—à–∏—Ç—å)
- **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:** ‚úÖ 7/10 (Docker/CI/CD –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã, –Ω–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞)
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** ‚ö†Ô∏è 5/10 (–µ—Å—Ç—å CI, –Ω–æ coverage –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω)

**–í–µ—Ä–¥–∏–∫—Ç:** –ü—Ä–æ–µ–∫—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ö–æ—Ä–æ—à–∞—è, –Ω–æ **–ù–ï–õ–¨–ó–Ø –¥–µ–ø–ª–æ–∏—Ç—å –≤ production** –±–µ–∑ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å—Ä–æ—á–Ω–æ!)

### 1. ‚ùå –•–∞—Ä–¥–∫–æ–¥–Ω—ã–π SECRET_KEY —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º

**–§–∞–π–ª:** `ai-calendar-assistant/app/config.py:52`

```python
secret_key: Optional[str] = "default-secret-key-change-in-production"
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –≤ .env –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω SECRET_KEY, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–¥–µ–ª—ã–≤–∞—Ç—å JWT —Ç–æ–∫–µ–Ω—ã –∏ —Å–µ—Å—Å–∏–∏.

**–†–∏—Å–∫:** üî¥ –ö–†–ò–¢–ò–ß–ù–´–ô - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ–ª–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
```python
secret_key: str  # Make it required, remove default

# Add validation:
def __init__(self, **kwargs):
    super().__init__(**kwargs)
    if self.secret_key == "default-secret-key-change-in-production":
        raise ValueError("SECRET_KEY must be set to a unique value in production!")
```

---

### 2. ‚ùå DEBUG=True –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–§–∞–π–ª:** `ai-calendar-assistant/app/config.py:19`

```python
debug: bool = True
```

**–ü—Ä–æ–±–ª–µ–º–∞:** Debug mode —É—Ç–µ—á—ë—Ç —Å—Ç–µ–∫—Ç—Ä–µ–π—Å—ã –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ production.

**–†–∏—Å–∫:** üü† –í–´–°–û–ö–ò–ô - —É—Ç–µ—á–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
```python
debug: bool = False  # Secure by default
```

---

### 3. ‚ùå –î–µ—Ñ–æ–ª—Ç–Ω—ã–π –ø–∞—Ä–æ–ª—å –¥–ª—è Radicale

**–§–∞–π–ª:** `ai-calendar-assistant/app/config.py:39`

```python
radicale_bot_password: str = "bot_password_2024"
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –Ω–µ –∑–∞–¥–∞—Ç—å –ø–∞—Ä–æ–ª—å –≤ .env, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∏–∑–≤–µ—Å—Ç–Ω—ã–π –≤—Å–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –ø–∞—Ä–æ–ª—å.

**–†–∏—Å–∫:** üî¥ –ö–†–ò–¢–ò–ß–ù–´–ô - –¥–æ—Å—Ç—É–ø –∫ –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–º –¥–∞–Ω–Ω—ã–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
```python
radicale_bot_password: str  # No default - force user to set unique password
```

---

### 4. ‚ùå .env —Ñ–∞–π–ª –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ Docker –æ–±—Ä–∞–∑

**–§–∞–π–ª:** `ai-calendar-assistant/Dockerfile:33`

```dockerfile
COPY .env .env
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–µ–∫—Ä–µ—Ç—ã (API –∫–ª—é—á–∏, –ø–∞—Ä–æ–ª–∏) –ø–æ–ø–∞–¥—É—Ç –≤ Docker –æ–±—Ä–∞–∑ –∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω—ã –∫–æ–º–∞–Ω–¥–æ–π `docker history`.

**–†–∏—Å–∫:** üî¥ –ö–†–ò–¢–ò–ß–ù–´–ô - —É—Ç–µ—á–∫–∞ –≤—Å–µ—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
```dockerfile
# Remove this line completely!
# .env should NOT be in Docker image

# Use docker-compose env_file instead (already configured correctly):
# env_file:
#   - .env
```

---

### 5. ‚ùå –°–ª–∞–±–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (SHA-256 –±–µ–∑ salt)

**–§–∞–π–ª—ã:**
- `ai-calendar-assistant/app/services/admin_auth.py:47`
- `ai-calendar-assistant/app/routers/admin.py:49`

```python
def _hash_password(self, password: str) -> str:
    return hashlib.sha256(password.encode()).hexdigest()
```

**–ü—Ä–æ–±–ª–µ–º–∞:** SHA-256 –±–µ–∑ salt —É—è–∑–≤–∏–º –∫ rainbow table –∞—Ç–∞–∫–∞–º. –ù—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å bcrypt/argon2.

**–†–∏—Å–∫:** üü† –í–´–°–û–ö–ò–ô - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–∑–ª–æ–º–∞ admin –ø–∞—Ä–æ–ª–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
```python
import bcrypt

def _hash_password(self, password: str) -> bytes:
    """Hash password using bcrypt with automatic salt."""
    return bcrypt.hashpw(password.encode('utf-8'), bcrypt.gensalt(rounds=12))

def _verify_password(self, password: str, hashed: bytes) -> bool:
    """Verify password against bcrypt hash."""
    return bcrypt.checkpw(password.encode('utf-8'), hashed)
```

–î–æ–±–∞–≤–∏—Ç—å –≤ `requirements.txt`:
```
bcrypt==4.1.2
```

---

### 6. ‚ùå Hardcoded –¥–æ–º–µ–Ω –≤ –∫–æ–¥–µ

**–§–∞–π–ª:** `ai-calendar-assistant/app/services/telegram_handler.py:212`

```python
webapp_url = "https://—ç—Ç–æ–Ω–µ—Å–∞–º—ã–π–¥–ª–∏–Ω–Ω—ã–π–¥–æ–º–µ–Ω.—Ä—Ñ?v=2025103001"
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–æ–º–µ–Ω –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω, –Ω–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ .env.

**–†–∏—Å–∫:** üü° –°–†–ï–î–ù–ò–ô - —Å–ª–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π

**–†–µ—à–µ–Ω–∏–µ:**

–í `config.py`:
```python
webapp_url: str = "https://example.com"
webapp_version: str = "2025103001"
```

–í `telegram_handler.py`:
```python
webapp_url = f"{settings.webapp_url}?v={settings.webapp_version}"
```

---

### 7. ‚ö†Ô∏è API –∫–ª—é—á Yandex –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ plaintext (OK –¥–ª—è HTTPS)

**–§–∞–π–ª:** `ai-calendar-assistant/app/services/llm_agent_yandex.py:742`

–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è HTTPS, –Ω–æ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ:
- ‚úÖ –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HTTPS (–Ω–µ HTTP)
- ‚úÖ API –∫–ª—é—á –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** Line 738 - api_key –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è ‚úÖ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HTTPS:
```python
if not self.api_url.startswith('https://'):
    logger.warning("yandex_api_insecure", message="Using HTTP instead of HTTPS!")
```

---

## ‚ö†Ô∏è –í—ã—Å–æ–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 8. ‚ö†Ô∏è Rate limiter —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ø–∞–º—è—Ç–∏

**–§–∞–π–ª:** `ai-calendar-assistant/app/services/rate_limiter.py`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤—Å–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è. –°–ø–∞–º–µ—Ä—ã –º–æ–≥—É—Ç —ç–∫—Å–ø–ª—É–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—è –∑–∞–ø—Ä–æ—Å—ã –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞.

**–†–∏—Å–∫:** üü° –°–†–ï–î–ù–ò–ô - –æ–±—Ö–æ–¥ rate limiting

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è:

```python
import redis
from app.config import settings

class RateLimiter:
    def __init__(self):
        # Connect to Redis
        self.redis = redis.from_url(
            settings.redis_url,
            decode_responses=True
        )

    def is_blocked(self, user_id: str) -> bool:
        """Check if user is blocked (from Redis)."""
        block_until = self.redis.get(f"blocked:{user_id}")
        if not block_until:
            return False
        # ... rest of logic
```

–î–æ–±–∞–≤–∏—Ç—å –≤ `.env.example`:
```
REDIS_URL=redis://localhost:6379/0
```

---

### 9. ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ rate limiting –Ω–∞ —É—Ä–æ–≤–Ω–µ IP

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–µ–π—á–∞—Å rate limiting —Ç–æ–ª—å–∫–æ –ø–æ user_id. –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –º–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ Telegram.

**–†–∏—Å–∫:** üü° –°–†–ï–î–ù–ò–ô - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å DDoS —á–µ—Ä–µ–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å IP-based rate limiting –≤ middleware:

```python
from fastapi import Request
from slowapi import Limiter, _rate_limit_exceeded_handler
from slowapi.util import get_remote_address

limiter = Limiter(key_func=get_remote_address)
app.state.limiter = limiter

@app.post("/telegram/webhook")
@limiter.limit("100/minute")  # IP-based limit
async def webhook(request: Request):
    # ... existing code
```

---

### 10. ‚ùå Dockerfile healthcheck –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–§–∞–π–ª:** `ai-calendar-assistant/Dockerfile:42`

```dockerfile
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD python -c "import requests; requests.get('http://localhost:8000/health')"
```

**–ü—Ä–æ–±–ª–µ–º–∞:** `requests` –º–æ–¥—É–ª—å –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–º –æ–±—Ä–∞–∑–µ (–∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç httpx).

**–†–∏—Å–∫:** üü° –°–†–ï–î–ù–ò–ô - healthcheck –≤—Å–µ–≥–¥–∞ –ø–∞–¥–∞–µ—Ç, orchestrator –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

**–†–µ—à–µ–Ω–∏–µ:**

–í–∞—Ä–∏–∞–Ω—Ç 1 (–±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π):
```dockerfile
HEALTHCHECK CMD python -c "import urllib.request; urllib.request.urlopen('http://localhost:8000/health')"
```

–í–∞—Ä–∏–∞–Ω—Ç 2 (—Å curl):
```dockerfile
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*
HEALTHCHECK CMD curl -f http://localhost:8000/health || exit 1
```

---

## üìù –ü—Ä–æ–±–ª–µ–º—ã –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

### 11. üìâ –û–≥—Ä–æ–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è _handle_text (869 —Å—Ç—Ä–æ–∫!)

**–§–∞–π–ª:** `ai-calendar-assistant/app/services/telegram_handler.py:668`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∞—Ä—É—à–µ–Ω–∏–µ Single Responsibility Principle. –°–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å.

**–†–∏—Å–∫:** üü° –°–†–ï–î–ù–ò–ô - —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏, –≤—ã—Å–æ–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –±–∞–≥–æ–≤

**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–±–∏—Ç—å –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:

```python
async def _handle_text(self, update: Update, user_id: str, text: str) -> None:
    """Main text handler - delegates to specialized handlers."""

    # Check calendar connection
    if not await self._check_calendar_available(update):
        return

    # Handle settings input (timezone, times, etc)
    if await self._handle_settings_input(update, user_id, text):
        return

    # Handle deletion confirmations
    if await self._handle_deletion_confirmation(update, user_id, text):
        return

    # Process as calendar command
    await self._process_calendar_command(update, user_id, text)

async def _check_calendar_available(self, update: Update) -> bool:
    """Check if calendar service is available."""
    if not calendar_service.is_connected():
        await update.message.reply_text(
            "‚ö†Ô∏è –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."
        )
        return False
    return True

async def _handle_settings_input(self, update: Update, user_id: str, text: str) -> bool:
    """Handle settings-related input (time changes, etc). Returns True if handled."""
    # ... settings logic (lines 696-736)

async def _handle_deletion_confirmation(self, update: Update, user_id: str, text: str) -> bool:
    """Handle deletion confirmation dialog. Returns True if handled."""
    # ... deletion logic (lines 739-768)

async def _process_calendar_command(self, update: Update, user_id: str, text: str) -> None:
    """Process calendar command via LLM."""
    # ... LLM processing (lines 771-868)
```

---

### 12. üßπ –ú–Ω–æ–≥–æ "ARCHIVED" –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

**–ù–∞–π–¥–µ–Ω–æ –≤:** main.py, telegram_handler.py, routers

```python
# ARCHIVED - Property Bot moved to independent microservice (_archived/property_bot_microservice)
# Property Bot imports removed - calendar bot only
PROPERTY_BOT_ENABLED = False
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–º—É—Å–æ—Ä–µ–Ω–Ω—ã–π –∫–æ–¥, —Å–ª–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å.

**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å –≤–µ—Å—å –∞—Ä—Ö–∏–≤–Ω—ã–π –∫–æ–¥ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏. –ï—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è - –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ git history.

**–ù–∞–π—Ç–∏ –≤—Å–µ ARCHIVED:**
```bash
grep -r "ARCHIVED" ai-calendar-assistant/app/
```

---

### 13. üìê –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ type hints –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö

**–ü—Ä–∏–º–µ—Ä:** `llm_agent_yandex.py:990`

```python
def _build_batch_confirmation(self, data_array: List[dict], ...):
```

**–ü—Ä–æ–±–ª–µ–º–∞:** `List[dict]` —Å–ª–∏—à–∫–æ–º –æ–±—â–∏–π. –ù–µ –ø–æ–Ω—è—Ç–Ω–æ —á—Ç–æ –≤–Ω—É—Ç—Ä–∏ dict.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TypedDict –∏–ª–∏ Pydantic models:

```python
from typing import TypedDict, Optional

class ActionDict(TypedDict):
    intent: str
    title: Optional[str]
    start_time: Optional[str]
    end_time: Optional[str]
    location: Optional[str]

def _build_batch_confirmation(
    self,
    data_array: List[ActionDict],
    user_text: str,
    language: str,
    existing_events: Optional[List[dict]] = None
) -> EventDTO:
    """Build batch confirmation EventDTO from array of actions."""
    # ...
```

---

### 14. ‚ö†Ô∏è Bare except blocks

**–§–∞–π–ª:** `telegram_handler.py:348`

```python
try:
    import pytz
    pytz.timezone(timezone)  # Validate timezone
    user_preferences.set_timezone(user_id, timezone)
    await update.message.reply_text(f"‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: {timezone}")
except:
    await update.message.reply_text(
        "–ù–µ–≤–µ—Ä–Ω—ã–π –ø–æ—è—Å. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /timezone –¥–ª—è —Å–ø–∏—Å–∫–∞."
    )
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –õ–æ–≤–∏—Ç –í–°–ï –∏—Å–∫–ª—é—á–µ–Ω–∏—è, –≤–∫–ª—é—á–∞—è KeyboardInterrupt –∏ SystemExit.

**–†–µ—à–µ–Ω–∏–µ:**
```python
try:
    import pytz
    pytz.timezone(timezone)  # Validate timezone
    user_preferences.set_timezone(user_id, timezone)
    await update.message.reply_text(f"‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: {timezone}")
except (pytz.exceptions.UnknownTimeZoneError, Exception) as e:
    logger.error("timezone_set_error", user_id=user_id, timezone=timezone, error=str(e))
    await update.message.reply_text(
        "–ù–µ–≤–µ—Ä–Ω—ã–π –ø–æ—è—Å. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /timezone –¥–ª—è —Å–ø–∏—Å–∫–∞."
    )
```

–ù–∞–π–¥–µ–Ω–æ —Ç–∞–∫–∂–µ –≤ `telegram_handler.py`:
- Line 923 (in `_parse_optional_datetime`)
- Line 942
- Line 952
- Line 1039
- Line 1047
- Line 1100
- Line 1107
- Line 1134
- Line 1141

**–î–µ–π—Å—Ç–≤–∏–µ:** –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ `except:` –Ω–∞ `except Exception as e:`

---

## üêõ –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –±–∞–≥–∏

### 15. üîÑ Race condition –≤ conversation_history

**–§–∞–π–ª:** `telegram_handler.py:52`

```python
self.conversation_history = {}  # Not thread-safe
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Å–∫–æ–ª—å–∫–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–≥—É—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥–∞.

**–°—Ü–µ–Ω–∞—Ä–∏–π –±–∞–≥–∞:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç "–°–æ–∑–¥–∞–π –≤—Å—Ç—Ä–µ—á—É –∑–∞–≤—Ç—Ä–∞"
2. –ü–æ–∫–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç "–í 14:00"
3. –í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å –º–æ–∂–µ—Ç –∑–∞—Ç–µ—Ä–µ—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–µ—Ä–≤–æ–≥–æ

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `asyncio.Lock` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:

```python
from asyncio import Lock
from typing import Dict

class TelegramHandler:
    def __init__(self, app: Application):
        self.app = app
        self.bot = app.bot
        self.conversation_history: Dict[str, list] = {}
        self._locks: Dict[str, Lock] = {}  # Lock per user

    async def _handle_text(self, update: Update, user_id: str, text: str) -> None:
        # Get or create lock for this user
        if user_id not in self._locks:
            self._locks[user_id] = Lock()

        lock = self._locks[user_id]

        async with lock:
            # Process message safely
            # ... rest of logic
```

---

### 16. üíâ –í–æ–∑–º–æ–∂–Ω–∞—è SQL Injection –≤ analytics_service

**–§–∞–π–ª:** –ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å!

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ analytics_service.py** - –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è f-string –¥–ª—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤:

```python
# ‚ùå –ü–õ–û–•–û - SQL Injection!
query = f"SELECT * FROM users WHERE id = {user_id}"
cursor.execute(query)

# ‚úÖ –•–û–†–û–®–û - –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
query = "SELECT * FROM users WHERE id = ?"
cursor.execute(query, (user_id,))

# ‚úÖ –ò–ª–∏ –¥–ª—è PostgreSQL
query = "SELECT * FROM users WHERE id = %s"
cursor.execute(query, (user_id,))
```

**–î–µ–π—Å—Ç–≤–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ!

```bash
grep -r "execute.*f\"" ai-calendar-assistant/app/
grep -r "execute.*f'" ai-calendar-assistant/app/
```

---

### 17. üî¢ –í–æ–∑–º–æ–∂–Ω–æ–µ —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ

**–§–∞–π–ª:** `rate_limiter.py:42`

```python
self.MAX_MESSAGES_PER_MINUTE = 10
self.MAX_MESSAGES_PER_HOUR = 50
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–∏—Ç 10 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É 60 –º–∏–Ω—É—Ç –ø–æ–¥—Ä—è–¥, —ç—Ç–æ 600 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–ø–∏—Å–∫–µ `_message_history[user_id]`.

**–†–µ—à–µ–Ω–∏–µ:** –£–∂–µ –µ—Å—Ç—å –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ line 100-103 ‚úÖ

---

## üîß –ü—Ä–æ–±–ª–µ–º—ã –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### 18. üîë CI/CD SSH key –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–§–∞–π–ª:** `.gitlab-ci.yml:69`

```yaml
- echo "$SSH_PRIVATE_KEY" | tr -d '\r' | ssh-add -
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –•–æ—Ä–æ—à–æ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SSH key, –∞ –Ω–µ –ø–∞—Ä–æ–ª—å

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- ‚úÖ –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∫–ª—é—á –∑–∞—â–∏—â—ë–Ω passphrase
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ dedicated deploy key —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ (read-only –¥–ª—è —Ä–µ–ø–æ, write –¥–ª—è /root/ai-calendar-assistant)
- ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ deploy keys (–∫–∞–∂–¥—ã–µ 90 –¥–Ω–µ–π)

---

### 19. üìù –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–æ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤

**–§–∞–π–ª:** `docker-compose.yml`

**–ü—Ä–æ–±–ª–µ–º–∞:** –õ–æ–≥–∏ –±—É–¥—É—Ç —Ä–∞—Å—Ç–∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ, –∑–∞–±–∏–≤–∞—è –¥–∏—Å–∫.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å logging driver:

```yaml
services:
  calendar-assistant:
    # ... existing config
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  property-bot:
    # ... existing config
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  radicale:
    # ... existing config
    logging:
      driver: "json-file"
      options:
        max-size: "5m"
        max-file: "2"
```

---

### 20. üì¶ –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π volume

**–§–∞–π–ª:** `docker-compose.yml:109`

```yaml
volumes:
  credentials:  # Defined but not mounted anywhere
```

**–ü—Ä–æ–±–ª–µ–º–∞:** Volume –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –Ω–æ –Ω–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.

**–†–µ—à–µ–Ω–∏–µ:** –õ–∏–±–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```yaml
services:
  calendar-assistant:
    volumes:
      - ./credentials:/app/credentials  # Already exists
      - credentials:/app/credentials    # Or use named volume
```

–õ–∏–±–æ —É–¥–∞–ª–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ volumes.

---

## üì¶ –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

### 21. üìÖ –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –≤–µ—Ä—Å–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫

**–§–∞–π–ª:** `requirements.txt`

```txt
cryptography==41.0.7  # Latest is 42.0.5 (has security fixes!)
fastapi==0.104.1      # Latest is 0.115.x
uvicorn==0.24.0       # Latest is 0.30.x
pydantic==2.5.2       # Latest is 2.8.x
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç–µ –≤–∞–∂–Ω—ã–µ security fixes!

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# Backup current versions
cp requirements.txt requirements.txt.backup

# Update packages
pip install --upgrade cryptography fastapi uvicorn pydantic python-telegram-bot

# Test thoroughly!
pytest tests/

# If all good, freeze new versions
pip freeze > requirements.txt
```

**–í–∞–∂–Ω—ã–µ security –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
- `cryptography==42.0.5` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã CVE –≤ 41.x
- `python-telegram-bot==21.5` - —É–ª—É—á—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

### 22. üîÑ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP –∫–ª–∏–µ–Ω—Ç–æ–≤

**–§–∞–π–ª:** `requirements.txt:24-26`

```txt
httpx>=0.25.0
aiohttp>=3.9.0
requests>=2.31.0
```

**–ü—Ä–æ–±–ª–µ–º–∞:** 3 HTTP –∫–ª–∏–µ–Ω—Ç–∞ —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞ –∏ attack surface.

**–ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
- `httpx` - –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–æ–¥–µ
- `aiohttp` - –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–æ–¥–µ
- `requests` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `llm_agent_yandex.py:761`

**–†–µ—à–µ–Ω–∏–µ:**
```txt
# Keep only what's needed
requests>=2.31.0

# Remove unused:
# httpx>=0.25.0
# aiohttp>=3.9.0
```

–ò–ª–∏ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –Ω–∞ –æ–¥–∏–Ω –∫–ª–∏–µ–Ω—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, httpx –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏):

```python
# In llm_agent_yandex.py
import httpx

async def extract_event(...):
    async with httpx.AsyncClient() as client:
        response = await client.post(
            self.api_url,
            headers=headers,
            json=payload,
            timeout=30
        )
```

---

## ‚úÖ –ß—Ç–æ —Ö–æ—Ä–æ—à–æ —Å–¥–µ–ª–∞–Ω–æ

–ß—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —Ç–æ–ª—å–∫–æ –Ω–µ–≥–∞—Ç–∏–≤–∞ - –≤–æ—Ç —á—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –û–¢–õ–ò–ß–ù–û:

1. ‚úÖ **Rate limiting —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω** - –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞
2. ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** (structlog) - –ª–µ–≥–∫–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å
3. ‚úÖ **Telegram WebApp HMAC authentication** - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
4. ‚úÖ **Docker multi-stage build** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–±—Ä–∞–∑–∞
5. ‚úÖ **Health checks –≤ docker-compose** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
6. ‚úÖ **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ internal/external networks** - –∏–∑–æ–ª—è—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
7. ‚úÖ **CI/CD pipeline —Å —Ç–µ—Å—Ç–∞–º–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
8. ‚úÖ **Type hints –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –º–µ—Å—Ç** - –ø–æ–º–æ–≥–∞–µ—Ç IDE –∏ mypy
9. ‚úÖ **Middleware –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
10. ‚úÖ **Graceful handling —Ç–µ–ª–µ–≥—Ä–∞–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π** - –Ω–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ—à–∏–±–∫–∞—Ö
11. ‚úÖ **Pydantic –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏** - —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
12. ‚úÖ **Async/await –≤–µ–∑–¥–µ** - –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
13. ‚úÖ **Docker Compose –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏** - –ª–µ–≥–∫–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å
14. ‚úÖ **–û—Ç–¥–µ–ª—å–Ω–∞—è –ë–î –¥–ª—è property bot** - –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
15. ‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Yandex GPT** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –†–æ—Å—Å–∏–∏

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### üî¥ –°—Ä–æ—á–Ω–æ (—Å–µ–≥–æ–¥–Ω—è!):

- [ ] 1. –£–±—Ä–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π SECRET_KEY (–∫—Ä–∏—Ç–∏—á–Ω–æ!)
- [ ] 2. DEBUG=False –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- [ ] 3. –£–±—Ä–∞—Ç—å `COPY .env` –∏–∑ Dockerfile
- [ ] 4. –£–±—Ä–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –∏–∑ config.py
- [ ] 5. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è .env:

```bash
# Generate secure SECRET_KEY
python -c "import secrets; print(secrets.token_urlsafe(32))"

# Generate secure passwords
python -c "import secrets; print('RADICALE:', secrets.token_urlsafe(24))"
python -c "import secrets; print('DB_PASSWORD:', secrets.token_urlsafe(24))"
```

### üü† –í —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏:

- [ ] 6. –ó–∞–º–µ–Ω–∏—Ç—å SHA-256 –Ω–∞ bcrypt –¥–ª—è –ø–∞—Ä–æ–ª–µ–π
- [ ] 7. –í—ã–Ω–µ—Å—Ç–∏ hardcoded –¥–æ–º–µ–Ω –≤ config
- [ ] 8. –ò—Å–ø—Ä–∞–≤–∏—Ç—å Docker healthcheck
- [ ] 9. –î–æ–±–∞–≤–∏—Ç—å Redis –¥–ª—è rate limiter
- [ ] 10. –û–±–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ cryptography)
- [ ] 11. –î–æ–±–∞–≤–∏—Ç—å —Ä–æ—Ç–∞—Ü–∏—é –ª–æ–≥–æ–≤ –≤ docker-compose
- [ ] 12. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ bare except blocks

### üü° –ö–æ–≥–¥–∞ –±—É–¥–µ—Ç –≤—Ä–µ–º—è:

- [ ] 13. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–æ–ª—å—à–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π (–æ—Å–æ–±–µ–Ω–Ω–æ `_handle_text`)
- [ ] 14. –£–¥–∞–ª–∏—Ç—å ARCHIVED –∫–æ–¥ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- [ ] 15. –î–æ–±–∞–≤–∏—Ç—å IP-based rate limiting
- [ ] 16. –£–ª—É—á—à–∏—Ç—å type hints (TypedDict)
- [ ] 17. –î–æ–±–∞–≤–∏—Ç—å asyncio.Lock –¥–ª—è conversation_history
- [ ] 18. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SQL injection –≤ analytics_service
- [ ] 19. –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ HTTP –∫–ª–∏–µ–Ω—Ç—ã
- [ ] 20. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus/Grafana)

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –¥–µ–ø–ª–æ—è –≤ production

–ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –≤ production —É–±–µ–¥–∏—Ç–µ—Å—å:

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- [ ] SECRET_KEY —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —É–Ω–∏–∫–∞–ª—å–Ω—ã–π (–¥–ª–∏–Ω–∞ >=32 —Å–∏–º–≤–æ–ª–∞)
- [ ] DEBUG=False –≤ .env
- [ ] –í—Å–µ –ø–∞—Ä–æ–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ .env (–Ω–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ)
- [ ] .env –ù–ï –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ git (.gitignore –ø—Ä–æ–≤–µ—Ä–µ–Ω)
- [ ] .env –ù–ï –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ Docker –æ–±—Ä–∞–∑
- [ ] –ü–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è —Å bcrypt (–Ω–µ SHA-256)

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
- [ ] HTTPS –Ω–∞—Å—Ç—Ä–æ–µ–Ω (Let's Encrypt/Certbot)
- [ ] Firewall –Ω–∞—Å—Ç—Ä–æ–µ–Ω (—Ç–æ–ª—å–∫–æ 80, 443, 22 –æ—Ç–∫—Ä—ã—Ç—ã)
- [ ] Radicale –ù–ï exposed –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–π –ø–æ—Ä—Ç (—Ç–æ–ª—å–∫–æ internal)
- [ ] PostgreSQL –ù–ï exposed –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–π –ø–æ—Ä—Ç
- [ ] Docker –ª–æ–≥–∏ —Ä–æ—Ç–∏—Ä—É—é—Ç—Å—è (max-size, max-file)
- [ ] –ë—ç–∫–∞–ø—ã –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (cron job)

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
- [ ] Sentry DSN –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫
- [ ] Health checks —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –õ–æ–≥–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç API –∫–ª—é—á–∏ –∏ –ø–∞—Ä–æ–ª–∏
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] Rate limits –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] Webhook –æ—Ç Telegram —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Voice messages —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –î–æ–±–∞–≤–∏—Ç—å pre-commit hooks

```bash
pip install pre-commit
```

–°–æ–∑–¥–∞—Ç—å `.pre-commit-config.yaml`:

```yaml
repos:
  - repo: https://github.com/psf/black
    rev: 23.12.0
    hooks:
      - id: black
        language_version: python3.11

  - repo: https://github.com/pycqa/flake8
    rev: 6.1.0
    hooks:
      - id: flake8
        args: [--max-line-length=120]

  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: check-yaml
      - id: end-of-file-fixer
      - id: trailing-whitespace
      - id: check-added-large-files
      - id: detect-private-key  # ‚ö†Ô∏è –í–∞–∂–Ω–æ!

  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.5
    hooks:
      - id: bandit
        args: ["-r", "app/"]
```

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
```bash
pre-commit install
```

---

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Dependabot

–°–æ–∑–¥–∞—Ç—å `.github/dependabot.yml`:

```yaml
version: 2
updates:
  - package-ecosystem: "pip"
    directory: "/ai-calendar-assistant"
    schedule:
      interval: "weekly"
    open-pull-requests-limit: 10

  - package-ecosystem: "docker"
    directory: "/ai-calendar-assistant"
    schedule:
      interval: "weekly"

  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
```

---

### 3. –î–æ–±–∞–≤–∏—Ç—å CHANGELOG.md

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ [Keep a Changelog](https://keepachangelog.com/) —Ñ–æ—Ä–º–∞—Ç:

```markdown
# Changelog

## [Unreleased]
### Security
- Fixed hardcoded SECRET_KEY
- Replaced SHA-256 with bcrypt for password hashing
- Removed .env from Docker image

### Changed
- DEBUG defaults to False now

## [1.0.0] - 2025-10-31
### Added
- Initial release
```

---

### 4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Sentry –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—à–∏–±–æ–∫

```python
# app/main.py
import sentry_sdk
from sentry_sdk.integrations.fastapi import FastApiIntegration

if settings.sentry_dsn:
    sentry_sdk.init(
        dsn=settings.sentry_dsn,
        integrations=[FastApiIntegration()],
        environment=settings.app_env,
        traces_sample_rate=0.1,  # 10% —Ç—Ä–µ–π—Å–æ–≤
    )
```

---

### 5. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```python
from prometheus_fastapi_instrumentator import Instrumentator

@app.on_event("startup")
async def startup_event():
    # Existing code...

    # Add Prometheus metrics
    Instrumentator().instrument(app).expose(app, endpoint="/metrics")
```

–í docker-compose –¥–æ–±–∞–≤–∏—Ç—å Prometheus + Grafana –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏.

---

## üîç –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ù–∞–π—Ç–∏ –≤—Å–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

```bash
cd ai-calendar-assistant

# Find hardcoded secrets
grep -r "password.*=" app/ | grep -v ".pyc"
grep -r "secret.*=" app/ | grep -v ".pyc"
grep -r "api.*key.*=" app/ | grep -v ".pyc"

# Find bare except blocks
grep -r "except:" app/ | grep -v ".pyc"

# Find SQL queries (check for injection)
grep -r "execute.*f\"" app/ | grep -v ".pyc"
grep -r "execute.*f'" app/ | grep -v ".pyc"

# Find TODO/FIXME comments
grep -r "TODO\|FIXME\|XXX\|HACK" app/

# Find print statements (should use logger)
grep -r "print(" app/ | grep -v ".pyc"
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–æ–¥–∞

```bash
# Lines of code
find app/ -name "*.py" | xargs wc -l | tail -1

# Number of functions
grep -r "^def " app/ | wc -l

# Number of classes
grep -r "^class " app/ | wc -l

# Complexity (if radon installed)
radon cc app/ -a -nb
```

---

## üéì –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

1. [OWASP Top 10](https://owasp.org/www-project-top-ten/)
2. [Python Security Best Practices](https://snyk.io/blog/python-security-best-practices-cheat-sheet/)
3. [FastAPI Security](https://fastapi.tiangolo.com/tutorial/security/)
4. [Docker Security](https://docs.docker.com/engine/security/)
5. [Telegram Bot Security](https://core.telegram.org/bots/webapps#validating-data-received-via-the-mini-app)

---

## üìß –ö–æ–Ω—Ç–∞–∫—Ç—ã

–í–æ–ø—Ä–æ—Å—ã –ø–æ —ç—Ç–æ–º—É review? –°–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

**–î–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞:** 10 –Ω–æ—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** 1.0.0
**–†–µ–≤—å—é–µ—Ä:** Claude Code (Anthropic)

---

**–°–ª–µ–¥—É—é—â–∏–π review:** –ß–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞ –∏–ª–∏ –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
