# 🔄 Диаграммы взаимодействия с Yandex GPT

**Проект:** AI Calendar Assistant
**Дата:** 24 ноября 2025

---

## 📊 Общая архитектура системы

```
┌─────────────────────────────────────────────────────────────────────┐
│                         ПОЛЬЗОВАТЕЛЬ                                 │
│                         (Telegram Bot)                               │
└──────────────────────────────┬──────────────────────────────────────┘
                               │
                               │ 1. Сообщение
                               │ "Встреча завтра в 15:00"
                               ▼
┌─────────────────────────────────────────────────────────────────────┐
│                     TELEGRAM WEBHOOK                                 │
│                   (app/routers/telegram.py)                         │
│  • Проверка webhook secret                                          │
│  • Парсинг Update объекта                                           │
│  • Background task                                                   │
└──────────────────────────────┬──────────────────────────────────────┘
                               │
                               │ 2. Update
                               ▼
┌─────────────────────────────────────────────────────────────────────┐
│                   TELEGRAM HANDLER                                   │
│              (app/services/telegram_handler.py)                     │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────┐      │
│  │ handle_update()                                          │      │
│  │  • Определить тип сообщения (text/voice/button)        │      │
│  │  • Проверить команды (/start, /settings)               │      │
│  └──────────────┬───────────────────────────────────────────┘      │
│                 │                                                    │
│                 ▼                                                    │
│  ┌──────────────────────────────────────────────────────────┐      │
│  │ _handle_text()                                           │      │
│  │  • Получить timezone пользователя                       │      │
│  │  • Загрузить existing_events из календаря               │      │
│  │  • Проверить conversation_history                       │      │
│  │  • Детектировать schedule format                        │      │
│  └──────────────┬───────────────────────────────────────────┘      │
└─────────────────┼────────────────────────────────────────────────┘
                  │
                  │ 3. extract_event()
                  ▼
┌─────────────────────────────────────────────────────────────────────┐
│                   LLM AGENT YANDEX                                   │
│              (app/services/llm_agent_yandex.py)                     │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────┐      │
│  │ extract_event()                                          │      │
│  │  • Получить текущую дату/время                         │      │
│  │  • Рассчитать относительные даты                       │      │
│  │  • Сформировать system_prompt                          │      │
│  │  • Добавить events_prefix (existing_events)            │      │
│  │  • Добавить conversation_history (если clarify)        │      │
│  │  • Сформировать function_schema                        │      │
│  └──────────────┬───────────────────────────────────────────┘      │
└─────────────────┼────────────────────────────────────────────────┘
                  │
                  │ 4. API Request
                  ▼
┌─────────────────────────────────────────────────────────────────────┐
│                     YANDEX GPT API                                   │
│   https://llm.api.cloud.yandex.net/foundationModels/v1/completion  │
│                                                                      │
│  POST /completion                                                    │
│  {                                                                   │
│    "modelUri": "gpt://folder_id/yandexgpt/latest",                 │
│    "completionOptions": {                                           │
│      "temperature": 0.2,                                            │
│      "maxTokens": 2000                                              │
│    },                                                               │
│    "messages": [                                                    │
│      {"role": "system", "text": "...полный промпт..."}             │
│    ]                                                                │
│  }                                                                  │
└──────────────────────────────┬──────────────────────────────────────┘
                               │
                               │ 5. JSON Response
                               ▼
┌─────────────────────────────────────────────────────────────────────┐
│                   RESPONSE PARSER                                    │
│              (llm_agent_yandex._parse_yandex_response)              │
│                                                                      │
│  • Извлечь JSON из текста                                           │
│  • Удалить markdown code blocks                                     │
│  • Парсить intent и параметры                                       │
│  • Валидировать даты (ISO 8601)                                     │
│  • Создать EventDTO / TodoDTO                                       │
└──────────────────────────────┬──────────────────────────────────────┘
                               │
                               │ 6. EventDTO
                               ▼
┌─────────────────────────────────────────────────────────────────────┐
│                   INTENT ROUTER                                      │
│                    (TelegramHandler)                                 │
│                                                                      │
│  if intent == CREATE:                                               │
│    → _handle_create()                                               │
│                                                                      │
│  elif intent == TODO:                                               │
│    → _handle_todo()                                                 │
│                                                                      │
│  elif intent == QUERY:                                              │
│    → _handle_query()                                                │
│                                                                      │
│  elif intent == UPDATE:                                             │
│    → _handle_update()                                               │
│                                                                      │
│  elif intent == DELETE:                                             │
│    → _handle_delete()                                               │
│                                                                      │
│  elif intent == BATCH_CONFIRM:                                      │
│    → _handle_batch_confirm()                                        │
│                                                                      │
│  elif intent == CLARIFY:                                            │
│    → send clarify_question                                          │
└──────────────────────────────┬──────────────────────────────────────┘
                               │
                               │ 7. Execute Action
                               ▼
┌─────────────────────────────────────────────────────────────────────┐
│                   SERVICES LAYER                                     │
│                                                                      │
│  ┌──────────────────┐    ┌──────────────────┐                      │
│  │ CalendarService  │    │  TodosService    │                      │
│  │   (Radicale)     │    │   (Database)     │                      │
│  │                  │    │                  │                      │
│  │ • create_event() │    │ • create_todo()  │                      │
│  │ • update_event() │    │ • list_todos()   │                      │
│  │ • delete_event() │    │ • update_todo()  │                      │
│  │ • list_events()  │    │ • delete_todo()  │                      │
│  └──────────────────┘    └──────────────────┘                      │
└──────────────────────────────┬──────────────────────────────────────┘
                               │
                               │ 8. Response
                               ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         ПОЛЬЗОВАТЕЛЬ                                 │
│                                                                      │
│  ✅ Записал                                                          │
│  25 ноября, понедельник 15:00 • Встреча                             │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 🔄 Lifecycle одного запроса

### Создание простого события

```
┌─────────────────────────────────────────────────────────────┐
│ 1. USER INPUT                                                │
│    "Встреча завтра в 15:00"                                  │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ 2. TELEGRAM HANDLER                                          │
│    • user_id: "123456789"                                    │
│    • timezone: "Europe/Moscow" (из preferences)             │
│    • existing_events: [...] (загрузка из календаря)         │
│    • conversation_history: [] (пусто)                        │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ 3. PROMPT FORMATION                                          │
│                                                              │
│    SYSTEM PROMPT:                                            │
│    ┌────────────────────────────────────────────────┐       │
│    │ You are a calendar assistant...                │       │
│    │                                                 │       │
│    │ ТЕКУЩАЯ ДАТА: 24.11.2025 15:30                │       │
│    │ "завтра" = 25.11.2025                          │       │
│    │                                                 │       │
│    │ User request: Встреча завтра в 15:00          │       │
│    │                                                 │       │
│    │ Return ONLY JSON:                              │       │
│    └────────────────────────────────────────────────┘       │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ 4. YANDEX GPT API                                            │
│    POST /completion                                          │
│    • temperature: 0.2                                        │
│    • maxTokens: 2000                                         │
│    • timeout: 30s                                            │
│                                                              │
│    Processing... (1-3 секунды)                               │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ 5. GPT RESPONSE                                              │
│    {                                                         │
│      "intent": "create",                                     │
│      "title": "Встреча",                                     │
│      "start_time": "2025-11-25T15:00:00+03:00",             │
│      "end_time": "2025-11-25T16:00:00+03:00",               │
│      "duration_minutes": 60,                                 │
│      "confidence": 0.95                                      │
│    }                                                         │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ 6. PARSE TO EVENTDTO                                         │
│    EventDTO(                                                 │
│      intent=IntentType.CREATE,                              │
│      title="Встреча",                                       │
│      start_time=datetime(2025,11,25,15,0,tzinfo=+03:00),   │
│      end_time=datetime(2025,11,25,16,0,tzinfo=+03:00),     │
│      duration_minutes=60,                                    │
│      confidence=0.95                                         │
│    )                                                         │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ 7. EXECUTE ACTION                                            │
│    _handle_create()                                          │
│    ↓                                                         │
│    CalendarService.create_event(user_id, event_dto)         │
│    ↓                                                         │
│    → Radicale CalDAV: PUT /calendars/user123/event.ics      │
│    ↓                                                         │
│    ✅ Success: event_uid = "abc-123-def"                     │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ 8. USER RESPONSE                                             │
│    ✅ Записал                                                │
│    25 ноября, понедельник 15:00 • Встреча                   │
└─────────────────────────────────────────────────────────────┘
```

**Время выполнения:** ~2-4 секунды
**Токены:** ~4500 input + ~150 output = ~4650 total

---

## 🎯 Lifecycle множественных действий

### Batch Confirm Flow

```
┌─────────────────────────────────────────────────────────────┐
│ 1. USER INPUT                                                │
│    "В 17 встреча, потом в 19 ужин и позвонить маме"         │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ 2. SYSTEM PROMPT                                             │
│    MULTIPLE EVENTS IN ONE COMMAND:                           │
│    When user mentions MULTIPLE events with "потом",          │
│    create batch_actions array.                               │
│                                                              │
│    User request: В 17 встреча, потом в 19 ужин и позвонить  │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ 3. GPT RESPONSE                                              │
│    {                                                         │
│      "intent": "batch_confirm",                              │
│      "batch_actions": [                                      │
│        {                                                     │
│          "intent": "create",                                 │
│          "title": "Встреча",                                 │
│          "start_time": "2025-11-24T17:00:00+03:00"          │
│        },                                                    │
│        {                                                     │
│          "intent": "create",                                 │
│          "title": "Ужин",                                    │
│          "start_time": "2025-11-24T19:00:00+03:00"          │
│        },                                                    │
│        {                                                     │
│          "intent": "todo",                                   │
│          "title": "Позвонить маме"                           │
│        }                                                     │
│      ],                                                      │
│      "batch_summary": "📅 Создать 2 события и 1 задачу"     │
│    }                                                         │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ 4. BUILD CONFIRMATION MESSAGE                                │
│    📅 Создать 2 события и 1 задачу:                         │
│                                                              │
│    События:                                                  │
│    • 17:00-18:00 Встреча                                     │
│    • 19:00-20:00 Ужин                                        │
│                                                              │
│    Задачи:                                                   │
│    • Позвонить маме                                          │
│                                                              │
│    [Создать] [Отмена]                                        │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ 5. USER CONFIRMS (нажимает "Создать")                        │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ 6. EXECUTE BATCH ACTIONS                                     │
│    for action in batch_actions:                              │
│      if action.intent == "create":                           │
│        → CalendarService.create_event()                      │
│      elif action.intent == "todo":                           │
│        → TodosService.create_todo()                          │
│                                                              │
│    Results:                                                  │
│    ✅ Событие 1: "Встреча" создано                           │
│    ✅ Событие 2: "Ужин" создано                              │
│    ✅ Задача: "Позвонить маме" создана                       │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ 7. USER RESPONSE                                             │
│    ✅ Создано 3 записи:                                      │
│    • 17:00 Встреча                                           │
│    • 19:00 Ужин                                              │
│    • Задача: Позвонить маме                                  │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔄 Lifecycle с clarify (уточнение)

### Multi-turn Conversation

```
┌─────────────────────────────────────────────────────────────┐
│ TURN 1: INITIAL REQUEST                                      │
│                                                              │
│ USER: "Перенеси встречу"                                     │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ SYSTEM CHECKS:                                               │
│ • existing_events loaded: 3 встречи найдены                 │
│ • Нет уточнения какую именно                                 │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ GPT RESPONSE (Turn 1):                                       │
│ {                                                            │
│   "intent": "clarify",                                       │
│   "clarify_question": "Какую именно встречу перенести?      │
│                        У вас 3 встречи:                      │
│                        • Встреча с Леной (24.11 15:00)      │
│                        • Встреча с клиентом (25.11 10:00)   │
│                        • Встреча команды (26.11 14:00)"     │
│ }                                                            │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ STORE CONVERSATION HISTORY:                                  │
│ conversation_history[user_id] = [                            │
│   {"role": "user", "content": "Перенеси встречу"},          │
│   {"role": "assistant", "content": "Какую именно..."}       │
│ ]                                                            │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ BOT → USER:                                                  │
│ Какую именно встречу перенести?                             │
│ У вас 3 встречи:                                            │
│ • Встреча с Леной (24.11 15:00)                             │
│ • Встреча с клиентом (25.11 10:00)                          │
│ • Встреча команды (26.11 14:00)                             │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ TURN 2: USER CLARIFIES                                       │
│                                                              │
│ USER: "С Леной"                                              │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ LOAD CONVERSATION HISTORY:                                   │
│ limited_history = [                                          │
│   {"role": "user", "content": "Перенеси встречу"},          │
│   {"role": "assistant", "content": "Какую именно..."}       │
│ ]                                                            │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ SYSTEM PROMPT (Turn 2):                                      │
│ [базовый промпт]                                             │
│ + existing_events                                            │
│ + conversation_history (previous dialog)                     │
│ + User: "С Леной"                                            │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ GPT RESPONSE (Turn 2):                                       │
│ {                                                            │
│   "intent": "clarify",                                       │
│   "clarify_question": "На какое время перенести встречу      │
│                        с Леной?"                             │
│ }                                                            │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ BOT → USER:                                                  │
│ На какое время перенести встречу с Леной?                   │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ TURN 3: USER SPECIFIES TIME                                  │
│                                                              │
│ USER: "На 16:00"                                             │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ GPT RESPONSE (Turn 3):                                       │
│ {                                                            │
│   "intent": "update",                                        │
│   "event_id": "abc-123-def",                                 │
│   "start_time": "2025-11-24T16:00:00+03:00"                 │
│ }                                                            │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ CLEAR CONVERSATION HISTORY                                   │
│ conversation_history[user_id] = []                           │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ EXECUTE UPDATE                                               │
│ CalendarService.update_event(event_id, new_start_time)      │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│ BOT → USER:                                                  │
│ ✅ Перенесено                                                │
│ Встреча с Леной                                              │
│ Было: 15:00                                                  │
│ Стало: 16:00                                                 │
└─────────────────────────────────────────────────────────────┘
```

**Количество API вызовов:** 3 (по одному на каждый turn)
**Общее время:** ~6-10 секунд

---

## 📊 Data Flow Diagram

### От текста до действия

```
┌──────────────────┐
│  Natural Text    │  "Встреча завтра в 15:00"
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│   Parse Date     │  "завтра" → 25.11.2025
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  Form Prompt     │  System + Context + User text
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  Yandex GPT      │  Processing...
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│   JSON Response  │  {intent: "create", title: "Встреча", ...}
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  Parse JSON      │  JSON → EventDTO
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│   Validate       │  Check required fields
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  Route Intent    │  CREATE → _handle_create()
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  Execute Action  │  CalendarService.create_event()
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│   Store to DB    │  Radicale CalDAV / SQLite
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  Format Response │  "✅ Записал\n25 ноября 15:00 • Встреча"
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│   Send to User   │  Telegram message
└──────────────────┘
```

---

## 🎯 Intent Decision Tree

### Как LLM выбирает intent

```
                    User Input
                        │
                        ▼
             ┌──────────────────────┐
             │ Есть конкретное время?│
             │ ("в 15:00", "at 3pm") │
             └─────┬──────────┬─────┘
                   │          │
             YES ◄─┘          └─► NO
                   │                │
                   ▼                ▼
        ┌────────────────┐  ┌────────────────┐
        │ Есть название? │  │ Глагол действия?│
        │ Есть дата?     │  │ (позвонить,     │
        │                │  │  написать)      │
        └───┬────────────┘  └───┬────────────┘
            │                   │
      YES ◄─┘                   └─► YES
            │                         │
            ▼                         ▼
     ┌────────────┐          ┌────────────┐
     │   CREATE   │          │    TODO    │
     └────────────┘          └────────────┘
            │                         │
            ▼                         │
    ┌──────────────┐                 │
    │ Повторяется? │                 │
    │ (каждый день)│                 │
    └───┬──────────┘                 │
        │                            │
  YES ◄─┘                            │
        │                            │
        ▼                            │
┌─────────────────┐                  │
│ CREATE_RECURRING│                  │
└─────────────────┘                  │
        │                            │
        └────────────────────────────┘
                   │
                   ▼
         ┌─────────────────┐
         │ Несколько штук? │
         │ ("потом", "и")  │
         └────┬──────┬─────┘
              │      │
        YES ◄─┘      └─► NO
              │            │
              ▼            ▼
     ┌───────────────┐  ┌──────┐
     │ BATCH_CONFIRM │  │ Done │
     └───────────────┘  └──────┘


                    User Input
                        │
                        ▼
             ┌──────────────────────┐
             │ Запрос информации?   │
             │ ("что у меня", "show")│
             └─────┬──────────┬─────┘
                   │          │
             YES ◄─┘          └─► NO
                   │                │
                   ▼                ▼
        ┌────────────────┐  ┌────────────────┐
        │     QUERY      │  │ Изменение?     │
        │                │  │ ("перенеси")   │
        └────────────────┘  └───┬────────────┘
                                │
                          YES ◄─┘
                                │
                                ▼
                     ┌────────────────┐
                     │ Есть event_id? │
                     │ (из existing)  │
                     └───┬────────────┘
                         │
                   YES ◄─┘
                         │
                         ▼
                  ┌────────────┐
                  │   UPDATE   │
                  └────────────┘


                    User Input
                        │
                        ▼
             ┌──────────────────────┐
             │ Удаление?            │
             │ ("удали", "delete")  │
             └─────┬──────────┬─────┘
                   │          │
             YES ◄─┘          └─► NO
                   │                │
                   ▼                ▼
        ┌────────────────┐  ┌────────────────┐
        │ "все X"?       │  │ Не понятно?    │
        │ ("удали все")  │  │                │
        └───┬────────────┘  └───┬────────────┘
            │                   │
      YES ◄─┘                   └─► YES
            │                         │
            ▼                         ▼
┌──────────────────────┐     ┌────────────┐
│ DELETE_BY_CRITERIA   │     │  CLARIFY   │
└──────────────────────┘     └────────────┘
            │
            │
      NO ◄──┘
            │
            ▼
     ┌────────────┐
     │   DELETE   │
     └────────────┘
```

---

## 📈 Performance Metrics

### Среднее время обработки

```
┌─────────────────────────────────────────────────────────────┐
│                   REQUEST TIMELINE                           │
└─────────────────────────────────────────────────────────────┘

0ms        Telegram webhook received
↓
10ms       TelegramHandler.handle_update() started
↓
50ms       Load user preferences (timezone, settings)
↓
150ms      Load existing_events from calendar (CalDAV)
↓
200ms      LLMAgentYandex.extract_event() started
↓
250ms      Form system prompt with context
↓
300ms      POST request to Yandex GPT API
↓
1800ms     Waiting for Yandex GPT response... (1-3 sec)
↓
2100ms     Parse JSON response
↓
2150ms     Create EventDTO
↓
2200ms     Execute action (CalendarService.create_event)
↓
2400ms     Store to Radicale CalDAV
↓
2450ms     Format response message
↓
2500ms     Send Telegram message to user
↓
DONE       Total: ~2.5 seconds

┌─────────────────────────────────────────────────────────────┐
│ BREAKDOWN:                                                   │
│  • Preprocessing:         200ms (8%)                         │
│  • Yandex GPT API:       1500ms (60%)                        │
│  • Action execution:      300ms (12%)                        │
│  • Response formatting:   500ms (20%)                        │
│                                                              │
│  TOTAL:                  ~2500ms (100%)                      │
└─────────────────────────────────────────────────────────────┘
```

### Token usage breakdown

```
┌─────────────────────────────────────────────────────────────┐
│                    TOKEN USAGE                               │
└─────────────────────────────────────────────────────────────┘

INPUT TOKENS (~4500-5500):
┌────────────────────────────────┬──────────┐
│ Component                      │ Tokens   │
├────────────────────────────────┼──────────┤
│ Base system prompt             │  ~3500   │
│ Dynamic context (dates)        │  ~1000   │
│ Existing events (10 events)    │   ~300   │
│ Conversation history (clarify) │   ~200   │
│ User request                   │    ~50   │
│ Function schema                │   ~500   │
├────────────────────────────────┼──────────┤
│ TOTAL INPUT                    │  ~5550   │
└────────────────────────────────┴──────────┘

OUTPUT TOKENS (~100-1500):
┌────────────────────────────────┬──────────┐
│ Response Type                  │ Tokens   │
├────────────────────────────────┼──────────┤
│ Simple intent (CREATE/TODO)    │   ~100   │
│ Batch operations (3-5 actions) │   ~500   │
│ Large batch (10+ actions)      │  ~1500   │
│ Clarify question               │    ~80   │
├────────────────────────────────┼──────────┤
│ AVERAGE OUTPUT                 │   ~300   │
└────────────────────────────────┴──────────┘

TOTAL PER REQUEST: ~5850 tokens (average)
```

---

**Создано:** Claude Code
**Дата:** 24.11.2025
**Версия:** 1.0
